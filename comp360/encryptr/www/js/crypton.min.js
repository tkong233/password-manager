var crypton={};(function(){"use strict";var MISMATCH_ERR="Server and client version mismatch";crypton.version="0.0.4";crypton.MIN_PBKDF2_ROUNDS=1e3;crypton.online=true;crypton.clientVersionMismatch=undefined;crypton.versionCheck=function(skip,callback){if(skip){return callback(null)}var url=crypton.url()+"/versioncheck?"+"v="+crypton.version+"&sid="+crypton.sessionId||"";superagent.get(url).end(function(res){if(res.body.success!==true&&res.body.error!==undefined){crypton.clientVersionMismatch=true;return callback(res.body.error)}callback(null)})};crypton.host=location.hostname;crypton.port=1025;crypton.cipherOptions={mode:"gcm"};crypton.paranoia=6;crypton.trustedPeers="_trusted_peers";crypton.collectorsStarted=false;crypton.startCollectors=function(){sjcl.random.startCollectors();crypton.collectorsStarted=true};crypton.url=function(){return"https://"+crypton.host+":"+crypton.port};function randomBytes(nbytes){if(!nbytes){throw new Error("randomBytes requires input")}if(parseInt(nbytes,10)!==nbytes){throw new Error("randomBytes requires integer input")}if(nbytes<4){throw new Error("randomBytes cannot return less than 4 bytes")}if(nbytes%4!==0){throw new Error("randomBytes requires input as multiple of 4")}var nwords=nbytes/4;return sjcl.random.randomWords(nwords)}crypton.randomBytes=randomBytes;function constEqual(str1,str2){if(typeof str1!=="string"||typeof str2!=="string"){return false}var mismatch=str1.length^str2.length;var len=Math.min(str1.length,str2.length);for(var i=0;i<len;i++){mismatch|=str1.charCodeAt(i)^str2.charCodeAt(i)}return mismatch===0}crypton.constEqual=constEqual;crypton.sessionId=null;crypton.randomBits=function(nbits){if(!nbits){throw new Error("randomBits requires input")}if(parseInt(nbits,10)!==nbits){throw new Error("randomBits requires integer input")}if(nbits<32){throw new Error("randomBits cannot return less than 32 bits")}if(nbits%32!==0){throw new Error("randomBits requires input as multiple of 32")}var nbytes=nbits/8;return crypton.randomBytes(nbytes)};crypton.hmac=function(key,data){var mac=new sjcl.misc.hmac(key);return sjcl.codec.hex.fromBits(mac.mac(data))};crypton.hmacAndCompare=function(key,data,otherMac){var ourMac=crypton.hmac(key,data);return crypton.constEqual(ourMac,otherMac)};crypton.fingerprint=function(pubKey,signKeyPub){var pubKeys=sjcl.bitArray.concat(pubKey._point.toBits(),signKeyPub._point.toBits());return crypton.hmac("",pubKeys)};crypton.generateAccount=function(username,passphrase,callback,options){if(crypton.clientVersionMismatch){return callback(MISMATCH_ERR)}options=options||{};var save=typeof options.save!=="undefined"?options.save:true;crypton.versionCheck(!save,function(err){if(err){return callback(MISMATCH_ERR)}else{if(!username||!passphrase){return callback("Must supply username and passphrase")}if(!crypton.collectorsStarted){crypton.startCollectors()}var SIGN_KEY_BIT_LENGTH=384;var keypairCurve=options.keypairCurve||384;var numRounds=crypton.MIN_PBKDF2_ROUNDS;var account=new crypton.Account;var hmacKey=randomBytes(32);var keypairSalt=randomBytes(32);var keypairMacSalt=randomBytes(32);var signKeyPrivateMacSalt=randomBytes(32);var containerNameHmacKey=randomBytes(32);var keypairKey=sjcl.misc.pbkdf2(passphrase,keypairSalt,numRounds);var keypairMacKey=sjcl.misc.pbkdf2(passphrase,keypairMacSalt,numRounds);var signKeyPrivateMacKey=sjcl.misc.pbkdf2(passphrase,signKeyPrivateMacSalt,numRounds);var keypair=sjcl.ecc.elGamal.generateKeys(keypairCurve,crypton.paranoia);var signingKeys=sjcl.ecc.ecdsa.generateKeys(SIGN_KEY_BIT_LENGTH,crypton.paranoia);var srp=new SRPClient(username,passphrase,2048,"sha-256");var srpSalt=srp.randomHexSalt();var srpVerifier=srp.calculateV(srpSalt).toString(16);account.username=username;account.keypairSalt=JSON.stringify(keypairSalt);account.keypairMacSalt=JSON.stringify(keypairMacSalt);account.signKeyPrivateMacSalt=JSON.stringify(signKeyPrivateMacSalt);account.srpVerifier=srp.nZeros(512-srpVerifier.length)+srpVerifier;account.srpSalt=srpSalt;account.pubKey=JSON.stringify(keypair.pub.serialize());account.signKeyPub=JSON.stringify(signingKeys.pub.serialize());var sessionIdentifier="dummySession";var session=new crypton.Session(sessionIdentifier);session.account=account;session.account.signKeyPrivate=signingKeys.sec;var selfPeer=new crypton.Peer({session:session,pubKey:keypair.pub,signKeyPub:signingKeys.pub});selfPeer.trusted=true;var encryptedHmacKey=selfPeer.encryptAndSign(JSON.stringify(hmacKey));if(encryptedHmacKey.error){callback(encryptedHmacKey.error,null);return}account.hmacKeyCiphertext=JSON.stringify(encryptedHmacKey);var encryptedContainerNameHmacKey=selfPeer.encryptAndSign(JSON.stringify(containerNameHmacKey));if(encryptedContainerNameHmacKey.error){callback(encryptedContainerNameHmacKey.error,null);return}account.containerNameHmacKeyCiphertext=JSON.stringify(encryptedContainerNameHmacKey);var keypairCiphertext=sjcl.encrypt(keypairKey,JSON.stringify(keypair.sec.serialize()),crypton.cipherOptions);account.keypairCiphertext=keypairCiphertext;account.keypairMac=crypton.hmac(keypairMacKey,account.keypairCiphertext);account.signKeyPrivateCiphertext=sjcl.encrypt(keypairKey,JSON.stringify(signingKeys.sec.serialize()),crypton.cipherOptions);account.signKeyPrivateMac=crypton.hmac(signKeyPrivateMacKey,account.signKeyPrivateCiphertext);if(save){account.save(function(err){callback(err,account)});return}callback(null,account)}})};crypton.makeSession=function(sessionId,account){crypton.sessionId=sessionId;var session=new crypton.Session(crypton.sessionId);session.account=new crypton.Account;session.account.challengeKey=account.challengeKey;session.account.containerNameHmacKeyCiphertext=account.containerNameHmacKeyCiphertext;session.account.hmacKeyCiphertext=account.hmacKeyCiphertext;session.account.keypairCiphertext=account.keypairCiphertext;session.account.keypairMac=account.keypairMac;session.account.pubKey=account.pubKey;session.account.challengeKeySalt=account.challengeKeySalt;session.account.keypairSalt=account.keypairSalt;session.account.keypairMacSalt=account.keypairMacSalt;session.account.signKeyPub=account.signKeyPub;session.account.signKeyPrivateCiphertext=account.signKeyPrivateCiphertext;session.account.signKeyPrivateMacSalt=account.signKeyPrivateMacSalt;session.account.signKeyPrivateMac=account.signKeyPrivateMac;return session};crypton.loginWithStorage=function(username,passphrase,callback,data,options){var cryptonData=window.sessionStorage.getItem("crypton");if(!cryptonData){return callback("We are having trouble reading the data while offline, please connect to the internet")}var sessionData=JSON.parse(window.sessionStorage.getItem("crypton")).Session;if(sessionData===null){callback("Offline server could not be verified");return}crypton.sessionId=sessionData.sessionId;var session=crypton.makeSession(sessionData.sessionId,sessionData.account);session.account.username=username;session.account.passphrase=passphrase;sessionData.options.username=username;sessionData.options.passphrase=passphrase;crypton.work.calculateSrpM1(sessionData.options,function(err,srpM1,ourSrpM2){if(!constEqual(sessionData.srpM2,ourSrpM2)){callback("Server could not be verified");return}session.account.unravel(function(err){if(err){return callback(err)}return callback(null,session)})})};crypton.login=function(username,passphrase,callback,data,options){var response={srpA:data.srpAstr};superagent.post(crypton.url()+"/account/"+username).withCredentials().send(response).end(function(res){if(!res.body||res.body.success!==true){return callback(res.body.error)}crypton.sessionId=res.body.sid;options.a=data.a;options.srpA=data.srpA;options.srpB=res.body.srpB;options.srpSalt=res.body.srpSalt;crypton.work.calculateSrpM1(options,function(err,srpM1,ourSrpM2){response={srpM1:srpM1};var url=crypton.url()+"/account/"+username+"/answer?sid="+crypton.sessionId;superagent.post(url).withCredentials().send(response).end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}if(!constEqual(res.body.srpM2,ourSrpM2)){callback("Server could not be verified");return}var session=crypton.makeSession(crypton.sessionId,res.body.account);delete options.username;delete options.passphrase;var sessionToLocalStorage={Session:{sessionId:crypton.sessionId,account:session.account,options:options,srpM2:res.body.srpM2},containers:{}};window.sessionStorage.setItem("crypton",JSON.stringify(sessionToLocalStorage));session.account.username=username;session.account.passphrase=passphrase;session.account.unravel(function(err){if(err){return callback(err)}session.getOrCreateItem(crypton.trustedPeers,function(err,item){if(err){var _err='Cannot get "trusted peers" Item';console.error(_err,err);return callback(_err,session)}return callback(null,session)})})})})})};crypton.authorize=function(username,passphrase,callback,options){if(crypton.clientVersionMismatch){return callback(MISMATCH_ERR)}options=options||{};var check=typeof options.check!=="undefined"?options.check:true;if(!crypton.online){check=false}crypton.versionCheck(!check,function(err){if(err){return callback(MISMATCH_ERR)}else{if(!username||!passphrase){return callback("Must supply username and passphrase")}if(!crypton.collectorsStarted){crypton.startCollectors()}var options={username:username,passphrase:passphrase};crypton.work.calculateSrpA(options,function(err,data){if(err){return callback(err)}var loginFunction=crypton.online?crypton.login:crypton.loginWithStorage;return loginFunction(username,passphrase,callback,data,options)})}})}})();(function(){"use strict";var Account=crypton.Account=function Account(){};Account.prototype.save=function(callback){superagent.post(crypton.url()+"/account?sid="+crypton.sessionId).withCredentials().send(this.serialize()).end(function(res){if(res.body.success!==true){callback(res.body.error)}else{callback()}})};Account.prototype.unravel=function(callback){var that=this;crypton.work.unravelAccount(this,function(err,data){if(err){return callback(err)}that.regenerateKeys(data,function(err){callback(err)})})};Account.prototype.regenerateKeys=function(data,callback){var exponent=sjcl.bn.fromBits(data.secret.exponent);this.secretKey=new sjcl.ecc.elGamal.secretKey(data.secret.curve,sjcl.ecc.curves["c"+data.secret.curve],exponent);var point=sjcl.ecc.curves["c"+this.pubKey.curve].fromBits(this.pubKey.point);this.pubKey=new sjcl.ecc.elGamal.publicKey(this.pubKey.curve,point.curve,point);this.hmacKey=data.hmacKey;this.containerNameHmacKey=data.containerNameHmacKey;var signPoint=sjcl.ecc.curves["c"+this.signKeyPub.curve].fromBits(this.signKeyPub.point);this.signKeyPub=new sjcl.ecc.ecdsa.publicKey(this.signKeyPub.curve,signPoint.curve,signPoint);var signExponent=sjcl.bn.fromBits(data.signKeySecret.exponent);this.signKeyPrivate=new sjcl.ecc.ecdsa.secretKey(data.signKeySecret.curve,sjcl.ecc.curves["c"+data.signKeySecret.curve],signExponent);this.fingerprint=crypton.fingerprint(this.pubKey,this.signKeyPub);var pubKeyHex=sjcl.codec.hex.fromBits(this.pubKey._point.toBits());var pubKeyShouldBe=this.secretKey._curve.G.mult(exponent);var pubKeyShouldBeHex=sjcl.codec.hex.fromBits(pubKeyShouldBe.toBits());if(!crypton.constEqual(pubKeyHex,pubKeyShouldBeHex)){return callback("Server provided incorrect public key")}var signKeyPubHex=sjcl.codec.hex.fromBits(this.signKeyPub._point.toBits());var signKeyPubShouldBe=this.signKeyPrivate._curve.G.mult(signExponent);var signKeyPubShouldBeHex=sjcl.codec.hex.fromBits(signKeyPubShouldBe.toBits());if(!crypton.constEqual(signKeyPubHex,signKeyPubShouldBeHex)){return callback("Server provided incorrect public signing key")}this.trusted=true;callback(null)};Account.prototype.serialize=function(){return{srpVerifier:this.srpVerifier,srpSalt:this.srpSalt,containerNameHmacKeyCiphertext:this.containerNameHmacKeyCiphertext,hmacKeyCiphertext:this.hmacKeyCiphertext,keypairCiphertext:this.keypairCiphertext,keypairMac:this.keypairMac,pubKey:this.pubKey,keypairSalt:this.keypairSalt,keypairMacSalt:this.keypairMacSalt,signKeyPrivateMacSalt:this.signKeyPrivateMacSalt,username:this.username,signKeyPub:this.signKeyPub,signKeyPrivateCiphertext:this.signKeyPrivateCiphertext,signKeyPrivateMac:this.signKeyPrivateMac}};Account.prototype.verifyAndDecrypt=function(signedCiphertext,peer){if(!peer.trusted){return{error:"Peer is untrusted"}}var ciphertextString=JSON.stringify(signedCiphertext.ciphertext);var hash=sjcl.hash.sha256.hash(ciphertextString);var verified=false;try{verified=peer.signKeyPub.verify(hash,signedCiphertext.signature)}catch(ex){console.error(ex);console.error(ex.stack)}try{var message=sjcl.decrypt(this.secretKey,ciphertextString,crypton.cipherOptions);if(verified){return{plaintext:message,verified:verified,error:null}}else{return{plaintext:null,verified:false,error:"Cannot verify ciphertext"}}}catch(ex){console.error(ex);console.error(ex.stack);return{plaintext:null,verified:false,error:"Cannot verify ciphertext"}}};Account.prototype.changePassphrase=function(currentPassphrase,newPassphrase,callback,keygenProgressCallback,skipCheck){if(skipCheck){if(currentPassphrase==newPassphrase){var err="New passphrase cannot be the same as current password";return callback(err)}}if(keygenProgressCallback){if(typeof keygenProgressCallback=="function"){keygenProgressCallback()}}var MIN_PBKDF2_ROUNDS=crypton.MIN_PBKDF2_ROUNDS;var that=this;var username=this.username;crypton.authorize(username,currentPassphrase,function(err,newSession){if(err){console.error(err);return callback(err)}var currentAccount=newSession.account;var keypairSalt=crypton.randomBytes(32);var keypairMacSalt=crypton.randomBytes(32);var signKeyPrivateMacSalt=crypton.randomBytes(32);var srp=new SRPClient(username,newPassphrase,2048,"sha-256");var srpSalt=srp.randomHexSalt();var srpVerifier=srp.calculateV(srpSalt).toString(16);srpVerifier=srp.nZeros(512-srpVerifier.length)+srpVerifier;var keypairKey=sjcl.misc.pbkdf2(newPassphrase,keypairSalt,MIN_PBKDF2_ROUNDS);var keypairMacKey=sjcl.misc.pbkdf2(newPassphrase,keypairMacSalt,MIN_PBKDF2_ROUNDS);var signKeyPrivateMacKey=sjcl.misc.pbkdf2(newPassphrase,signKeyPrivateMacSalt,MIN_PBKDF2_ROUNDS);var privateKeys={containerNameHmacKeyCiphertext:currentAccount.containerNameHmacKey,hmacKeyCiphertext:currentAccount.hmacKey,signKeyPrivateCiphertext:currentAccount.signKeyPrivate.serialize(),keypairCiphertext:currentAccount.secretKey.serialize(),keypairMacKey:keypairMacKey,signKeyPrivateMacKey:signKeyPrivateMacKey};var newKeyring;try{newKeyring=that.wrapAllKeys(keypairKey,privateKeys,newSession)}catch(ex){console.error(ex);console.error(ex.stack);return callback("Fatal: cannot wrap keys, see error console for more information")}newKeyring.keypairSalt=JSON.stringify(keypairSalt);newKeyring.keypairMacSalt=JSON.stringify(keypairMacSalt);newKeyring.signKeyPrivateMacSalt=JSON.stringify(signKeyPrivateMacSalt);newKeyring.srpVerifier=srpVerifier;newKeyring.srpSalt=srpSalt;var url=crypton.url()+"/account/"+that.username+"/keyring?sid="+crypton.sessionId;superagent.post(url).withCredentials().send(newKeyring).end(function(res){if(res.body.success!==true){console.error("error: ",res.body.error);callback(res.body.error)}else{newSession=null;callback(null,true)}})},null)};Account.prototype.wrapKey=function(selfPeer,serializedPrivateKey){if(!selfPeer||!serializedPrivateKey){throw new Error("selfPeer and serializedPrivateKey are required")}var serializedKey;if(typeof serializedPrivateKey!="string"){serializedKey=JSON.stringify(serializedPrivateKey)}else{serializedKey=serializedPrivateKey}var wrappedKey=selfPeer.encryptAndSign(serializedKey);if(wrappedKey.error){return null}return wrappedKey};Account.prototype.wrapAllKeys=function(wrappingKey,privateKeys,session){var requiredKeys=["containerNameHmacKeyCiphertext","hmacKeyCiphertext","signKeyPrivateCiphertext","keypairCiphertext","keypairMacKey","signKeyPrivateMacKey"];var privateKeysLength=Object.keys(privateKeys).length;var privateKeyNames=Object.keys(privateKeys);for(var i=0;i<privateKeysLength;i++){var keyName=privateKeyNames[i];if(requiredKeys.indexOf(keyName)==-1){throw new Error("Missing private key: "+keyName)}}if(privateKeysLength!=requiredKeys.length){throw new Error("privateKeys length does not match requiredKeys length")}var selfPeer=new crypton.Peer({session:session,pubKey:session.account.pubKey,signKeyPub:session.account.signKeyPub});selfPeer.trusted=true;var result={};var hmacKeyCiphertext=this.wrapKey(selfPeer,privateKeys.hmacKeyCiphertext);if(hmacKeyCiphertext.error){result.hmacKeyCiphertext=null}else{result.hmacKeyCiphertext=JSON.stringify(hmacKeyCiphertext)}var containerNameHmacKeyCiphertext=this.wrapKey(selfPeer,privateKeys.containerNameHmacKeyCiphertext);if(containerNameHmacKeyCiphertext.error){result.containerNameHmacKeyCiphertext=null}else{result.containerNameHmacKeyCiphertext=JSON.stringify(containerNameHmacKeyCiphertext)}var keypairCiphertext=sjcl.encrypt(wrappingKey,JSON.stringify(privateKeys.keypairCiphertext),crypton.cipherOptions);if(keypairCiphertext.error){console.error(keypairCiphertext.error);keypairCiphertext=null}result.keypairCiphertext=keypairCiphertext;var signKeyPrivateCiphertext=sjcl.encrypt(wrappingKey,JSON.stringify(privateKeys.signKeyPrivateCiphertext),crypton.cipherOptions);if(signKeyPrivateCiphertext.error){console.error(signKeyPrivateCiphertext.error);signKeyPrivateCiphertext=null}result.signKeyPrivateCiphertext=signKeyPrivateCiphertext;result.keypairMac=crypton.hmac(privateKeys.keypairMacKey,result.keypairCiphertext);result.signKeyPrivateMac=crypton.hmac(privateKeys.signKeyPrivateMacKey,result.signKeyPrivateCiphertext);for(var keyName in result){if(!result[keyName]){throw new Error("Fatal: "+keyName+" is null")}}return result}})();(function(){"use strict";var ERRS;var Session=crypton.Session=function(id){ERRS=crypton.errors;this.id=id;this.peers={};this.events={};this.containers=[];this.items={};this.itemHistory={};this.itemKeyLedger={};this.timeline=[];this.inbox=new crypton.Inbox(this);var that=this;var joinServerParameters={token:crypton.sessionId};this.socket=io.connect(crypton.url(),{query:"joinServerParameters="+JSON.stringify(joinServerParameters),reconnection:true,reconnectionDelay:5e3});this.socket.on("message",function(data){that.inbox.get(data.messageId,function(err,message){that.emit("message",message)})});this.socket.on("containerUpdate",function(containerNameHmac){for(var i=0;i<that.containers.length;i++){var container=that.containers[i];var temporaryHmac=container.containerNameHmac||container.getPublicName();if(crypton.constEqual(temporaryHmac,containerNameHmac)){container.sync(function(err){if(container._listener){container._listener()}});break}}});this.socket.on("itemUpdate",function(itemObj){if(!itemObj.itemNameHmac||!itemObj.creator||!itemObj.toUsername){console.error(ERRS.ARG_MISSING);throw new Error(ERRS.ARG_MISSING)}if(that.items[itemObj.itemNameHmac]){that.items[itemObj.itemNameHmac].sync(function(err){if(err){return console.error(err)}try{that.events.onSharedItemSync(that.items[itemObj.itemNameHmac])}catch(ex){console.warn(ex)}if(that.items[itemObj.itemNameHmac]._listener){that.items[itemObj.itemNameHmac]._listener(err)}})}else{that.getPeer(itemObj.creator,function(err,peer){if(err){console.error(err);console.error("Cannot load item: creator peer cannot be found");return}var itemCallback=function _itemCallback(err,item){if(err){console.error(err);return}that.items[itemObj.itemNameHmac]=item;try{that.events.onSharedItemSync(item)}catch(ex){console.warn(ex)}};var item=new crypton.Item(null,null,that,peer,itemCallback,itemObj.itemNameHmac)})}})};Session.prototype.removeItem=function removeItem(itemNameHmac,callback){var that=this;for(var name in this.items){if(this.items[name].nameHmac==itemNameHmac){this.items[name].remove(function(err){if(err){console.error(err);callback(err);return}if(that.items[name].deleted){delete that.items[name];callback(null)}})}}};Session.prototype.getOrCreateItem=function getOrCreateItem(itemName,callback){if(!itemName){return callback("itemName is required")}if(!callback){throw new Error("Missing required callback argument")}if(this.items[itemName]){callback(null,this.items[itemName]);return}var creator=this.selfPeer;var item=new crypton.Item(itemName,null,this,creator,function getItemCallback(err,item){if(err){console.error(err);return callback(err)}callback(null,item)})};Session.prototype.getSharedItem=function getSharedItem(itemNameHmac,peer,callback){if(!itemNameHmac){return callback(ERRS.ARG_MISSING)}if(!callback){throw new Error(ERRS.ARG_MISSING_CALLBACK)}function getItemCallback(err,item){if(err){console.error(err);return callback(err)}callback(null,item)}new crypton.Item(null,null,this,peer,getItemCallback,itemNameHmac)};Session.prototype.__defineGetter__("selfPeer",function(){if(this._selfPeer){return this._selfPeer}this._selfPeer=this.createSelfPeer();return this._selfPeer});Session.prototype.createSelfPeer=function(){var selfPeer=new crypton.Peer({session:this,pubKey:this.account.pubKey,signKeyPub:this.account.signKeyPub,signKeyPrivate:this.account.signKeyPrivate,username:this.account.username});selfPeer.trusted=true;return selfPeer};Session.prototype.getItemHistory=function getItemHistory(options,callback){if(typeof options!="object"){return callback(ERRS.ARG_MISSING_OBJECT)}if(typeof callback!="function"){return callback(ERRS.ARG_MISSING_CALLBACK)}var lastItemRead=options.lastItemRead;var offset=options.offset;var limit=options.limit;if(typeof parseInt(lastItemRead)!="number"){lastItemRead=0}if(typeof parseInt(offset)!="number"){offset=0}if(typeof parseInt(limit)!="number"){limit=10}var that=this;var url=crypton.url()+"/itemhistory/"+"?sid="+crypton.sessionId+"&historyid="+lastItemRead+"&offset="+offset+"&limit="+limit;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){console.error(res.body);return callback("Cannot get item history")}var rows=res.body.rawData;var history=[];for(var i=0;i<rows.length;i++){var timelineId=rows[i].timelineId;if(that.itemHistory[timelineId]){continue}var hitem=new crypton.HistoryItem(that,rows[i]);history.push(hitem)}callback(null,history)})};Session.prototype.getTimeline=function getTimeline(options,callback){if(typeof options!="object"){return callback(ERRS.ARG_MISSING_OBJECT)}if(typeof callback!="function"){return callback(ERRS.ARG_MISSING_CALLBACK)}var lastItemRead=options.lastItemRead;var offset=options.offset;var limit=options.limit;var direction=options.direction;if(typeof parseInt(lastItemRead)!="number"){lastItemRead=0}if(typeof parseInt(offset)!="number"){offset=0}if(typeof parseInt(limit)!="number"){limit=10}var that=this;var url=crypton.url()+"/timeline/"+"?sid="+crypton.sessionId+"&timelineid="+lastItemRead+"&offset="+offset+"&limit="+limit+"&direction="+direction;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){console.error(res.body);return callback("Cannot get timeline")}var rows=res.body.rawData;var history=[];for(var i=0;i<rows.length;i++){var hitem=new crypton.HistoryItem(that,rows[i]);history.push(hitem)}callback(null,history)})};Session.prototype.getLatestTimeline=function getLatestTimeline(options,callback){if(typeof options!="object"){return callback(ERRS.ARG_MISSING_OBJECT)}if(typeof callback!="function"){return callback(ERRS.ARG_MISSING_CALLBACK)}var limit=options.limit;if(typeof parseInt(limit)!="number"){limit=10}var that=this;var url=crypton.url()+"/timeline-latest/"+"?sid="+crypton.sessionId+"&limit="+limit;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){console.error(res.body);return callback("Cannot get timeline")}var rows=res.body.rawData;var history=[];for(var i=0;i<rows.length;i++){var hitem=new crypton.HistoryItem(that,rows[i]);if(hitem===null){continue}history.push(hitem)}history.reverse();callback(null,history)})};Session.prototype.getTimelineBefore=function getTimelineBefore(options,callback){if(typeof options!="object"){return callback(ERRS.ARG_MISSING_OBJECT)}if(typeof callback!="function"){return callback(ERRS.ARG_MISSING_CALLBACK)}var limit=options.limit;if(typeof parseInt(limit)!="number"){limit=10}var beforeId=options.beforeId;if(typeof parseInt(beforeId)!="number"){console.error("'beforeId' property is missing from the options argument");return callback(ERRS.ARG_MISSING)}var that=this;var url=crypton.url()+"/timeline-before/"+"?sid="+crypton.sessionId+"&limit="+limit+"&beforeId="+beforeId;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){console.error(res.body);return callback("Cannot get timeline")}var rows=res.body.rawData;var history=[];for(var i=0;i<rows.length;i++){var hitem=new crypton.HistoryItem(that,rows[i]);history.push(hitem)}callback(null,history)})};Session.prototype.getTimelineAfter=function getTimelineAfter(options,callback){if(typeof options!="object"){return callback(ERRS.ARG_MISSING_OBJECT)}if(typeof callback!="function"){return callback(ERRS.ARG_MISSING_CALLBACK)}var limit=options.limit;if(typeof parseInt(limit)!="number"){limit=10}var afterId=options.afterId;if(typeof parseInt(afterId)!="number"){console.error("'afterId' property is missing from the options argument");return callback(ERRS.ARG_MISSING)}var that=this;var url=crypton.url()+"/timeline-after/"+"?sid="+crypton.sessionId+"&limit="+limit+"&afterId="+afterId;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){console.error(res.body);return callback("Cannot get timeline")}var rows=res.body.rawData;var history=[];for(var i=0;i<rows.length;i++){var hitem=new crypton.HistoryItem(that,rows[i]);history.push(hitem)}history.reverse();callback(null,history)})};Session.prototype.load=function(containerName,callback){for(var i=0;i<this.containers.length;i++){if(crypton.constEqual(this.containers[i].name,containerName)){callback(null,this.containers[i]);return}}var that=this;this.getContainer(containerName,function(err,container){if(err){callback(err);return}that.containers.push(container);callback(null,container)})};Session.prototype.loadWithHmac=function(containerNameHmac,peer,callback){for(var i=0;i<this.containers.length;i++){if(crypton.constEqual(this.containers[i].nameHmac,containerNameHmac)){callback(null,this.containers[i]);return}}var that=this;this.getContainerWithHmac(containerNameHmac,peer,function(err,container){if(err){callback(err);return}that.containers.push(container);callback(null,container)})};Session.prototype.create=function(containerName,callback){if(!crypton.online){var containers=JSON.parse(window.sessionStorage.getItem("crypton")).containers;var hasContainers=containers!==null&&containers!==undefined;var hasContainer=hasContainers&&containers.hasOwnProperty(containerName);if(!hasContainers||!hasContainer){return callback("Container"+containerName+"not found in sessionStorage")}var container=containers[containerName];return callback(null,container)}for(var i in this.containers){if(crypton.constEqual(this.containers[i].name,containerName)){callback("Container already exists");return}}var selfPeer=new crypton.Peer({session:this,pubKey:this.account.pubKey,signKeyPub:this.account.signKeyPub});selfPeer.trusted=true;var sessionKey=crypton.randomBytes(32);var sessionKeyCiphertext=selfPeer.encryptAndSign(sessionKey);if(sessionKeyCiphertext.error){return callback(sessionKeyCiphertext.error)}delete sessionKeyCiphertext.error;var signature="hello";var containerNameHmac=new sjcl.misc.hmac(this.account.containerNameHmacKey);containerNameHmac=sjcl.codec.hex.fromBits(containerNameHmac.encrypt(containerName));var rawPayloadCiphertext=sjcl.encrypt(sessionKey,JSON.stringify({recordIndex:0,delta:{}}),crypton.cipherOptions);var payloadCiphertextHash=sjcl.hash.sha256.hash(JSON.stringify(rawPayloadCiphertext));var payloadSignature=this.account.signKeyPrivate.sign(payloadCiphertextHash,crypton.paranoia);var payloadCiphertext={ciphertext:rawPayloadCiphertext,signature:payloadSignature};var that=this;new crypton.Transaction(this,function(err,tx){var chunks=[{type:"addContainer",containerNameHmac:containerNameHmac},{type:"addContainerSessionKey",containerNameHmac:containerNameHmac,signature:signature},{type:"addContainerSessionKeyShare",toAccount:that.account.username,containerNameHmac:containerNameHmac,sessionKeyCiphertext:sessionKeyCiphertext},{type:"addContainerRecord",containerNameHmac:containerNameHmac,payloadCiphertext:payloadCiphertext}];async.eachSeries(chunks,function(chunk,callback2){tx.save(chunk,callback2)},function(err){if(err){return tx.abort(function(){callback(err)})}tx.commit(function(){var container=new crypton.Container(that);container.name=containerName;container.sessionKey=sessionKey;that.containers.push(container);callback(null,container)})})})};Session.prototype.deleteContainer=function(containerName,callback){var that=this;var containerNameHmac=new sjcl.misc.hmac(this.account.containerNameHmacKey);containerNameHmac=sjcl.codec.hex.fromBits(containerNameHmac.encrypt(containerName));new crypton.Transaction(this,function(err,tx){var chunk={type:"deleteContainer",containerNameHmac:containerNameHmac};tx.save(chunk,function(err){if(err){return callback(err)}tx.commit(function(err){if(err){return callback(err)}for(var i=0;i<that.containers.length;i++){if(crypton.constEqual(that.containers[i].name,containerName)){that.containers.splice(i,1);break}}callback(null)})})})};Session.prototype.getContainer=function(containerName,callback){var container=new crypton.Container(this);container.name=containerName;container.sync(function(err){callback(err,container)})};Session.prototype.getContainerWithHmac=function(containerNameHmac,peer,callback){var container=new crypton.Container(this);container.nameHmac=containerNameHmac;container.peer=peer;container.sync(function(err){callback(err,container)})};Session.prototype.getPeer=function(username,callback){if(this.peers[username]){return callback(null,this.peers[username])}var that=this;var peer=new crypton.Peer;peer.username=username;peer.session=this;peer.fetch(function(err,peer){if(err){return callback(err)}that.getOrCreateItem(crypton.trustedPeers,function(err,trustedPeers){if(err){return callback(err)}var peers=trustedPeers.value;if(!peers[username]){peer.trusted=false}else{var savedFingerprint=peers[username].fingerprint;if(!crypton.constEqual(savedFingerprint,peer.fingerprint)){return callback("Server has provided malformed peer",peer)}peer.trusted=true}that.peers[username]=peer;callback(null,peer)})})};Session.prototype.on=function(eventName,listener){this.events[eventName]=listener};Session.prototype.emit=function(eventName,data){this.events[eventName]&&this.events[eventName](data)}})();(function(){"use strict";var Container=crypton.Container=function(session){this.keys={};this.session=session;this.recordCount=1;this.recordIndex=0;this.versions={};this.version=0;this.name=null};Container.prototype.add=function(key,callback){if(this.keys[key]){callback("Key already exists");return}this.keys[key]={};callback()};Container.prototype.get=function(key,callback){if(!this.keys[key]){callback("Key does not exist");return}callback(null,this.keys[key])};Container.prototype.save=function(callback,options){var that=this;this.getDiff(function(err,diff){if(!diff&&(!options||!options.force)){callback("Container has not changed");return}var payload={recordIndex:that.recordCount,delta:diff};var now=+new Date;that.versions[now]=JSON.parse(JSON.stringify(that.keys));that.version=now;that.recordCount++;var rawPayloadCiphertext=sjcl.encrypt(that.sessionKey,JSON.stringify(payload),crypton.cipherOptions);var payloadCiphertextHash=sjcl.hash.sha256.hash(JSON.stringify(rawPayloadCiphertext));var payloadSignature=that.session.account.signKeyPrivate.sign(payloadCiphertextHash,crypton.paranoia);var payloadCiphertext={ciphertext:rawPayloadCiphertext,signature:payloadSignature};var chunk={type:"addContainerRecord",containerNameHmac:that.getPublicName(),payloadCiphertext:payloadCiphertext};if(options&&options.save==false){callback(null,chunk);
return}var tx=new crypton.Transaction(that.session,function(err){if(err){console.error(err)}tx.save(chunk,function(err){if(err){console.error(err)}tx.commit(function(err){if(err){console.error(err)}callback(err)})})})})};Container.prototype.getDiff=function(callback){var last=this.latestVersion();var old=this.versions[last]||{};callback(null,crypton.diff.create(old,this.keys))};Container.prototype.getVersions=function(){return Object.keys(this.versions)};Container.prototype.getVersion=function(timestamp){return this.versions[timestamp]};Container.prototype.latestVersion=function(){var versions=this.getVersions();if(!versions.length){return this.version}else{return Math.max.apply(Math,versions)}};Container.prototype.getPublicName=function(){if(this.nameHmac){return this.nameHmac}var hmac=new sjcl.misc.hmac(this.session.account.containerNameHmacKey);var containerNameHmac=hmac.encrypt(this.name);this.nameHmac=sjcl.codec.hex.fromBits(containerNameHmac);return this.nameHmac};Container.prototype.getHistory=function(callback){var containerNameHmac=this.getPublicName();var currentVersion=this.latestVersion();var userContainersName=containerNameHmac+currentVersion;if(!crypton.online){var containers=JSON.parse(window.sessionStorage.getItem("crypton")).containers;var hasContainers=containers!==null&&containers!==undefined;var hasUserContainers=hasContainers&&containers.hasOwnProperty(userContainersName);if(!hasContainers||!hasUserContainers){return callback("container"+containerNameHmac+"not found in sessionStorage")}var userContainers=containers[containerNameHmac+currentVersion];return callback(null,userContainers)}var url=crypton.url()+"/container/"+containerNameHmac+"?after="+(currentVersion+1)+"&sid="+crypton.sessionId;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}var cryptonToLocalStorage=JSON.parse(window.sessionStorage.getItem("crypton"));cryptonToLocalStorage.containers[containerNameHmac+currentVersion]=res.body.records;window.sessionStorage.setItem("crypton",JSON.stringify(cryptonToLocalStorage));callback(null,res.body.records)})};Container.prototype.parseHistory=function(records,callback){var that=this;var keys=that.keys||{};var versions=that.versions||{};var recordIndex=that.recordIndex+1;async.eachSeries(records,function(rawRecord,callback){that.decryptRecord(recordIndex,rawRecord,function(err,record){if(err){return callback(err)}keys=crypton.diff.apply(record.delta,keys);versions[record.time]=JSON.parse(JSON.stringify(keys));callback(null)})},function(err){if(err){console.log("Hit error parsing container history");console.log(that);console.log(err);return callback(err)}that.recordIndex=recordIndex;callback(null,keys,versions,recordIndex)})};Container.prototype.decryptRecord=function(recordIndex,record,callback){if(!this.sessionKey){this.decryptKey(record)}var parsedRecord;try{parsedRecord=JSON.parse(record.payloadCiphertext)}catch(e){}if(!parsedRecord){return callback("Could not parse record JSON")}var options={sessionKey:this.sessionKey,expectedRecordIndex:recordIndex,record:record.payloadCiphertext,creationTime:record.creationTime,peerSignKeyPubSerialized:(this.peer&&this.peer.signKeyPub||this.session.account.signKeyPub).serialize()};crypton.work.decryptRecord(options,callback)};Container.prototype.decryptKey=function(record){var peer=this.peer||this.session.account;var sessionKeyRaw=this.session.account.verifyAndDecrypt(JSON.parse(record.sessionKeyCiphertext),peer);if(sessionKeyRaw.error){throw new Error(sessionKeyRaw.error)}if(!sessionKeyRaw.verified){throw new Error("Container session key signature mismatch")}this.sessionKey=JSON.parse(sessionKeyRaw.plaintext)};Container.prototype.sync=function(callback){var that=this;this.getHistory(function(err,records){if(err){callback(err);return}that.parseHistory(records,function(err,keys,versions,recordIndexAfter){that.keys=keys;that.versions=versions;that.version=Math.max.apply(Math,Object.keys(versions));that.recordCount=that.recordCount+versions.count;callback(err)})})};Container.prototype.share=function(peer,callback){if(!this.sessionKey){return callback("Container must be initialized to share")}var containerNameHmac=this.getPublicName();var sessionKeyCiphertext=peer.encryptAndSign(this.sessionKey);if(sessionKeyCiphertext.error){return callback(sessionKeyCiphertext.error)}delete sessionKeyCiphertext.error;var that=this;new crypton.Transaction(this,function(err,tx){var chunk={type:"addContainerSessionKeyShare",toAccount:peer.username,containerNameHmac:containerNameHmac,sessionKeyCiphertext:sessionKeyCiphertext};tx.save(chunk,function(err){if(err){return callback(err)}tx.commit(function(err){if(err){return callback(err)}peer.sendMessage({type:"internal",action:"containerShare"},{fromUsername:that.session.account.username,containerNameHmac:containerNameHmac},function(err){callback(err)})})})})};Container.prototype.watch=function(listener){this._listener=listener};Container.prototype.unwatch=function(){delete this._listener}})();(function(){"use strict";var Transaction=crypton.Transaction=function(session,callback){var that=this;this.session=session;this.types=["addAccount","setBaseKeyring","addContainer","deleteContainer","addContainerSessionKey","addContainerSessionKeyShare","addContainerRecord","addMessage","deleteMessage"];if(!this.session){callback&&callback(null,this);return}this.create(function(err,id){if(err){console.log(err);callback(err);return}that.id=id;callback&&callback(null,that)})};Transaction.prototype.create=function(callback){var url=crypton.url()+"/transaction/create"+"?sid="+crypton.sessionId;superagent.post(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback(null,res.body.id)})};Transaction.prototype.save=function(){this.verify();var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();if(typeof callback!="function"){args.push(callback);callback=function(){}}async.each(args,function(chunk,cb){if(typeof chunk=="function"){cb();return}that.saveChunk(chunk,cb)},function(err){callback(err)})};Transaction.prototype.saveChunk=function(chunk,callback){this.verify();this.verifyChunk(chunk);var url=crypton.url()+"/transaction/"+this.id+"?sid="+crypton.sessionId;superagent.post(url).withCredentials().send(chunk).end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback()})};Transaction.prototype.commit=function(callback){this.verify();var url=crypton.url()+"/transaction/"+this.id+"/commit?sid="+crypton.sessionId;superagent.post(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback()})};Transaction.prototype.abort=function(callback){this.verify();var url=crypton.url()+"/transaction/"+this.id+"?sid="+crypton.sessionId;superagent.del(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback()})};Transaction.prototype.verify=function(){if(!this.id){throw new Error("Invalid transaction")}};Transaction.prototype.verifyChunk=function(chunk){if(!chunk||!~this.types.indexOf(chunk.type)){throw new Error("Invalid transaction chunk type")}}})();(function(){"use strict";var Peer=crypton.Peer=function(options){options=options||{};this.accountId=options.id;this.session=options.session;this.username=options.username;this.pubKey=options.pubKey;this.signKeyPub=options.signKeyPub};Peer.prototype.fetch=function(callback){if(!this.username){callback("Must supply peer username");return}if(!this.session){callback("Must supply session to peer object");return}var that=this;var url=crypton.url()+"/peer/"+this.username+"?sid="+crypton.sessionId;superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}var peer=res.body.peer;that.accountId=peer.accountId;that.username=peer.username;that.pubKey=peer.pubKey;that.signKeyPub=peer.signKeyPub;var point=sjcl.ecc.curves["c"+peer.pubKey.curve].fromBits(peer.pubKey.point);that.pubKey=new sjcl.ecc.elGamal.publicKey(peer.pubKey.curve,point.curve,point);var signPoint=sjcl.ecc.curves["c"+peer.signKeyPub.curve].fromBits(peer.signKeyPub.point);that.signKeyPub=new sjcl.ecc.ecdsa.publicKey(peer.signKeyPub.curve,signPoint.curve,signPoint);that.fingerprint=crypton.fingerprint(that.pubKey,that.signKeyPub);callback(null,that)})};Peer.prototype.encrypt=function(payload){if(!this.trusted){return{error:"Peer is untrusted"}}var ciphertext=sjcl.encrypt(this.pubKey,JSON.stringify(payload),crypton.cipherOptions);return ciphertext};Peer.prototype.encryptAndSign=function(payload){if(!this.trusted){return{error:"Peer is untrusted"}}try{var ciphertext=sjcl.encrypt(this.pubKey,JSON.stringify(payload),crypton.cipherOptions);var hash=sjcl.hash.sha256.hash(ciphertext);var signature=this.session.account.signKeyPrivate.sign(hash,crypton.paranoia);return{ciphertext:JSON.parse(ciphertext),signature:signature,error:null}}catch(ex){console.error(ex);console.error(ex.stack);var err="Error: Could not complete encryptAndSign: "+ex;return{ciphertext:null,signature:null,error:err}}};Peer.prototype.sendMessage=function(headers,payload,callback){if(!this.session){callback("Must supply session to peer object");return}var message=new crypton.Message(this.session);message.headers=headers;message.payload=payload;message.fromAccount=this.session.accountId;message.toAccount=this.accountId;message.encrypt(this);message.send(callback)};Peer.prototype.trust=function(callback){var that=this;that.session.getOrCreateItem(crypton.trustedPeers,function(err,trustedPeers){if(err){return callback(err)}var peers=trustedPeers.value;if(peers[that.username]){return callback("Peer is already trusted")}peers[that.username]={trustedAt:+new Date,fingerprint:that.fingerprint};trustedPeers.save(function(err){if(err){return callback(err)}that.trusted=true;callback(null)})})}})();(function(){"use strict";var Message=crypton.Message=function Message(session,raw){this.session=session;this.headers={};this.payload={};raw=raw||{};for(var i in raw){this[i]=raw[i]}};Message.prototype.encrypt=function(peer,callback){var headersCiphertext=peer.encryptAndSign(this.headers);var payloadCiphertext=peer.encryptAndSign(this.payload);if(headersCiphertext.error||payloadCiphertext.error){callback("Error encrypting headers or payload in Message.encrypt()");return}this.encrypted={headersCiphertext:JSON.stringify(headersCiphertext),payloadCiphertext:JSON.stringify(payloadCiphertext),fromUsername:this.session.account.username,toAccountId:peer.accountId};callback&&callback(null)};Message.prototype.decrypt=function(callback){var that=this;var headersCiphertext=JSON.parse(this.headersCiphertext);var payloadCiphertext=JSON.parse(this.payloadCiphertext);this.session.getPeer(this.fromUsername,function(err,peer){if(err){callback(err);return}var headers=that.session.account.verifyAndDecrypt(headersCiphertext,peer);var payload=that.session.account.verifyAndDecrypt(payloadCiphertext,peer);if(!headers.verified||!payload.verified){callback("Cannot verify headers or payload ciphertext in Message.decrypt()");return}else if(headers.error||payload.error){callback("Cannot decrypt headers or payload in Message.decrypt");return}that.headers=JSON.parse(headers.plaintext);that.payload=JSON.parse(payload.plaintext);that.created=new Date(that.creationTime);callback(null,that)})};Message.prototype.send=function(callback){if(!this.encrypted){return callback("You must encrypt the message to a peer before sending!")}var url=crypton.url()+"/peer?sid="+crypton.sessionId;superagent.post(url).send(this.encrypted).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback(null,res.body.messageId)})}})();(function(){"use strict";var Inbox=crypton.Inbox=function Inbox(session){this.session=session;this.rawMessages=[];this.messages={}};Inbox.prototype.poll=function(callback){var that=this;var url=crypton.url()+"/inbox?sid="+crypton.sessionId;callback=callback||function(){};superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}that.rawMessages=res.body.messages;that.parseRawMessages();if(callback){callback(null,res.body.messages)}})};Inbox.prototype.list=function(){return this.messages};Inbox.prototype.filter=function(criteria,callback){criteria=criteria||{};async.filter(this.messages,function(message){for(var i in criteria){if(message[i]!=criteria[i]){return false}}return true},function(messages){callback(messages)})};Inbox.prototype.get=function(messageId,callback){var cachedMessage=this.messages[messageId];if(cachedMessage){callback(null,cachedMessage);return}var that=this;var url=crypton.url()+"/inbox/"+messageId+"?sid="+crypton.sessionId;callback=callback||function(){};superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}var message=new crypton.Message(that.session,res.body.message);message.decrypt(function(err){if(err){console.error(err);return callback(err)}that.messages[message.id]=message;callback(null,message)})})};Inbox.prototype.delete=function(id,callback){var chunk={type:"deleteMessage",messageId:id};var tx=new crypton.Transaction(this.session,function(err){tx.save(chunk,function(err){tx.commit(function(err){callback()})})})};Inbox.prototype.getAllMetadata=function(callback){var that=this;var url=crypton.url()+"/inbox-metadata?sid="+crypton.sessionId;callback=callback||function(){};superagent.get(url).withCredentials().end(function(res){if(!res.body||res.body.success!==true){callback(res.body.error);return}callback(null,res.body.metadata);return})},Inbox.prototype.clear=function(callback){var chunk={type:"clearInbox"};var tx=new crypton.Transaction(this.session,function(err){tx.save(chunk,function(err){tx.commit(function(err){callback()})})})};Inbox.prototype.parseRawMessages=function(){var that=this;for(var i=0;i<this.rawMessages.length;i++){var rawMessage=this.rawMessages[i];if(this.messages[rawMessage.messageId]){continue}var message=new crypton.Message(this.session,rawMessage);message.decrypt(function(err){that.messages[message.messageId]=message})}}})();(function(){"use strict";var Diff=crypton.diff={};Diff.create=function(old,current){var delta=jsondiffpatch.diff(old,current);return delta};Diff.apply=function(delta,old){var current=JSON.parse(JSON.stringify(old));jsondiffpatch.patch(current,delta);return current}})();(function(){"use strict";!self.worker&&window.addEventListener("load",function(){var scriptEls=document.getElementsByTagName("script");var path;for(var i in scriptEls){if(scriptEls[i].src&&~scriptEls[i].src.indexOf("crypton.js")){path=scriptEls[i].src}}isomerize(crypton.work,path)},false);var work=crypton.work={};work.calculateSrpA=function(options,callback){if(!crypton.collectorsStarted){crypton.startCollectors()}try{var srp=new SRPClient(options.username,options.passphrase,2048,"sha-256");var a=srp.srpRandom();var srpA=srp.calculateA(a);var srpAstr=srpA.toString(16);srpAstr=srp.nZeros(512-srpAstr.length)+srpAstr;callback(null,{a:a.toString(),srpA:srpA.toString(),srpAstr:srpAstr})}catch(e){console.error(e);callback(e)}};work.calculateSrpM1=function(options,callback){try{var srp=new SRPClient(options.username,options.passphrase,2048,"sha-256");var srpSalt=options.srpSalt;var a=new BigInteger(options.a);var srpA=new BigInteger(options.srpA);var srpB=new BigInteger(options.srpB,16);var srpu=srp.calculateU(srpA,srpB);var srpS=srp.calculateS(srpB,options.srpSalt,srpu,a);var rawSrpM1=srp.calculateMozillaM1(srpA,srpB,srpS);var srpM1=rawSrpM1.toString(16);srpM1=srp.nZeros(64-srpM1.length)+srpM1;var srpK=srp.calculateK(srpS);var srpM2=srp.calculateMozillaM2(srpA,rawSrpM1,srpK).toString(16);callback(null,srpM1,srpM2)}catch(e){console.error(e);callback(e)}};work.unravelAccount=function(account,callback){var ret={};var numRounds=crypton.MIN_PBKDF2_ROUNDS;var keypairKey=sjcl.misc.pbkdf2(account.passphrase,account.keypairSalt,numRounds);var keypairMacKey=sjcl.misc.pbkdf2(account.passphrase,account.keypairMacSalt,numRounds);var signKeyPrivateMacKey=sjcl.misc.pbkdf2(account.passphrase,account.signKeyPrivateMacSalt,numRounds);var macOk=false;try{var ciphertextString=JSON.stringify(account.keypairCiphertext);macOk=crypton.hmacAndCompare(keypairMacKey,ciphertextString,account.keypairMac);ret.secret=JSON.parse(sjcl.decrypt(keypairKey,ciphertextString,crypton.cipherOptions))}catch(e){}if(!macOk||!ret.secret){return callback("Could not parse secret key")}macOk=false;try{var ciphertextString=JSON.stringify(account.signKeyPrivateCiphertext);macOk=crypton.hmacAndCompare(signKeyPrivateMacKey,ciphertextString,account.signKeyPrivateMac);ret.signKeySecret=JSON.parse(sjcl.decrypt(keypairKey,ciphertextString,crypton.cipherOptions))}catch(e){}if(!macOk||!ret.signKeySecret){return callback("Could not parse signKeySecret")}var exponent=sjcl.bn.fromBits(ret.secret.exponent);var secretKey=new sjcl.ecc.elGamal.secretKey(ret.secret.curve,sjcl.ecc.curves["c"+ret.secret.curve],exponent);account.secretKey=secretKey;var session={};session.account=account;session.account.signKeyPrivate=ret.signKeySecret;var signPoint=sjcl.ecc.curves["c"+account.signKeyPub.curve].fromBits(account.signKeyPub.point);var selfPeer=new crypton.Peer({session:session,pubKey:account.pubKey,signKeyPub:new sjcl.ecc.ecdsa.publicKey(account.signKeyPub.curve,signPoint.curve,signPoint)});selfPeer.trusted=true;var selfAccount=new crypton.Account;selfAccount.secretKey=secretKey;var containerNameHmacKey;try{containerNameHmacKey=selfAccount.verifyAndDecrypt(account.containerNameHmacKeyCiphertext,selfPeer);ret.containerNameHmacKey=JSON.parse(containerNameHmacKey.plaintext)}catch(e){}if(!containerNameHmacKey.verified){return callback("Could not parse containerNameHmacKey")}var hmacKey;try{hmacKey=selfAccount.verifyAndDecrypt(account.hmacKeyCiphertext,selfPeer);ret.hmacKey=JSON.parse(hmacKey.plaintext)}catch(e){}if(!hmacKey.verified){return callback("Could not parse hmacKey")}callback(null,ret)};work.decryptRecord=function(options,callback){var sessionKey=options.sessionKey;var creationTime=options.creationTime;var expectedRecordIndex=options.expectedRecordIndex;var peerSignKeyPubSerialized=options.peerSignKeyPubSerialized;if(!sessionKey||!creationTime||!expectedRecordIndex||!peerSignKeyPubSerialized){return callback("Must supply all options to work.decryptRecord")}var record;try{record=JSON.parse(options.record)}catch(e){}if(!record){return callback("Could not parse record")}var curve="c"+peerSignKeyPubSerialized.curve;var signPoint=sjcl.ecc.curves[curve].fromBits(peerSignKeyPubSerialized.point);var peerSignKeyPub=new sjcl.ecc.ecdsa.publicKey(peerSignKeyPubSerialized.curve,signPoint.curve,signPoint);var verified=false;var payloadCiphertextHash=sjcl.hash.sha256.hash(JSON.stringify(record.ciphertext));try{verified=peerSignKeyPub.verify(payloadCiphertextHash,record.signature)}catch(e){console.error(e)}if(!verified){return callback("Record signature does not match expected signature")}var payload;try{payload=JSON.parse(sjcl.decrypt(sessionKey,record.ciphertext,crypton.cipherOptions))}catch(e){}if(!payload){return callback("Could not parse record payload")}if(payload.recordIndex!==expectedRecordIndex){}callback(null,{time:+new Date(creationTime),delta:payload.delta})}})();(function(){"use strict";var Card=crypton.Card=function Card(){};Card.prototype.createIdCard=function(fingerprint,username,appname,domId){if(!domId){domId="id-card"}var fingerArr=this.createFingerprintArr(fingerprint);var canvas=document.createElement("canvas");canvas.width=290;canvas.height=480;canvas.setAttribute("id",domId);var ctx=canvas.getContext("2d");var x=20;var y=15;ctx.fillStyle="white";ctx.fillRect(0,0,290,480);ctx.fillStyle="#CCCCCC";ctx.fillRect(0,0,289,1);ctx.fillRect(0,0,1,479);ctx.fillRect(289,0,1,479);ctx.fillRect(0,479,290,1);ctx.fillStyle="black";y=y+10;ctx.font="11px sans-serif";ctx.fillText(appname,x,y);y=y+12;var qrCodeCanvas=this.createQRCode(fingerArr,username,appname);ctx.drawImage(qrCodeCanvas,23,y);y=y+265;ctx.fillText(username,x,y);return canvas};Card.prototype.createQRCode=function(fingerArr,username,appname){var qrValue=JSON.stringify({f:fingerArr.join(" "),u:username,a:appname});var qrCodeCanvas=qr.canvas({value:qrValue,level:"H",size:10});return qrCodeCanvas};Card.prototype.createIdentigrid=function(colorArr){var canvas=document.createElement("canvas");canvas.width=200;canvas.height=200;var ctx=canvas.getContext("2d");var x=0;var y=0;var w=50;var h=50;for(var idx in colorArr){ctx.fillStyle=colorArr[idx];ctx.fillRect(x,y,w,h);x=x+50;if(x==200){x=0;y=y+50}}return canvas};Card.prototype.createColorArr=function(fingerArr){var count=0;var paddingData=fingerArr.join("");var colorArr=[];var REQUIRED_LENGTH=6;for(var idx in fingerArr){var pad=REQUIRED_LENGTH-fingerArr[idx].length;if(pad==0){colorArr.push("#"+fingerArr[idx])}else{var color="#"+fingerArr[idx];for(var i=0;i<pad;i++){color=color+paddingData[count];count++}colorArr.push(color)}}return colorArr};Card.prototype.createFingerprintArr=function(fingerprint){if(fingerprint.length!=64){var err="Fingerprint has incorrect length";console.error(err);throw new Error(err)}fingerprint=fingerprint.toUpperCase();var fingerArr=[];var i=0;var segment="";for(var chr in fingerprint){segment=segment+fingerprint[chr];i++;if(i==4){fingerArr.push(segment);i=0;segment="";continue}}return fingerArr};Card.prototype.generateQRCodeInput=function(fingerprint,username,application,url){if(!url){url=""}var json=JSON.stringify({fingerprint:fingerprint,username:username,application:application});return json}})();(function(){"use strict";var ERRS;var Item=crypton.Item=function Item(name,value,session,creator,callback,nameHmac){ERRS=crypton.errors;if(!callback||typeof callback!="function"){console.error(ERRS.ARG_MISSING_CALLBACK);throw new Error(ERRS.ARG_MISSING_CALLBACK)}if(!session||!creator){console.error(ERRS.ARG_MISSING);return callback(ERRS.ARG_MISSING)}if(!name&&!nameHmac){console.error(ERRS.ARG_MISSING);return callback(ERRS.ARG_MISSING)}if(!name&&nameHmac){this.nameHmac=nameHmac;this.name=nameHmac}else{this.name=name}if(nameHmac){this.sharedItem=true}else{this.sharedItem=false}this.shared={};this.session=session;this.creator=creator;this._value=value||null;this.listeners=[];this.sessionKey=null;var that=this;this.sync(function(err,item){if(err){console.error(err);return callback(err,null)}return callback(null,item)});Object.defineProperty(this,"value",{get:function(){return that._value},set:function(value){that._value=value;that.save(function(err,item){if(err){console.error(err);return}})}})};Item.prototype.getPublicName=function(){if(!this.name){throw new Error(ERRS.PROPERTY_MISSING)}if(this.nameHmac){return this.nameHmac}var hmac=new sjcl.misc.hmac(this.session.account.containerNameHmacKey);var itemNameHmac=hmac.encrypt(this.name);this.nameHmac=sjcl.codec.hex.fromBits(itemNameHmac);return this.nameHmac};Item.prototype.sync=function(callback){var itemNameHmac=this.getPublicName();this.syncWithHmac(itemNameHmac,callback)};Item.prototype.syncWithHmac=function(itemNameHmac,callback){var that=this;var url=crypton.url()+"/item/"+itemNameHmac+"?sid="+crypton.sessionId;if(this.sharedItem){url=url+"&shared=1"}superagent.get(url).withCredentials().end(function(res){var doesNotExist="Item does not exist";if((!res.body||res.body.success!==true)&&res.body.error!=doesNotExist){return callback(res.body.error)}if(res.body.error==doesNotExist){if(that.sharedItem){return callback("Item is no longer shared!",null)}return that.create(callback)}that.parseAndOverwrite(res.body.rawData,callback)})};Item.prototype.parseAndOverwrite=function(rawData,callback){var cipherItem=rawData.ciphertext;var wrappedSessionKey=JSON.parse(rawData.wrappedSessionKey);var ct=JSON.stringify(cipherItem.ciphertext);var hash=sjcl.hash.sha256.hash(ct);var verified=false;try{verified=this.creator.signKeyPub.verify(hash,cipherItem.signature)}catch(ex){console.error(ex);console.error(ex.stack);return callback("Cannot verify Item "+this.getPublicName())}var sessionKeyResult;var peer;if(!this.sessionKey){if(this.sharedItem){peer=this.creator}else{peer=this.session.createSelfPeer()}sessionKeyResult=this.session.account.verifyAndDecrypt(wrappedSessionKey,peer);if(sessionKeyResult.error){return callback(ERRS.UNWRAP_KEY_ERROR)}this.sessionKey=JSON.parse(sessionKeyResult.plaintext)}var decrypted;try{decrypted=sjcl.decrypt(this.sessionKey,ct,crypton.cipherOptions)}catch(ex){console.error(ex);console.error(ex.stack);return callback(ERRS.DECRYPT_CIPHERTEXT_ERROR)}var value;if(decrypted){try{this._value=JSON.parse(decrypted)}catch(ex){console.error(ex);console.error(ex.stack);this._value=decrypted}var name;if(this.name){name=this.name}else{name=this.getPublicName()}this.session.items[name]=this;this.modTime=new Date(rawData.modTime);callback(null,this)}};Item.prototype.save=function(callback){if(!callback||typeof callback!="function"){console.error(ERRS.ARG_MISSING_CALLBACK);return callback(ERRS.ARG_MISSING_CALLBACK)}if(this.creator.username!=this.session.account.username){console.error(crypton.errors.UPDATE_PERMISSION_ERROR);return callback(crypton.errors.UPDATE_PERMISSION_ERROR)}var payload;try{payload=this.wrapItem()}catch(ex){console.error(ex);console.error(ex.stack);return callback("Cannot wrap/save item")}var that=this;var url=crypton.url()+"/item/"+this.getPublicName()+"?sid="+crypton.sessionId;superagent.post(url).withCredentials().send(payload).end(function(res){if(!res.body.success){return callback("Cannot save item")}that.modTime=new Date(res.body.result.modTime);return callback(null,res.body.result)})};Item.prototype.update=function item_update(newValue,callback){if(!callback||typeof callback!="function"){console.error(ERRS.ARG_MISSING_CALLBACK);throw new Error(ERRS.ARG_MISSING_CALLBACK)}if(!newValue){return callback(ERRS.ARG_MISSING)}this._value=newValue;this.save(callback)};Item.prototype.create=function(callback){if(!callback){throw new Error("Callback function required")}else{if(typeof callback!="function"){throw new Error("Callback argument type must be function")}}var sessionKey=crypton.randomBytes(32);this.sessionKey=sessionKey;var payload;try{payload=this.wrapItem()}catch(ex){console.error(ex);return callback("Error: Cannot wrapItem")}var that=this;var url=crypton.url()+"/createitem?sid="+crypton.sessionId;superagent.post(url).withCredentials().send(payload).end(function(res){if(!res.body.success){return callback("Cannot create item")}that.modTime=new Date(res.body.itemMetaData.modTime);that.session.items[that.name]=that;callback(null,that)})};Item.prototype.wrapItem=function item_wrapItem(){var selfPeer=this.session.createSelfPeer();var sessionKeyCiphertext=selfPeer.encryptAndSign(this.sessionKey);if(sessionKeyCiphertext.error){throw new Error(sessionKeyCiphertext.error)}delete sessionKeyCiphertext.error;var itemNameHmac=this.getPublicName();var itemValue;if(this._value){if(typeof this._value=="string"){itemValue=this._value}else{itemValue=JSON.stringify(this._value)}}else{itemValue="{}";this._value={}}var timelineVisibleFlag="f";if(this._value.__meta){if(this._value.__meta.timelineVisible){timelineVisibleFlag="t"}}var rawPayloadCiphertext=sjcl.encrypt(this.sessionKey,itemValue,crypton.cipherOptions);var payloadCiphertextHash=sjcl.hash.sha256.hash(rawPayloadCiphertext);var payloadSignature=this.session.account.signKeyPrivate.sign(payloadCiphertextHash,crypton.paranoia);var payloadCiphertext={ciphertext:JSON.parse(rawPayloadCiphertext),signature:payloadSignature};var sessionKeyHash=sjcl.hash.sha256.hash(sessionKeyCiphertext);var sessionKeySignature=this.session.account.signKeyPrivate.sign(sessionKeyHash,crypton.paranoia);var payload={itemNameHmac:itemNameHmac,payloadCiphertext:JSON.stringify(payloadCiphertext),wrappedSessionKey:JSON.stringify(sessionKeyCiphertext),timelineVisible:timelineVisibleFlag};return payload};Item.prototype.remove=function(callback){if(!callback){throw new Error("Callback function required")}else{if(typeof callback!="function"){throw new Error("Callback argument type must be function")}}if(this.creator.username!=this.session.account.username){console.error(crypton.errors.UPDATE_PERMISSION_ERROR);return callback(crypton.errors.UPDATE_PERMISSION_ERROR)}var that=this;var url=crypton.url()+"/removeitem?sid="+crypton.sessionId;var payload={itemNameHmac:this.getPublicName()};superagent.post(url).withCredentials().send(payload).end(function(res){if(!res.body.success){return callback("Cannot remove item")}that.deleted=new Date;callback(null)})};Item.prototype.share=function(peer,callback){if(!peer){console.error(ERRS.ARG_MISSING);return callback(ERRS.ARG_MISSING)}var sessionKeyCiphertext=peer.encryptAndSign(this.sessionKey);var toUsername=peer.username;var itemNameHmac=this.getPublicName();var url=crypton.url()+"/shareitem/"+itemNameHmac+"?sid="+crypton.sessionId;var payload={toUsername:toUsername,sessionKeyCiphertext:sessionKeyCiphertext};var that=this;superagent.post(url).withCredentials().send(payload).end(function(res){if(!res.body.success){return callback("Cannot share item")}that.notifyItemShared(peer,function(err){callback(null,res.body.success);that.shared[peer.username]=Date.now()})})};Item.prototype.notifyItemShared=function(peer,callback){var headers={notification:"sharedItem"};var nameHmac=this.getPublicName();var payload={itemNameHmac:nameHmac,from:this.creator.username,sent:Date.now()};peer.sendMessage(headers,payload,function(err){if(err){console.error(err);return callback(ERRS.PEER_MESSAGE_SEND_FAILED)}callback(null)})};Item.prototype.unshare=function(peer,callback){var that=this;var shareeUsername=peer.username;var itemNameHmac=this.getPublicName();var url=crypton.url()+"/unshareitem/"+itemNameHmac+"?sid="+crypton.sessionId;var payload={shareeUsername:shareeUsername};superagent.post(url).withCredentials().send(payload).end(function(res){if(!res.body.success){console.error(res.body);return callback("Cannot unshare item")}callback(null);try{delete that.shared[shareeUsername]}catch(ex){console.warn("Sharee not listed in item.shared object")}})};Item.prototype.lastUpdate=function(callback){console.warn("Unimplemented!")}})();(function(){"use strict";var ERRS;var HistoryItem=crypton.HistoryItem=function HistoryItem(session,rawData){ERRS=crypton.errors;this.rawData=rawData;this.session=session;this.timelineId=rawData.timelineId;this.modTime=this.rawData.modTime;this.creationTime=this.rawData.creationTime;var record;if(!this.rawData.creatorUsername){this.itemHistoryId=this.rawData.itemHistoryId;this.itemNameHmac=this.rawData.itemNameHmac;record=this.decryptHistoryItem(null,null);return record}else{this.creatorUsername=this.rawData.creatorUsername;this.timelineId=this.rawData.timelineId;record=this.decryptTimelineItem(this.rawData.creatorUsername,null)}return record};HistoryItem.prototype.decryptHistoryItem=function decryptHistoryItem(creator,sessionKey){if(!creator){this.creator=this.session.selfPeer}else{this.creator=creator}if(sessionKey){this.sessionKey=sessionKey}var rawData=this.rawData;var cipherItem=rawData.ciphertext;var wrappedSessionKey=JSON.parse(rawData.wrappedSessionKey);var _key=app.session.itemKeyLedger[wrappedSessionKey.ciphertext.kemtag];if(_key){this.sessionKey=_key}var ct=JSON.stringify(cipherItem.ciphertext);var hash=sjcl.hash.sha256.hash(ct);var verified=false;try{verified=this.creator.signKeyPub.verify(hash,cipherItem.signature)}catch(ex){console.error(ex);console.error(ex.stack);throw new Error(ex)}var sessionKeyResult;if(!this.sessionKey){sessionKeyResult=this.session.account.verifyAndDecrypt(wrappedSessionKey,this.creator);if(sessionKeyResult.error){return new Error(ERRS.UNWRAP_KEY_ERROR)}this.sessionKey=JSON.parse(sessionKeyResult.plaintext);var tag=wrappedSessionKey.ciphertext.kemtag;app.session.itemKeyLedger[tag]=this.sessionKey}var decrypted;
try{decrypted=sjcl.decrypt(this.sessionKey,ct,crypton.cipherOptions)}catch(ex){console.error(ex);console.error(ex.stack);throw new Error(ERRS.DECRYPT_CIPHERTEXT_ERROR)}if(decrypted){try{this.value=JSON.parse(decrypted)}catch(ex){console.error(ex);console.error(ex.stack);this.value=decrypted}this.session.itemHistory[this.timelineId]=this;return this.value}};HistoryItem.prototype.decryptTimelineItem=function decryptTimelineItem(creatorName,sessionKey){var that=this;if(creatorName==this.session.account.username){this.decryptHistoryItem(this.session.selfPeer,sessionKey);return}this.session.getPeer(creatorName,function(err,peer){if(err){console.error(err);return{error:err}}if(!peer.trusted){return console.error("Cannot decrypt data: Peer is not trusted.")}that.decryptHistoryItem(peer,sessionKey)})}})();(function(){"use strict";function Errors(){}Errors.prototype={ARG_MISSING_CALLBACK:"Callback argument is required",ARG_MISSING_STRING:"String argument is required",ARG_MISSING_OBJECT:"Object argument is required",ARG_MISSING:"Missing required argument",PROPERTY_MISSING:"Missing object property",UNWRAP_KEY_ERROR:"Cannot unwrap session key",DECRYPT_CIPHERTEXT_ERROR:"Cannot decrypt ciphertext",UPDATE_PERMISSION_ERROR:"Update permission denied",LOCAL_ITEM_MISSING:"Cannot delete local Item, not currently cached",PEER_MESSAGE_SEND_FAILED:"Cannot send message to peer"};crypton.errors=new Errors})();(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error("Callback was already called.");called=true;fn.apply(root,arguments)}}var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==="undefined"||!process.nextTick){if(typeof setImmediate==="function"){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=="undefined"){async.setImmediate=setImmediate}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}}}))})};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback(null)}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}})()}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);if(!keys.length){return callback(null)}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(_keys(results).length===keys.length){callback(null,results);callback=function(){}}});_each(keys,function(k){var task=tasks[k]instanceof Function?[tasks[k]]:tasks[k];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.waterfall=function(tasks,callback){callback=callback||function(){};if(tasks.constructor!==Array){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(tasks.constructor===Array){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(test()){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}if(!test()){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){var item={data:task,callback:typeof callback==="function"?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,push:function(data,callback){_insert(q,data,false,callback)},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers}};return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,push:function(data,callback){if(data.constructor!==Array){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==="function"?callback:null});if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain)cargo.drain();return}var ts=typeof payload==="number"?tasks.splice(0,payload):tasks.splice(0);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=="undefined"){if(err){if(console.error){console.error(err)}}else if(console[name]){_each(args,function(x){console[name](x)})}}}]))}};async.log=_console_fn("log");async.dir=_console_fn("dir");async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){callback.apply(null,memo[key])}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.compose=function(){var fns=Array.prototype.reverse.call(arguments);return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof define!=="undefined"&&define.amd){define([],function(){return async})}else if(typeof module!=="undefined"&&module.exports){module.exports=async}else{root.async=async}})();(function(global){var BASE64_CODE=[".","/","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];var BASE64_INDEX=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];var base64={};base64.encode=function(b,len){var off=0;var rs=[];var c1;var c2;if(len<=0||len>b.length){throw new Error("Invalid 'len': "+len)}while(off<len){c1=b[off++]&255;rs.push(BASE64_CODE[c1>>2&63]);c1=(c1&3)<<4;if(off>=len){rs.push(BASE64_CODE[c1&63]);break}c2=b[off++]&255;c1|=c2>>4&15;rs.push(BASE64_CODE[c1&63]);c1=(c2&15)<<2;if(off>=len){rs.push(BASE64_CODE[c1&63]);break}c2=b[off++]&255;c1|=c2>>6&3;rs.push(BASE64_CODE[c1&63]);rs.push(BASE64_CODE[c2&63])}return rs.join("")};base64.decode=function(s,len){var off=0;var slen=s.length;var olen=0;var rs=[];var c1,c2,c3,c4,o,code;if(len<=0)throw new Error("Illegal 'len': "+len);while(off<slen-1&&olen<len){code=s.charCodeAt(off++);c1=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;code=s.charCodeAt(off++);c2=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;if(c1==-1||c2==-1){break}o=c1<<2>>>0;o|=(c2&48)>>4;rs.push(String.fromCharCode(o));if(++olen>=len||off>=slen){break}code=s.charCodeAt(off++);c3=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;if(c3==-1){break}o=(c2&15)<<4>>>0;o|=(c3&60)>>2;rs.push(String.fromCharCode(o));if(++olen>=len||off>=slen){break}code=s.charCodeAt(off++);c4=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1;o=(c3&3)<<6>>>0;o|=c4;rs.push(String.fromCharCode(o));++olen}var res=[];for(off=0;off<olen;off++){res.push(rs[off].charCodeAt(0))}return res};var bcrypt={};var BCRYPT_SALT_LEN=16;var GENSALT_DEFAULT_LOG2_ROUNDS=10;var BLOWFISH_NUM_ROUNDS=16;var MAX_EXECUTION_TIME=100;var P_ORIG=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731];var S_ORIG=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462];var C_ORIG=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function _encipher(lr,off,P,S){var n;var l=lr[off];var r=lr[off+1];l^=P[0];for(var i=0;i<=BLOWFISH_NUM_ROUNDS-2;){n=S[l>>24&255];n+=S[256|l>>16&255];n^=S[512|l>>8&255];n+=S[768|l&255];r^=n^P[++i];n=S[r>>24&255];n+=S[256|r>>16&255];n^=S[512|r>>8&255];n+=S[768|r&255];l^=n^P[++i]}lr[off]=r^P[BLOWFISH_NUM_ROUNDS+1];lr[off+1]=l;return lr}function _streamtoword(data,offp){var i;var word=0;for(i=0;i<4;i++){word=word<<8|data[offp]&255;offp=(offp+1)%data.length}return{key:word,offp:offp}}function _key(key,P,S){var offset=0;var lr=new Array(0,0);var plen=P.length;var slen=S.length;for(var i=0;i<plen;i++){var sw=_streamtoword(key,offset);offset=sw.offp;P[i]=P[i]^sw.key}for(i=0;i<plen;i+=2){lr=_encipher(lr,0,P,S);P[i]=lr[0];P[i+1]=lr[1]}for(i=0;i<slen;i+=2){lr=_encipher(lr,0,P,S);S[i]=lr[0];S[i+1]=lr[1]}}function _ekskey(data,key,P,S){var offp=0;var lr=new Array(0,0);var plen=P.length;var slen=S.length;var sw;for(var i=0;i<plen;i++){sw=_streamtoword(key,offp);offp=sw.offp;P[i]=P[i]^sw.key}offp=0;for(i=0;i<plen;i+=2){sw=_streamtoword(data,offp);offp=sw.offp;lr[0]^=sw.key;sw=_streamtoword(data,offp);offp=sw.offp;lr[1]^=sw.key;lr=_encipher(lr,0,P,S);P[i]=lr[0];P[i+1]=lr[1]}for(i=0;i<slen;i+=2){sw=_streamtoword(data,offp);offp=sw.offp;lr[0]^=sw.key;sw=_streamtoword(data,offp);offp=sw.offp;lr[1]^=sw.key;lr=_encipher(lr,0,P,S);S[i]=lr[0];S[i+1]=lr[1]}}function _nextTick(callback){if(typeof process!=="undefined"&&typeof process.nextTick==="function"){if(typeof setImmediate==="function"){setImmediate(callback)}else{process.nextTick(callback)}}else{setTimeout(callback,0)}}function _crypt(b,salt,rounds,callback){var cdata=C_ORIG.slice();var clen=cdata.length;if(rounds<4||rounds>31){throw new Error("Illegal number of rounds: "+rounds)}if(salt.length!=BCRYPT_SALT_LEN){throw new Error("Illegal salt length: "+salt.length+" != "+BCRYPT_SALT_LEN)}rounds=1<<rounds;var P=P_ORIG.slice();var S=S_ORIG.slice();_ekskey(salt,b,P,S);var i=0,j;function next(){if(i<rounds){var start=new Date;for(;i<rounds;){i=i+1;_key(b,P,S);_key(salt,P,S);if(Date.now()-start>MAX_EXECUTION_TIME){break
}}}else{for(i=0;i<64;i++){for(j=0;j<clen>>1;j++){_encipher(cdata,j<<1,P,S)}}var ret=[];for(i=0;i<clen;i++){ret.push((cdata[i]>>24&255)>>>0);ret.push((cdata[i]>>16&255)>>>0);ret.push((cdata[i]>>8&255)>>>0);ret.push((cdata[i]&255)>>>0)}if(callback){callback(null,ret);return null}else{return ret}}if(callback){_nextTick(next)}return null}if(typeof callback!=="undefined"){next();return null}else{var res;while(true){if((res=next())!==null){return res}}}}function _stringToBytes(str){var ch,st,re=[];for(var i=0;i<str.length;i++){ch=str.charCodeAt(i);st=[];do{st.push(ch&255);ch=ch>>8}while(ch);re=re.concat(st.reverse())}return re}function _hash(s,salt,callback){var minor,offset;if(salt.charAt(0)!="$"||salt.charAt(1)!="2"){throw new Error("Invalid salt version: "+salt.substring(0,2))}if(salt.charAt(2)=="$"){minor=String.fromCharCode(0);offset=3}else{minor=salt.charAt(2);if(minor!="a"||salt.charAt(3)!="$"){throw new Error("Invalid salt revision: "+salt.substring(2,4))}offset=4}if(salt.charAt(offset+2)>"$"){throw new Error("Missing salt rounds")}var r1=parseInt(salt.substring(offset,offset+1),10)*10;var r2=parseInt(salt.substring(offset+1,offset+2),10);var rounds=r1+r2;var real_salt=salt.substring(offset+3,offset+25);s+=minor>="a"?"\x00":"";var passwordb=_stringToBytes(s);var saltb=[];saltb=base64.decode(real_salt,BCRYPT_SALT_LEN);function finish(bytes){var res=[];res.push("$2");if(minor>="a")res.push(minor);res.push("$");if(rounds<10)res.push("0");res.push(rounds.toString());res.push("$");res.push(base64.encode(saltb,saltb.length));res.push(base64.encode(bytes,C_ORIG.length*4-1));return res.join("")}if(typeof callback=="undefined"){return finish(_crypt(passwordb,saltb,rounds))}else{_crypt(passwordb,saltb,rounds,function(err,bytes){if(err){callback(err,null)}else{callback(null,finish(bytes))}});return null}}function _randomBytes(len){if(typeof module!=="undefined"&&module.exports){var crypto=require("crypto");return crypto.randomBytes(len)}else{var array=new Uint32Array(len);if(global.crypto&&typeof global.crypto.getRandomValues==="function"){global.crypto.getRandomValues(array)}else if(typeof _getRandomValues==="function"){_getRandomValues(array)}else{throw new Error("Failed to generate random values: Web Crypto API not available / no polyfill set")}return Array.prototype.slice.call(array)}}function _gensalt(rounds){rounds=rounds||10;if(rounds<4||rounds>31){throw new Error("Illegal number of rounds: "+rounds)}var salt=[];salt.push("$2a$");if(rounds<GENSALT_DEFAULT_LOG2_ROUNDS)salt.push("0");salt.push(rounds.toString());salt.push("$");try{salt.push(base64.encode(_randomBytes(BCRYPT_SALT_LEN),BCRYPT_SALT_LEN));return salt.join("")}catch(err){throw err}}var _getRandomValues=null;bcrypt.setRandomPolyfill=function(getRandomValues){_getRandomValues=getRandomValues};bcrypt.genSaltSync=function(rounds,seed_length){if(!rounds)rounds=10;return _gensalt(rounds)};bcrypt.genSalt=function(rounds,seed_length,callback){if(typeof seed_length=="function"){callback=seed_length;seed_length=-1}var rnd;if(typeof rounds=="function"){callback=rounds;rnd=GENSALT_DEFAULT_LOG2_ROUNDS}else{rnd=parseInt(rounds,10)}if(typeof callback!="function"){throw new Error("Illegal or missing 'callback': "+callback)}_nextTick(function(){try{var res=bcrypt.genSaltSync(rnd);callback(null,res)}catch(err){callback(err,null)}})};bcrypt.hashSync=function(s,salt){if(!salt)salt=GENSALT_DEFAULT_LOG2_ROUNDS;if(typeof salt=="number"){salt=bcrypt.genSaltSync(salt)}return _hash(s,salt)};bcrypt.hash=function(s,salt,callback){if(typeof callback!="function"){throw new Error("Illegal 'callback': "+callback)}if(typeof salt=="number"){bcrypt.genSalt(salt,function(err,salt){_hash(s,salt,callback)})}else{_hash(s,salt,callback)}};bcrypt.compareSync=function(s,hash){if(typeof s!="string"||typeof hash!="string"){throw new Error("Illegal argument types: "+typeof s+", "+typeof hash)}if(hash.length!=60){throw new Error("Illegal hash length: "+hash.length+" != 60")}var comp=bcrypt.hashSync(s,hash.substr(0,hash.length-31));var same=comp.length==hash.length;var max_length=comp.length<hash.length?comp.length:hash.length;for(var i=0;i<max_length;++i){if(comp.length>=i&&hash.length>=i&&comp[i]!=hash[i]){same=false}}return same};bcrypt.compare=function(s,hash,callback){if(typeof callback!="function"){throw new Error("Illegal 'callback': "+callback)}bcrypt.hash(s,hash.substr(0,29),function(err,comp){callback(err,hash===comp)})};bcrypt.getRounds=function(hash){if(typeof hash!="string"){throw new Error("Illegal type of 'hash': "+typeof hash)}return parseInt(hash.split("$")[2],10)};bcrypt.getSalt=function(hash){if(typeof hash!="string"){throw new Error("Illegal type of 'hash': "+typeof hash)}if(hash.length!=60){throw new Error("Illegal hash length: "+hash.length+" != 60")}return hash.substring(0,29)};if(typeof module!="undefined"&&module["exports"]){module["exports"]=bcrypt}else if(typeof define!="undefined"&&define["amd"]){define("bcrypt",function(){return bcrypt})}else{if(!global["dcodeIO"]){global["dcodeIO"]={}}global["dcodeIO"]["bcrypt"]=bcrypt}})(this);(function(){self.isomerize=function(obj,dependencies){if(!window.Worker){return}var code="";if(typeof dependencies=="string"){code+="window = document = self; self.worker = true;\n";code+="document.documentElement = { style: [] };\n";code+="importScripts('"+dependencies+"');\n"}else{for(var i in dependencies){var name=dependencies[i];var dep=window[name];code+=toSource(dep,name)}}code+=toSource(obj,"original");code+="("+isomerExternal.toString()+")();";var blob=new Blob([code],{type:"application/javascript"});var worker=new Worker(URL.createObjectURL(blob));var listeners={};worker.onmessage=function(e){var data=JSON.parse(e.data);if(!listeners[data.time]){return}listeners[data.time].apply(listeners[data.time],data.args)};for(var i in obj){if(typeof obj[i]=="function"){obj[i]=overrideLocalMethod(i)}}function overrideLocalMethod(methodName){return function isomerProxy(){var args=[].slice.call(arguments);var callback=args.pop();var now=+new Date;listeners[now]=callback;worker.postMessage(JSON.stringify({name:methodName,time:now,args:args}))}}};function isomerExternal(){onmessage=function(e){var data=JSON.parse(e.data);var args=data.args;args.push(function(){var args=[].slice.call(arguments);postMessage(JSON.stringify({time:data.time,args:args}))});original[data.name].apply(original,args)}}function toSource(obj,name){var code="";if(name){code+="var "+name+" = "}if(typeof obj=="function"){code+=obj.toString()}else{code+=JSON.stringify(obj)}code+=";\n";for(var i in obj){if(typeof obj[i]!="function"){continue}if(name){code+=name+"."+i+" = "}code+=obj[i].toString()+";\n"}for(var i in obj.prototype){if(name){code+=name+".prototype."+i+" = "}if(typeof obj.prototype[i]=="function"){code+=obj.prototype[i].toString()+";\n"}else if(typeof obj.prototype[i]=="object"){code+=JSON.stringify(obj.prototype[i])+";\n"}}return code}})();(function(){"use strict";var e={};typeof t!="undefined"&&(e=t);var t=e;e.version="0.0.7",e.config={textDiffMinLength:60,detectArrayMove:!0,includeValueOnArrayMove:!1};var n={diff:function(t,n,r,i){var s=0,o=0,u,a,f=t.length,l=n.length,c,h=[],p=[],d=typeof r=="function"?function(e,t,n,i){if(e===t)return!0;if(typeof e!="object"||typeof t!="object")return!1;var s,o;return typeof n=="number"?(s=h[n],typeof s=="undefined"&&(h[n]=s=r(e))):s=r(e),typeof i=="number"?(o=p[i],typeof o=="undefined"&&(p[i]=o=r(t))):o=r(t),s===o}:function(e,t){return e===t},v=function(e,r){return d(t[e],n[r],e,r)},m=function(e,r){if(!i)return;if(typeof t[e]!="object"||typeof n[r]!="object")return;var s=i(t[e],n[r]);if(typeof s=="undefined")return;c||(c={_t:"a"}),c[r]=s};while(s<f&&s<l&&v(s,s))m(s,s),s++;while(o+s<f&&o+s<l&&v(f-1-o,l-1-o))m(f-1-o,l-1-o),o++;if(s+o===f){if(f===l)return c;c=c||{_t:"a"};for(u=s;u<l-o;u++)c[u]=[n[u]];return c}if(s+o===l){c=c||{_t:"a"};for(u=s;u<f-o;u++)c["_"+u]=[t[u],0,0];return c}var g=this.lcs(t.slice(s,f-o),n.slice(s,l-o),{areTheSameByIndex:function(e,t){return v(e+s,t+s)}});c=c||{_t:"a"};var y=[];for(u=s;u<f-o;u++)g.indices1.indexOf(u-s)<0&&(c["_"+u]=[t[u],0,0],y.push(u));var b=y.length;for(u=s;u<l-o;u++){var w=g.indices2.indexOf(u-s);if(w<0){var E=!1;if(e.config.detectArrayMove&&b>0)for(a=0;a<b;a++)if(v(y[a],u)){c["_"+y[a]].splice(1,2,u,3),e.config.includeValueOnArrayMove||(c["_"+y[a]][0]=""),m(y[a],u),y.splice(a,1),E=!0;break}E||(c[u]=[n[u]])}else m(g.indices1[w]+s,g.indices2[w]+s)}return c},getArrayIndexBefore:function(e,t){var n,r=t;for(var s in e)if(e.hasOwnProperty(s)&&i(e[s])){s.slice(0,1)==="_"?n=parseInt(s.slice(1),10):n=parseInt(s,10);if(e[s].length===1){if(n<t)r--;else if(n===t)return-1}else if(e[s].length===3)if(e[s][2]===0)n<=t&&r++;else if(e[s][2]===3){n<=t&&r++;if(e[s][1]>t)r--;else if(e[s][1]===t)return n}}return r},patch:function(e,t,n,r){var i,s,o=function(e,t){return e-t},u=function(e){return function(t,n){return t[e]-n[e]}},a=[],f=[],l=[];for(i in t)if(i!=="_t")if(i[0]=="_"){if(t[i][2]!==0&&t[i][2]!==3)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+t[i][2]);a.push(parseInt(i.slice(1),10))}else t[i].length===1?f.push({index:parseInt(i,10),value:t[i][0]}):l.push({index:parseInt(i,10),diff:t[i]});a=a.sort(o);for(i=a.length-1;i>=0;i--){s=a[i];var c=t["_"+s],h=e.splice(s,1)[0];c[2]===3&&f.push({index:c[1],value:h})}f=f.sort(u("index"));var p=f.length;for(i=0;i<p;i++){var d=f[i];e.splice(d.index,0,d.value)}var v=l.length;if(v>0){if(typeof n!="function")throw new Error("to patch items in the array an objectInnerPatch function must be provided");for(i=0;i<v;i++){var m=l[i];n(e,m.index.toString(),m.diff,r)}}return e},lcs:function(e,t,n){n.areTheSameByIndex=n.areTheSameByIndex||function(n,r){return e[n]===t[r]};var r=this.lengthMatrix(e,t,n),i=this.backtrack(r,e,t,e.length,t.length);return typeof e=="string"&&typeof t=="string"&&(i.sequence=i.sequence.join("")),i},lengthMatrix:function(e,t,n){var r=e.length,i=t.length,s,o,u=[r+1];for(s=0;s<r+1;s++){u[s]=[i+1];for(o=0;o<i+1;o++)u[s][o]=0}u.options=n;for(s=1;s<r+1;s++)for(o=1;o<i+1;o++)n.areTheSameByIndex(s-1,o-1)?u[s][o]=u[s-1][o-1]+1:u[s][o]=Math.max(u[s-1][o],u[s][o-1]);return u},backtrack:function(e,t,n,r,i){if(r===0||i===0)return{sequence:[],indices1:[],indices2:[]};if(e.options.areTheSameByIndex(r-1,i-1)){var s=this.backtrack(e,t,n,r-1,i-1);return s.sequence.push(t[r-1]),s.indices1.push(r-1),s.indices2.push(i-1),s}return e[r][i-1]>e[r-1][i]?this.backtrack(e,t,n,r,i-1):this.backtrack(e,t,n,r-1,i)}};e.sequenceDiffer=n,e.dateReviver=function(e,t){var n;if(typeof t=="string"){n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t);if(n)return new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6]))}return t};var r=function(){var t;e.config.diff_match_patch&&(t=new e.config.diff_match_patch.diff_match_patch),typeof diff_match_patch!="undefined"&&(typeof diff_match_patch=="function"?t=new diff_match_patch:typeof diff_match_patch=="object"&&typeof diff_match_patch.diff_match_patch=="function"&&(t=new diff_match_patch.diff_match_patch));if(t)return e.config.textDiff=function(e,n){return t.patch_toText(t.patch_make(e,n))},e.config.textPatch=function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i])throw new Error("text patch failed");return r[0]},!0},i=e.isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return typeof e=="object"&&e instanceof Array},s=e.isDate=function(e){return e instanceof Date||Object.prototype.toString.call(e)==="[object Date]"},o=function(t,r){return n.diff(t,r,e.config.objectHash,e.diff)},u=function(e,t){var n,r,i,s;s=function(i){r=a(e[i],t[i]),typeof r!="undefined"&&(typeof n=="undefined"&&(n={}),n[i]=r)};for(i in t)t.hasOwnProperty(i)&&s(i);for(i in e)e.hasOwnProperty(i)&&typeof t[i]=="undefined"&&s(i);return n},a=e.diff=function(t,n){var a,f,l,c,h;if(t===n)return;if(t!==t&&n!==n)return;a=typeof n,f=typeof t,l=n===null,c=t===null,f=="object"&&s(t)&&(f="date");if(a=="object"&&s(n)){a="date";if(f=="date"&&t.getTime()===n.getTime())return}if(l||c||a=="undefined"||a!=f||a=="number"||f=="number"||a=="boolean"||f=="boolean"||a=="string"||f=="string"||a=="date"||f=="date"||a==="object"&&i(n)!=i(t)){h=[];if(typeof t!="undefined")if(typeof n!="undefined"){var p=a=="string"&&f=="string"&&Math.min(t.length,n.length)>e.config.textDiffMinLength;p&&!e.config.textDiff&&r(),p&&e.config.textDiff?h.push(e.config.textDiff(t,n),0,2):(h.push(t),h.push(n))}else h.push(t),h.push(0,0);else h.push(n);return h}return i(n)?o(t,n):u(t,n)},f=function(e,t){return i(e)?e[parseInt(t,10)]:e[t]};e.getByKey=f;var l=function(e,t,n){if(i(e)&&e._key){var r=e._key;typeof e._key!="function"&&(r=function(t){return t[e._key]});for(var s=0;s<e.length;s++)if(r(e[s])===t){typeof n=="undefined"?(e.splice(s,1),s--):e[s]=n;return}typeof n!="undefined"&&e.push(n);return}typeof n=="undefined"?i(e)?e.splice(t,1):delete e[t]:e[t]=n},c=function(t){return e.config.textDiffReverse||(e.config.textDiffReverse=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l,c=function(){f!==null&&(r[f]="-"+r[f].slice(1)),l!==null&&(r[l]="+"+r[l].slice(1),f!==null&&(s=r[f],r[f]=r[l],r[l]=s)),r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@",o=null,a=null,f=null,l=null};r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var h=i.slice(0,1);h==="@"?(o!==null,o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):h=="+"?(f=t,r[t]="-"+r[t].slice(1)):h=="-"&&(l=t,r[t]="+"+r[t].slice(1))}return o!==null,r.join("\n")}),e.config.textDiffReverse(t)},h=e.reverse=function(e){var t,r;if(typeof e=="undefined")return;if(e===null)return null;if(typeof e=="object"&&!s(e)){if(i(e)){if(e.length<3)return e.length===1?[e[0],0,0]:[e[1],e[0]];if(e[2]===0)return[e[0]];if(e[2]===2)return[c(e[0]),0,2];throw new Error("invalid diff type")}r={};if(e._t==="a"){for(t in e)if(e.hasOwnProperty(t)&&t!=="_t"){var o,u=t;t.slice(0,1)==="_"?o=parseInt(t.slice(1),10):o=parseInt(t,10);if(i(e[t]))if(e[t].length===1)u="_"+o;else if(e[t].length===2)u=n.getArrayIndexBefore(e,o);else if(e[t][2]===0)u=o.toString();else{if(e[t][2]===3){u="_"+e[t][1],r[u]=[e[t][0],o,3];continue}u=n.getArrayIndexBefore(e,o)}else u=n.getArrayIndexBefore(e,o);r[u]=h(e[t])}r._t="a"}else for(t in e)e.hasOwnProperty(t)&&(r[t]=h(e[t]));return r}return typeof e=="string"&&e.slice(0,2)==="@@"?c(e):e},p=e.patch=function(s,o,u,a){var c,h,d="",v;typeof o!="string"?(a=u,u=o,o=null):typeof s!="object"&&(o=null),a&&(d+=a),d+="/",o!==null&&(d+=o);if(typeof u=="object")if(i(u)){if(u.length<3)return h=u[u.length-1],o!==null&&l(s,o,h),h;if(u[2]!==0){if(u[2]===2){e.config.textPatch||r();if(!e.config.textPatch)throw new Error("textPatch function not found");try{h=e.config.textPatch(f(s,o),u[0])}catch(m){throw new Error('cannot apply patch at "'+d+'": '+m)}return o!==null&&l(s,o,h),h}throw u[2]===3?new Error("Not implemented diff type: "+u[2]):new Error("invalid diff type: "+u[2])}if(o===null)return;l(s,o)}else if(u._t=="a"){v=o===null?s:f(s,o);if(typeof v!="object"||!i(v))throw new Error('cannot apply patch at "'+d+'": array expected');n.patch(v,u,t.patch,d)}else{v=o===null?s:f(s,o);if(typeof v!="object"||i(v))throw new Error('cannot apply patch at "'+d+'": object expected');for(c in u)u.hasOwnProperty(c)&&p(v,c,u[c],d)}return s},d=e.unpatch=function(e,t,n,r){return typeof t!="string"?p(e,h(t),n):p(e,t,h(n),r)};typeof require=="function"&&typeof exports=="object"&&typeof module=="object"?module.exports=e:typeof define=="function"&&define.amd?define(e):window.jsondiffpatch=e})();var QRCode;(function(){function QR8bitByte(data){this.mode=QRMode.MODE_8BIT_BYTE;this.data=data;this.parsedData=[];for(var i=0,l=this.data.length;i<l;i++){var byteArray=[];var code=this.data.charCodeAt(i);if(code>65536){byteArray[0]=240|(code&1835008)>>>18;byteArray[1]=128|(code&258048)>>>12;byteArray[2]=128|(code&4032)>>>6;byteArray[3]=128|code&63}else if(code>2048){byteArray[0]=224|(code&61440)>>>12;byteArray[1]=128|(code&4032)>>>6;byteArray[2]=128|code&63}else if(code>128){byteArray[0]=192|(code&1984)>>>6;byteArray[1]=128|code&63}else{byteArray[0]=code}this.parsedData.push(byteArray)}this.parsedData=Array.prototype.concat.apply([],this.parsedData);if(this.parsedData.length!=this.data.length){this.parsedData.unshift(191);this.parsedData.unshift(187);this.parsedData.unshift(239)}}QR8bitByte.prototype={getLength:function(buffer){return this.parsedData.length},write:function(buffer){for(var i=0,l=this.parsedData.length;i<l;i++){buffer.put(this.parsedData[i],8)}}};function QRCodeModel(typeNumber,errorCorrectLevel){this.typeNumber=typeNumber;this.errorCorrectLevel=errorCorrectLevel;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}QRCodeModel.prototype={addData:function(data){var newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null},isDark:function(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(row+","+col)}return this.modules[row][col]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(false,this.getBestMaskPattern())},makeImpl:function(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++){this.modules[row][col]=null}}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test)}if(this.dataCache==null){this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)}this.mapData(this.dataCache,maskPattern)},setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r)continue;for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c)continue;if(0<=r&&r<=6&&(c==0||c==6)||0<=c&&c<=6&&(r==0||r==6)||2<=r&&r<=4&&2<=c&&c<=4){this.modules[row+r][col+c]=true}else{this.modules[row+r][col+c]=false}}}},getBestMaskPattern:function(){var minLostPoint=0;var pattern=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var lostPoint=QRUtil.getLostPoint(this);if(i==0||minLostPoint>lostPoint){minLostPoint=lostPoint;pattern=i}}return pattern},createMovieClip:function(target_mc,instance_name,depth){var qr_mc=target_mc.createEmptyMovieClip(instance_name,depth);var cs=1;this.make();for(var row=0;row<this.modules.length;row++){var y=row*cs;for(var col=0;col<this.modules[row].length;col++){var x=col*cs;var dark=this.modules[row][col];if(dark){qr_mc.beginFill(0,100);qr_mc.moveTo(x,y);qr_mc.lineTo(x+cs,y);qr_mc.lineTo(x+cs,y+cs);qr_mc.lineTo(x,y+cs);qr_mc.endFill()}}}return qr_mc},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null){continue}this.modules[r][6]=r%2==0}for(var c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null){continue}this.modules[6][c]=c%2==0}},setupPositionAdjustPattern:function(){var pos=QRUtil.getPatternPosition(this.typeNumber);for(var i=0;i<pos.length;i++){for(var j=0;j<pos.length;j++){var row=pos[i];var col=pos[j];if(this.modules[row][col]!=null){continue}for(var r=-2;r<=2;r++){for(var c=-2;c<=2;c++){if(r==-2||r==2||c==-2||c==2||r==0&&c==0){this.modules[row+r][col+c]=true}else{this.modules[row+r][col+c]=false}}}}}},setupTypeNumber:function(test){var bits=QRUtil.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var mod=!test&&(bits>>i&1)==1;this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=mod}for(var i=0;i<18;i++){var mod=!test&&(bits>>i&1)==1;this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=mod}},setupTypeInfo:function(test,maskPattern){var data=this.errorCorrectLevel<<3|maskPattern;var bits=QRUtil.getBCHTypeInfo(data);for(var i=0;i<15;i++){var mod=!test&&(bits>>i&1)==1;if(i<6){this.modules[i][8]=mod}else if(i<8){this.modules[i+1][8]=mod}else{this.modules[this.moduleCount-15+i][8]=mod}}for(var i=0;i<15;i++){var mod=!test&&(bits>>i&1)==1;if(i<8){this.modules[8][this.moduleCount-i-1]=mod}else if(i<9){this.modules[8][15-i-1+1]=mod}else{this.modules[8][15-i-1]=mod}}this.modules[this.moduleCount-8][8]=!test},mapData:function(data,maskPattern){var inc=-1;var row=this.moduleCount-1;var bitIndex=7;var byteIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;while(true){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(byteIndex<data.length){dark=(data[byteIndex]>>>bitIndex&1)==1}var mask=QRUtil.getMask(maskPattern,row,col-c);if(mask){dark=!dark}this.modules[row][col-c]=dark;bitIndex--;if(bitIndex==-1){byteIndex++;bitIndex=7}}}row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break}}}}};QRCodeModel.PAD0=236;QRCodeModel.PAD1=17;QRCodeModel.createData=function(typeNumber,errorCorrectLevel,dataList){var rsBlocks=QRRSBlock.getRSBlocks(typeNumber,errorCorrectLevel);var buffer=new QRBitBuffer;for(var i=0;i<dataList.length;i++){var data=dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),QRUtil.getLengthInBits(data.mode,typeNumber));data.write(buffer)}var totalDataCount=0;for(var i=0;i<rsBlocks.length;i++){totalDataCount+=rsBlocks[i].dataCount}if(buffer.getLengthInBits()>totalDataCount*8){throw new Error("code length overflow. ("+buffer.getLengthInBits()+">"+totalDataCount*8+")")}if(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4)}while(buffer.getLengthInBits()%8!=0){buffer.putBit(false)}while(true){if(buffer.getLengthInBits()>=totalDataCount*8){break}buffer.put(QRCodeModel.PAD0,8);if(buffer.getLengthInBits()>=totalDataCount*8){break}buffer.put(QRCodeModel.PAD1,8)}return QRCodeModel.createBytes(buffer,rsBlocks)};QRCodeModel.createBytes=function(buffer,rsBlocks){var offset=0;var maxDcCount=0;var maxEcCount=0;var dcdata=new Array(rsBlocks.length);var ecdata=new Array(rsBlocks.length);for(var r=0;r<rsBlocks.length;r++){var dcCount=rsBlocks[r].dataCount;var ecCount=rsBlocks[r].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[r]=new Array(dcCount);for(var i=0;i<dcdata[r].length;i++){dcdata[r][i]=255&buffer.buffer[i+offset]}offset+=dcCount;var rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);var rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);var modPoly=rawPoly.mod(rsPoly);ecdata[r]=new Array(rsPoly.getLength()-1);for(var i=0;i<ecdata[r].length;i++){var modIndex=i+modPoly.getLength()-ecdata[r].length;ecdata[r][i]=modIndex>=0?modPoly.get(modIndex):0}}var totalCodeCount=0;for(var i=0;i<rsBlocks.length;i++){totalCodeCount+=rsBlocks[i].totalCount}var data=new Array(totalCodeCount);var index=0;for(var i=0;i<maxDcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<dcdata[r].length){data[index++]=dcdata[r][i]}}}for(var i=0;i<maxEcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<ecdata[r].length){data[index++]=ecdata[r][i]}}}return data};var QRMode={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};var QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1<<10|1<<8|1<<5|1<<4|1<<2|1<<1|1<<0,G18:1<<12|1<<11|1<<10|1<<9|1<<8|1<<5|1<<2|1<<0,G15_MASK:1<<14|1<<12|1<<10|1<<4|1<<1,getBCHTypeInfo:function(data){var d=data<<10;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)>=0){d^=QRUtil.G15<<QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)}return(data<<10|d)^QRUtil.G15_MASK},getBCHTypeNumber:function(data){var d=data<<12;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)>=0){d^=QRUtil.G18<<QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)}return data<<12|d},getBCHDigit:function(data){var digit=0;while(data!=0){digit++;data>>>=1}return digit},getPatternPosition:function(typeNumber){return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1]},getMask:function(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2==0;case QRMaskPattern.PATTERN001:return i%2==0;case QRMaskPattern.PATTERN010:return j%3==0;case QRMaskPattern.PATTERN011:return(i+j)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case QRMaskPattern.PATTERN101:return i*j%2+i*j%3==0;case QRMaskPattern.PATTERN110:return(i*j%2+i*j%3)%2==0;case QRMaskPattern.PATTERN111:return(i*j%3+(i+j)%2)%2==0;default:throw new Error("bad maskPattern:"+maskPattern)}},getErrorCorrectPolynomial:function(errorCorrectLength){var a=new QRPolynomial([1],0);for(var i=0;i<errorCorrectLength;i++){a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0))}return a},getLengthInBits:function(mode,type){if(1<=type&&type<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+mode)}}else if(type<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+mode)}}else if(type<41){switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+mode)}}else{throw new Error("type:"+type)}},getLostPoint:function(qrCode){var moduleCount=qrCode.getModuleCount();var lostPoint=0;for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount;col++){var sameCount=0;var dark=qrCode.isDark(row,col);for(var r=-1;r<=1;r++){if(row+r<0||moduleCount<=row+r){continue}for(var c=-1;c<=1;c++){if(col+c<0||moduleCount<=col+c){continue}if(r==0&&c==0){continue}if(dark==qrCode.isDark(row+r,col+c)){sameCount++}}}if(sameCount>5){lostPoint+=3+sameCount-5}}}for(var row=0;row<moduleCount-1;row++){for(var col=0;col<moduleCount-1;col++){var count=0;if(qrCode.isDark(row,col))count++;if(qrCode.isDark(row+1,col))count++;if(qrCode.isDark(row,col+1))count++;if(qrCode.isDark(row+1,col+1))count++;if(count==0||count==4){lostPoint+=3}}}for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount-6;col++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row,col+1)&&qrCode.isDark(row,col+2)&&qrCode.isDark(row,col+3)&&qrCode.isDark(row,col+4)&&!qrCode.isDark(row,col+5)&&qrCode.isDark(row,col+6)){lostPoint+=40}}}for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount-6;row++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row+1,col)&&qrCode.isDark(row+2,col)&&qrCode.isDark(row+3,col)&&qrCode.isDark(row+4,col)&&!qrCode.isDark(row+5,col)&&qrCode.isDark(row+6,col)){lostPoint+=40}}}var darkCount=0;for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount;row++){if(qrCode.isDark(row,col)){darkCount++}}}var ratio=Math.abs(100*darkCount/moduleCount/moduleCount-50)/5;lostPoint+=ratio*10;return lostPoint}};var QRMath={glog:function(n){if(n<1){throw new Error("glog("+n+")")}return QRMath.LOG_TABLE[n]},gexp:function(n){while(n<0){n+=255}while(n>=256){n-=255}return QRMath.EXP_TABLE[n]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i}for(var i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8]}for(var i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i}function QRPolynomial(num,shift){if(num.length==undefined){throw new Error(num.length+"/"+shift)}var offset=0;while(offset<num.length&&num[offset]==0){offset++}this.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++){this.num[i]=num[i+offset]}}QRPolynomial.prototype={get:function(index){return this.num[index]},getLength:function(){return this.num.length},multiply:function(e){var num=new Array(this.getLength()+e.getLength()-1);for(var i=0;i<this.getLength();i++){for(var j=0;j<e.getLength();j++){num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)))}}return new QRPolynomial(num,0)},mod:function(e){if(this.getLength()-e.getLength()<0){return this}var ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));var num=new Array(this.getLength());for(var i=0;i<this.getLength();i++){num[i]=this.get(i)}for(var i=0;i<e.getLength();i++){num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio)}return new QRPolynomial(num,0).mod(e)}};function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount}QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];QRRSBlock.getRSBlocks=function(typeNumber,errorCorrectLevel){var rsBlock=QRRSBlock.getRsBlockTable(typeNumber,errorCorrectLevel);
if(rsBlock==undefined){throw new Error("bad rs block @ typeNumber:"+typeNumber+"/errorCorrectLevel:"+errorCorrectLevel)}var length=rsBlock.length/3;var list=[];for(var i=0;i<length;i++){var count=rsBlock[i*3+0];var totalCount=rsBlock[i*3+1];var dataCount=rsBlock[i*3+2];for(var j=0;j<count;j++){list.push(new QRRSBlock(totalCount,dataCount))}}return list};QRRSBlock.getRsBlockTable=function(typeNumber,errorCorrectLevel){switch(errorCorrectLevel){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+3];default:return undefined}};function QRBitBuffer(){this.buffer=[];this.length=0}QRBitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return(this.buffer[bufIndex]>>>7-index%8&1)==1},put:function(num,length){for(var i=0;i<length;i++){this.putBit((num>>>length-i-1&1)==1)}},getLengthInBits:function(){return this.length},putBit:function(bit){var bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0)}if(bit){this.buffer[bufIndex]|=128>>>this.length%8}this.length++}};var QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];function _isSupportCanvas(){return typeof CanvasRenderingContext2D!="undefined"}function _getAndroid(){var android=false;var sAgent=navigator.userAgent;if(/android/i.test(sAgent)){android=true;aMat=sAgent.toString().match(/android ([0-9]\.[0-9])/i);if(aMat&&aMat[1]){android=parseFloat(aMat[1])}}return android}var svgDrawer=function(){var Drawing=function(el,htOption){this._el=el;this._htOption=htOption};Drawing.prototype.draw=function(oQRCode){var _htOption=this._htOption;var _el=this._el;var nCount=oQRCode.getModuleCount();var nWidth=Math.floor(_htOption.width/nCount);var nHeight=Math.floor(_htOption.height/nCount);this.clear();function makeSVG(tag,attrs){var el=document.createElementNS("http://www.w3.org/2000/svg",tag);for(var k in attrs)if(attrs.hasOwnProperty(k))el.setAttribute(k,attrs[k]);return el}var svg=makeSVG("svg",{viewBox:"0 0 "+String(nCount)+" "+String(nCount),width:"100%",height:"100%",fill:_htOption.colorLight});svg.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");_el.appendChild(svg);svg.appendChild(makeSVG("rect",{fill:_htOption.colorDark,width:"1",height:"1",id:"template"}));for(var row=0;row<nCount;row++){for(var col=0;col<nCount;col++){if(oQRCode.isDark(row,col)){var child=makeSVG("use",{x:String(row),y:String(col)});child.setAttributeNS("http://www.w3.org/1999/xlink","href","#template");svg.appendChild(child)}}}};Drawing.prototype.clear=function(){while(this._el.hasChildNodes())this._el.removeChild(this._el.lastChild)};return Drawing}();var useSVG=false;var Drawing=useSVG?svgDrawer:!_isSupportCanvas()?function(){var Drawing=function(el,htOption){this._el=el;this._htOption=htOption};Drawing.prototype.draw=function(oQRCode){var _htOption=this._htOption;var _el=this._el;var nCount=oQRCode.getModuleCount();var nWidth=Math.floor(_htOption.width/nCount);var nHeight=Math.floor(_htOption.height/nCount);var aHTML=['<table style="border:0;border-collapse:collapse;">'];for(var row=0;row<nCount;row++){aHTML.push("<tr>");for(var col=0;col<nCount;col++){aHTML.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+nWidth+"px;height:"+nHeight+"px;background-color:"+(oQRCode.isDark(row,col)?_htOption.colorDark:_htOption.colorLight)+';"></td>')}aHTML.push("</tr>")}aHTML.push("</table>");_el.innerHTML=aHTML.join("");var elTable=_el.childNodes[0];var nLeftMarginTable=(_htOption.width-elTable.offsetWidth)/2;var nTopMarginTable=(_htOption.height-elTable.offsetHeight)/2;if(nLeftMarginTable>0&&nTopMarginTable>0){elTable.style.margin=nTopMarginTable+"px "+nLeftMarginTable+"px"}};Drawing.prototype.clear=function(){this._el.innerHTML=""};return Drawing}():function(){function _onMakeImage(){this._elImage.src=this._elCanvas.toDataURL("image/png");this._elImage.style.display="block";this._elCanvas.style.display="none"}if(this._android&&this._android<=2.1){var factor=1/window.devicePixelRatio;var drawImage=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(image,sx,sy,sw,sh,dx,dy,dw,dh){if("nodeName"in image&&/img/i.test(image.nodeName)){for(var i=arguments.length-1;i>=1;i--){arguments[i]=arguments[i]*factor}}else if(typeof dw=="undefined"){arguments[1]*=factor;arguments[2]*=factor;arguments[3]*=factor;arguments[4]*=factor}drawImage.apply(this,arguments)}}function _safeSetDataURI(fSuccess,fFail){var self=this;self._fFail=fFail;self._fSuccess=fSuccess;if(self._bSupportDataURI===null){var el=document.createElement("img");var fOnError=function(){self._bSupportDataURI=false;if(self._fFail){_fFail.call(self)}};var fOnSuccess=function(){self._bSupportDataURI=true;if(self._fSuccess){self._fSuccess.call(self)}};el.onabort=fOnError;el.onerror=fOnError;el.onload=fOnSuccess;el.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==";return}else if(self._bSupportDataURI===true&&self._fSuccess){self._fSuccess.call(self)}else if(self._bSupportDataURI===false&&self._fFail){self._fFail.call(self)}}var Drawing=function(el,htOption){this._bIsPainted=false;this._android=_getAndroid();this._htOption=htOption;this._elCanvas=document.createElement("canvas");this._elCanvas.width=htOption.width;this._elCanvas.height=htOption.height;el.appendChild(this._elCanvas);this._el=el;this._oContext=this._elCanvas.getContext("2d");this._bIsPainted=false;this._elImage=document.createElement("img");this._elImage.alt="Scan me!";this._elImage.style.display="none";this._el.appendChild(this._elImage);this._bSupportDataURI=null};Drawing.prototype.draw=function(oQRCode){var _elImage=this._elImage;var _oContext=this._oContext;var _htOption=this._htOption;var nCount=oQRCode.getModuleCount();var nWidth=_htOption.width/nCount;var nHeight=_htOption.height/nCount;var nRoundedWidth=Math.round(nWidth);var nRoundedHeight=Math.round(nHeight);_elImage.style.display="none";this.clear();for(var row=0;row<nCount;row++){for(var col=0;col<nCount;col++){var bIsDark=oQRCode.isDark(row,col);var nLeft=col*nWidth;var nTop=row*nHeight;_oContext.strokeStyle=bIsDark?_htOption.colorDark:_htOption.colorLight;_oContext.lineWidth=1;_oContext.fillStyle=bIsDark?_htOption.colorDark:_htOption.colorLight;_oContext.fillRect(nLeft,nTop,nWidth,nHeight);_oContext.strokeRect(Math.floor(nLeft)+.5,Math.floor(nTop)+.5,nRoundedWidth,nRoundedHeight);_oContext.strokeRect(Math.ceil(nLeft)-.5,Math.ceil(nTop)-.5,nRoundedWidth,nRoundedHeight)}}this._bIsPainted=true};Drawing.prototype.makeImage=function(){if(this._bIsPainted){_safeSetDataURI.call(this,_onMakeImage)}};Drawing.prototype.isPainted=function(){return this._bIsPainted};Drawing.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height);this._bIsPainted=false};Drawing.prototype.round=function(nNumber){if(!nNumber){return nNumber}return Math.floor(nNumber*1e3)/1e3};return Drawing}();function _getTypeNumber(sText,nCorrectLevel){var nType=1;var length=_getUTF8Length(sText);for(var i=0,len=QRCodeLimitLength.length;i<=len;i++){var nLimit=0;switch(nCorrectLevel){case QRErrorCorrectLevel.L:nLimit=QRCodeLimitLength[i][0];break;case QRErrorCorrectLevel.M:nLimit=QRCodeLimitLength[i][1];break;case QRErrorCorrectLevel.Q:nLimit=QRCodeLimitLength[i][2];break;case QRErrorCorrectLevel.H:nLimit=QRCodeLimitLength[i][3];break}if(length<=nLimit){break}else{nType++}}if(nType>QRCodeLimitLength.length){throw new Error("Too long data")}return nType}function _getUTF8Length(sText){var replacedText=encodeURI(sText).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return replacedText.length+(replacedText.length!=sText?3:0)}QRCode=function(el,vOption){this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRErrorCorrectLevel.H};if(typeof vOption==="string"){vOption={text:vOption}}if(vOption){for(var i in vOption){this._htOption[i]=vOption[i]}}if(typeof el=="string"){el=document.getElementById(el)}this._android=_getAndroid();this._el=el;this._oQRCode=null;this._oDrawing=new Drawing(this._el,this._htOption);if(this._htOption.text){this.makeCode(this._htOption.text)}};QRCode.prototype.makeCode=function(sText){this._oQRCode=new QRCodeModel(_getTypeNumber(sText,this._htOption.correctLevel),this._htOption.correctLevel);this._oQRCode.addData(sText);this._oQRCode.make();this._el.title=sText;this._oDrawing.draw(this._oQRCode);this.makeImage()};QRCode.prototype.makeImage=function(){if(typeof this._oDrawing.makeImage=="function"&&(!this._android||this._android>=3)){this._oDrawing.makeImage()}};QRCode.prototype.clear=function(){this._oDrawing.clear()};QRCode.CorrectLevel=QRErrorCorrectLevel})();(function(root){"use strict";var ALIGNMENT_DELTA=[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28];var DEFAULT_MIME="image/png";var DOWNLOAD_MIME="image/octet-stream";var ECC_BLOCKS=[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30];var ECC_LEVELS={L:1,M:2,Q:3,H:4};var FINAL_FORMAT=[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107];var GALOIS_EXPONENT=[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0];var GALOIS_LOG=[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175];var N1=3;var N2=3;var N3=40;var N4=10;var VERSION_BLOCK=[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177];var WRITE_MODE=parseInt("0666",8);var badBuffer=[];var Canvas;var dataBlock;var eccBlock,neccBlock1,neccBlock2;var eccBuffer=[];var eccLevel=1;var frameBuffer=[];var frameMask=[];var fs;var Image;var inNode=false;var polynomial=[];var previousQr=root.qr;var stringBuffer=[];var version;var width;function createCanvas(){return inNode?new Canvas:root.document.createElement("canvas")}function createImage(){return inNode?new Image:root.document.createElement("img")}function download(cvs,data,callback){var mime=data.mime||DEFAULT_MIME;root.location.href=cvs.toDataURL(mime).replace(mime,DOWNLOAD_MIME);if(typeof callback==="function")callback()}function normalizeData(data){if(typeof data==="string")data={value:data};return data||{}}function overrideAPI(qr){var methods=["canvas","image","save","saveSync","toDataURL"];var i;function overrideMethod(name){qr[name]=function(){throw new Error(name+" requires HTML5 canvas element support")}}for(i=0;i<methods.length;i++){overrideMethod(methods[i])}}function writeFile(cvs,data,callback){if(typeof data.path!=="string"){return callback(new TypeError("Invalid path type: "+typeof data.path))}var fd,buff;function writeBuffer(){fs.write(fd,buff,0,buff.length,0,function(error){fs.close(fd);callback(error)})}cvs.toBuffer(function(error,_buff){if(error)return callback(error);buff=_buff;if(fd){writeBuffer()}});fs.open(data.path,"w",WRITE_MODE,function(error,_fd){if(error)return callback(error);fd=_fd;if(buff){writeBuffer()}})}function writeFileSync(cvs,data){if(typeof data.path!=="string"){throw new TypeError("Invalid path type: "+typeof data.path)}var buff=cvs.toBuffer();var fd=fs.openSync(data.path,"w",WRITE_MODE);try{fs.writeSync(fd,buff,0,buff.length,0)}finally{fs.closeSync(fd)}}function setMask(x,y){var bit;if(x>y){bit=x;x=y;y=bit}bit=y;bit*=y;bit+=y;bit>>=1;bit+=x;frameMask[bit]=1}function addAlignment(x,y){var i;frameBuffer[x+width*y]=1;for(i=-2;i<2;i++){frameBuffer[x+i+width*(y-2)]=1;frameBuffer[x-2+width*(y+i+1)]=1;frameBuffer[x+2+width*(y+i)]=1;frameBuffer[x+i+1+width*(y+2)]=1}for(i=0;i<2;i++){setMask(x-1,y+i);setMask(x+1,y-i);setMask(x-i,y-1);setMask(x+i,y+1)}}function modN(x){while(x>=255){x-=255;x=(x>>8)+(x&255)}return x}function appendData(data,dataLength,ecc,eccLength){var bit,i,j;for(i=0;i<eccLength;i++){stringBuffer[ecc+i]=0}for(i=0;i<dataLength;i++){bit=GALOIS_LOG[stringBuffer[data+i]^stringBuffer[ecc]];if(bit!==255){for(j=1;j<eccLength;j++){stringBuffer[ecc+j-1]=stringBuffer[ecc+j]^GALOIS_EXPONENT[modN(bit+polynomial[eccLength-j])]}}else{for(j=ecc;j<ecc+eccLength;j++){stringBuffer[j]=stringBuffer[j+1]}}stringBuffer[ecc+eccLength-1]=bit===255?0:GALOIS_EXPONENT[modN(bit+polynomial[0])]}}function isMasked(x,y){var bit;if(x>y){bit=x;x=y;y=bit}bit=y;bit+=y*y;bit>>=1;bit+=x;return frameMask[bit]===1}function applyMask(mask){var x,y,r3x,r3y;switch(mask){case 0:for(y=0;y<width;y++){for(x=0;x<width;x++){if(!(x+y&1)&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 1:for(y=0;y<width;y++){for(x=0;x<width;x++){if(!(y&1)&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 2:for(y=0;y<width;y++){for(r3x=0,x=0;x<width;x++,r3x++){if(r3x===3)r3x=0;if(!r3x&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 3:for(r3y=0,y=0;y<width;y++,r3y++){if(r3y===3)r3y=0;for(r3x=r3y,x=0;x<width;x++,r3x++){if(r3x===3)r3x=0;if(!r3x&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 4:for(y=0;y<width;y++){for(r3x=0,r3y=y>>1&1,x=0;x<width;x++,r3x++){if(r3x===3){r3x=0;r3y=!r3y}if(!r3y&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 5:for(r3y=0,y=0;y<width;y++,r3y++){if(r3y===3)r3y=0;for(r3x=0,x=0;x<width;x++,r3x++){if(r3x===3)r3x=0;if(!((x&y&1)+!(!r3x|!r3y))&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 6:for(r3y=0,y=0;y<width;y++,r3y++){if(r3y===3)r3y=0;for(r3x=0,x=0;x<width;x++,r3x++){if(r3x===3)r3x=0;if(!((x&y&1)+(r3x&&r3x===r3y)&1)&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break;case 7:for(r3y=0,y=0;y<width;y++,r3y++){if(r3y===3)r3y=0;for(r3x=0,x=0;x<width;x++,r3x++){if(r3x===3)r3x=0;if(!((r3x&&r3x===r3y)+(x+y&1)&1)&&!isMasked(x,y)){frameBuffer[x+y*width]^=1}}}break}}function getBadRuns(length){var badRuns=0;var i;for(i=0;i<=length;i++){if(badBuffer[i]>=5){badRuns+=N1+badBuffer[i]-5}}for(i=3;i<length-1;i+=2){if(badBuffer[i-2]===badBuffer[i+2]&&badBuffer[i+2]===badBuffer[i-1]&&badBuffer[i-1]===badBuffer[i+1]&&badBuffer[i-1]*3===badBuffer[i]&&(badBuffer[i-3]===0||i+3>length||badBuffer[i-3]*3>=badBuffer[i]*4||badBuffer[i+3]*3>=badBuffer[i]*4)){badRuns+=N3}}return badRuns}function checkBadness(){var b,b1,bad,big,bw,count,h,x,y;bad=bw=count=0;for(y=0;y<width-1;y++){for(x=0;x<width-1;x++){if(frameBuffer[x+width*y]&&frameBuffer[x+1+width*y]&&frameBuffer[x+width*(y+1)]&&frameBuffer[x+1+width*(y+1)]||!(frameBuffer[x+width*y]||frameBuffer[x+1+width*y]||frameBuffer[x+width*(y+1)]||frameBuffer[x+1+width*(y+1)])){bad+=N2}}}for(y=0;y<width;y++){badBuffer[0]=0;for(h=b=x=0;x<width;x++){if((b1=frameBuffer[x+width*y])===b){badBuffer[h]++}else{badBuffer[++h]=1}b=b1;bw+=b?1:-1}bad+=getBadRuns(h)}if(bw<0)bw=-bw;big=bw;big+=big<<2;big<<=1;while(big>width*width){big-=width*width;count++}bad+=count*N4;for(x=0;x<width;x++){badBuffer[0]=0;for(h=b=y=0;y<width;y++){if((b1=frameBuffer[x+width*y])===b){badBuffer[h]++}else{badBuffer[++h]=1}b=b1}bad+=getBadRuns(h)}return bad}function generateFrame(str){var i,j,k,m,t,v,x,y;t=str.length;version=0;do{version++;k=(eccLevel-1)*4+(version-1)*16;neccBlock1=ECC_BLOCKS[k++];neccBlock2=ECC_BLOCKS[k++];dataBlock=ECC_BLOCKS[k++];eccBlock=ECC_BLOCKS[k];k=dataBlock*(neccBlock1+neccBlock2)+neccBlock2-3+(version<=9);if(t<=k)break}while(version<40);width=17+4*version;v=dataBlock+(dataBlock+eccBlock)*(neccBlock1+neccBlock2)+neccBlock2;for(t=0;t<v;t++){eccBuffer[t]=0}stringBuffer=str.slice(0);for(t=0;t<width*width;t++){frameBuffer[t]=0}for(t=0;t<(width*(width+1)+1)/2;t++){frameMask[t]=0}for(t=0;t<3;t++){k=y=0;if(t===1)k=width-7;if(t===2)y=width-7;frameBuffer[y+3+width*(k+3)]=1;for(x=0;x<6;x++){frameBuffer[y+x+width*k]=1;frameBuffer[y+width*(k+x+1)]=1;frameBuffer[y+6+width*(k+x)]=1;frameBuffer[y+x+1+width*(k+6)]=1}for(x=1;x<5;x++){setMask(y+x,k+1);setMask(y+1,k+x+1);setMask(y+5,k+x);setMask(y+x+1,k+5)}for(x=2;x<4;x++){frameBuffer[y+x+width*(k+2)]=1;frameBuffer[y+2+width*(k+x+1)]=1;frameBuffer[y+4+width*(k+x)]=1;frameBuffer[y+x+1+width*(k+4)]=1}}if(version>1){t=ALIGNMENT_DELTA[version];y=width-7;for(;;){x=width-7;while(x>t-3){addAlignment(x,y);if(x<t)break;x-=t}if(y<=t+9)break;y-=t;addAlignment(6,y);addAlignment(y,6)}}frameBuffer[8+width*(width-8)]=1;for(y=0;y<7;y++){setMask(7,y);setMask(width-8,y);setMask(7,y+width-7)}for(x=0;x<8;x++){setMask(x,7);setMask(x+width-8,7);setMask(x,width-8)}for(x=0;x<9;x++){setMask(x,8)}for(x=0;x<8;x++){setMask(x+width-8,8);setMask(8,x)}for(y=0;y<7;y++){setMask(8,y+width-7)}for(x=0;x<width-14;x++){if(x&1){setMask(8+x,6);setMask(6,8+x)}else{frameBuffer[8+x+width*6]=1;frameBuffer[6+width*(8+x)]=1}}if(version>6){t=VERSION_BLOCK[version-7];k=17;for(x=0;x<6;x++){for(y=0;y<3;y++,k--){if(1&(k>11?version>>k-12:t>>k)){frameBuffer[5-x+width*(2-y+width-11)]=1;frameBuffer[2-y+width-11+width*(5-x)]=1}else{setMask(5-x,2-y+width-11);setMask(2-y+width-11,5-x)}}}}for(y=0;y<width;y++){for(x=0;x<=y;x++){if(frameBuffer[x+width*y]){setMask(x,y)}}}v=stringBuffer.length;for(i=0;i<v;i++){eccBuffer[i]=stringBuffer.charCodeAt(i)}stringBuffer=eccBuffer.slice(0);x=dataBlock*(neccBlock1+neccBlock2)+neccBlock2;if(v>=x-2){v=x-2;if(version>9)v--}i=v;if(version>9){stringBuffer[i+2]=0;stringBuffer[i+3]=0;while(i--){t=stringBuffer[i];stringBuffer[i+3]|=255&t<<4;stringBuffer[i+2]=t>>4}stringBuffer[2]|=255&v<<4;stringBuffer[1]=v>>4;stringBuffer[0]=64|v>>12}else{stringBuffer[i+1]=0;stringBuffer[i+2]=0;while(i--){t=stringBuffer[i];stringBuffer[i+2]|=255&t<<4;stringBuffer[i+1]=t>>4}stringBuffer[1]|=255&v<<4;stringBuffer[0]=64|v>>4}i=v+3-(version<10);while(i<x){stringBuffer[i++]=236;stringBuffer[i++]=17}polynomial[0]=1;for(i=0;i<eccBlock;i++){polynomial[i+1]=1;for(j=i;j>0;j--){polynomial[j]=polynomial[j]?polynomial[j-1]^GALOIS_EXPONENT[modN(GALOIS_LOG[polynomial[j]]+i)]:polynomial[j-1]}polynomial[0]=GALOIS_EXPONENT[modN(GALOIS_LOG[polynomial[0]]+i)]}for(i=0;i<=eccBlock;i++){polynomial[i]=GALOIS_LOG[polynomial[i]]}k=x;y=0;for(i=0;i<neccBlock1;i++){appendData(y,dataBlock,k,eccBlock);y+=dataBlock;k+=eccBlock}for(i=0;i<neccBlock2;i++){appendData(y,dataBlock+1,k,eccBlock);y+=dataBlock+1;k+=eccBlock}y=0;for(i=0;i<dataBlock;i++){for(j=0;j<neccBlock1;j++){eccBuffer[y++]=stringBuffer[i+j*dataBlock]}for(j=0;j<neccBlock2;j++){eccBuffer[y++]=stringBuffer[neccBlock1*dataBlock+i+j*(dataBlock+1)]}}for(j=0;j<neccBlock2;j++){eccBuffer[y++]=stringBuffer[neccBlock1*dataBlock+i+j*(dataBlock+1)]}for(i=0;i<eccBlock;i++){for(j=0;j<neccBlock1+neccBlock2;j++){eccBuffer[y++]=stringBuffer[x+i+j*eccBlock]}}stringBuffer=eccBuffer;x=y=width-1;k=v=1;m=(dataBlock+eccBlock)*(neccBlock1+neccBlock2)+neccBlock2;for(i=0;i<m;i++){t=stringBuffer[i];for(j=0;j<8;j++,t<<=1){if(128&t){frameBuffer[x+width*y]=1}do{if(v){x--}else{x++;if(k){if(y!==0){y--}else{x-=2;k=!k;if(x===6){x--;y=9}}}else{if(y!==width-1){y++}else{x-=2;k=!k;if(x===6){x--;y-=8}}}}v=!v}while(isMasked(x,y))}}stringBuffer=frameBuffer.slice(0);t=0;y=3e4;for(k=0;k<8;k++){applyMask(k);x=checkBadness();if(x<y){y=x;t=k}if(t===7)break;frameBuffer=stringBuffer.slice(0)}if(t!==k){applyMask(t)}y=FINAL_FORMAT[t+(eccLevel-1<<3)];for(k=0;k<8;k++,y>>=1){if(y&1){frameBuffer[width-1-k+width*8]=1;if(k<6){frameBuffer[8+width*k]=1}else{frameBuffer[8+width*(k+1)]=1}}}for(k=0;k<7;k++,y>>=1){if(y&1){frameBuffer[8+width*(width-7+k)]=1;if(k){frameBuffer[6-k+width*8]=1}else{frameBuffer[7+width*8]=1}}}return frameBuffer}var qr={VERSION:"1.1.3",canvas:function(data){data=normalizeData(data);var size=data.size>=1&&data.size<=10?data.size:4;size*=25;var cvs=data.canvas||createCanvas();var c2d=cvs.getContext("2d");c2d.canvas.width=size;c2d.canvas.height=size;c2d.fillStyle=data.background||"#fff";c2d.fillRect(0,0,size,size);eccLevel=ECC_LEVELS[data.level&&data.level.toUpperCase()||"L"];var frame=generateFrame(data.value||"");c2d.lineWidth=1;var px=size;px/=width;px=Math.floor(px);c2d.clearRect(0,0,size,size);c2d.fillStyle=data.background||"#fff";c2d.fillRect(0,0,px*(width+8),px*(width+8));c2d.fillStyle=data.foreground||"#000";var i,j;for(i=0;i<width;i++){for(j=0;j<width;j++){if(frame[j*width+i]){c2d.fillRect(px*i,px*j,px,px)}}}return cvs},image:function(data){data=normalizeData(data);var cvs=this.canvas(data);var img=data.image||createImage();img.src=cvs.toDataURL(data.mime||DEFAULT_MIME);img.height=cvs.height;img.width=cvs.width;return img},save:function(data,path,callback){data=normalizeData(data);switch(typeof path){case"function":callback=path;path=null;break;case"string":data.path=path;break}if(typeof callback!=="function"){throw new TypeError("Invalid callback type: "+typeof callback)}var completed=false;var cvs=this.canvas(data);function done(error){if(!completed){completed=true;callback(error)}}if(inNode){writeFile(cvs,data,done)}else{download(cvs,data,done)}},saveSync:function(data,path){data=normalizeData(data);if(typeof path==="string")data.path=path;var cvs=this.canvas(data);if(inNode){writeFileSync(cvs,data)}else{download(cvs,data)}},toDataURL:function(data){data=normalizeData(data);return this.canvas(data).toDataURL(data.mime||DEFAULT_MIME)},noConflict:function(){root.qr=previousQr;return this}};if(typeof exports!=="undefined"){inNode=true;if(typeof module!=="undefined"&&module.exports){exports=module.exports=qr}exports.qr=qr;Canvas=require("canvas");Image=Canvas.Image;fs=require("fs")}else if(typeof define==="function"&&define.amd){define(function(){return qr})}else{if(!root.HTMLCanvasElement){overrideAPI(qr)}root.qr=qr}})(this);(function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err}var module=require.modules[resolved];if(!module._resolving&&!module.exports){var mod={};mod.exports={};mod.client=mod.component=true;module._resolving=true;module.call(this,mod.exports,require.relative(resolved),mod);delete module._resolving;module.exports=mod.exports}return module.exports}require.modules={};require.aliases={};require.resolve=function(path){if(path.charAt(0)==="/")path=path.slice(1);var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"];for(var i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,definition){require.modules[path]=definition};require.alias=function(from,to){if(!require.modules.hasOwnProperty(from)){throw new Error('Failed to alias "'+from+'", it does not exist')}require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path};localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))};return localRequire};require.register("component-emitter/index.js",function(exports,require,module){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}});require.register("RedVentures-reduce/index.js",function(exports,require,module){module.exports=function(arr,fn,initial){var idx=0;var len=arr.length;var curr=arguments.length==3?initial:arr[idx++];while(idx<len){curr=fn.call(null,curr,arr[idx],++idx,arr)}return curr}});require.register("superagent/lib/client.js",function(exports,require,module){var Emitter=require("emitter");var reduce=require("reduce");var root="undefined"==typeof window?this:window;function noop(){}function isHost(obj){var str={}.toString.call(obj);switch(str){case"[object File]":case"[object Blob]":case"[object FormData]":return true;default:return false}}function getXHR(){if(root.XMLHttpRequest&&("file:"!=root.location.protocol||!root.ActiveXObject)){return new XMLHttpRequest}else{try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}}return false}var trim="".trim?function(s){return s.trim()}:function(s){return s.replace(/(^\s*|\s*$)/g,"")};function isObject(obj){return obj===Object(obj)}function serialize(obj){if(!isObject(obj))return obj;var pairs=[];for(var key in obj){if(null!=obj[key]){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}}return pairs.join("&")}request.serializeObject=serialize;function parseString(str){var obj={};var pairs=str.split("&");var parts;var pair;for(var i=0,len=pairs.length;i<len;++i){pair=pairs[i];parts=pair.split("=");obj[decodeURIComponent(parts[0])]=decodeURIComponent(parts[1])}return obj}request.parseString=parseString;request.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"};request.serialize={"application/x-www-form-urlencoded":serialize,"application/json":JSON.stringify};request.parse={"application/x-www-form-urlencoded":parseString,"application/json":JSON.parse};function parseHeader(str){var lines=str.split(/\r?\n/);var fields={};var index;var line;var field;var val;lines.pop();for(var i=0,len=lines.length;i<len;++i){line=lines[i];index=line.indexOf(":");field=line.slice(0,index).toLowerCase();val=trim(line.slice(index+1));fields[field]=val}return fields}function type(str){return str.split(/ *; */).shift()}function params(str){return reduce(str.split(/ *; */),function(obj,str){var parts=str.split(/ *= */),key=parts.shift(),val=parts.shift();if(key&&val)obj[key]=val;return obj},{})}function Response(req,options){options=options||{};
this.req=req;this.xhr=this.req.xhr;this.text=this.xhr.responseText;this.setStatusProperties(this.xhr.status);this.header=this.headers=parseHeader(this.xhr.getAllResponseHeaders());this.header["content-type"]=this.xhr.getResponseHeader("content-type");this.setHeaderProperties(this.header);this.body=this.req.method!="HEAD"?this.parseBody(this.text):null}Response.prototype.get=function(field){return this.header[field.toLowerCase()]};Response.prototype.setHeaderProperties=function(header){var ct=this.header["content-type"]||"";this.type=type(ct);var obj=params(ct);for(var key in obj)this[key]=obj[key]};Response.prototype.parseBody=function(str){var parse=request.parse[this.type];return parse?parse(str):null};Response.prototype.setStatusProperties=function(status){var type=status/100|0;this.status=status;this.statusType=type;this.info=1==type;this.ok=2==type;this.clientError=4==type;this.serverError=5==type;this.error=4==type||5==type?this.toError():false;this.accepted=202==status;this.noContent=204==status||1223==status;this.badRequest=400==status;this.unauthorized=401==status;this.notAcceptable=406==status;this.notFound=404==status;this.forbidden=403==status};Response.prototype.toError=function(){var req=this.req;var method=req.method;var path=req.path;var msg="cannot "+method+" "+path+" ("+this.status+")";var err=new Error(msg);err.status=this.status;err.method=method;err.path=path;return err};request.Response=Response;function Request(method,url){var self=this;Emitter.call(this);this._query=this._query||[];this.method=method;this.url=url;this.header={};this._header={};this.on("end",function(){var res=new Response(self);if("HEAD"==method)res.text=null;self.callback(null,res)})}Emitter(Request.prototype);Request.prototype.timeout=function(ms){this._timeout=ms;return this};Request.prototype.clearTimeout=function(){this._timeout=0;clearTimeout(this._timer);return this};Request.prototype.abort=function(){if(this.aborted)return;this.aborted=true;this.xhr.abort();this.clearTimeout();this.emit("abort");return this};Request.prototype.set=function(field,val){if(isObject(field)){for(var key in field){this.set(key,field[key])}return this}this._header[field.toLowerCase()]=val;this.header[field]=val;return this};Request.prototype.getHeader=function(field){return this._header[field.toLowerCase()]};Request.prototype.type=function(type){this.set("Content-Type",request.types[type]||type);return this};Request.prototype.accept=function(type){this.set("Accept",request.types[type]||type);return this};Request.prototype.auth=function(user,pass){var str=btoa(user+":"+pass);this.set("Authorization","Basic "+str);return this};Request.prototype.query=function(val){if("string"!=typeof val)val=serialize(val);if(val)this._query.push(val);return this};Request.prototype.send=function(data){var obj=isObject(data);var type=this.getHeader("Content-Type");if(obj&&isObject(this._data)){for(var key in data){this._data[key]=data[key]}}else if("string"==typeof data){if(!type)this.type("form");type=this.getHeader("Content-Type");if("application/x-www-form-urlencoded"==type){this._data=this._data?this._data+"&"+data:data}else{this._data=(this._data||"")+data}}else{this._data=data}if(!obj)return this;if(!type)this.type("json");return this};Request.prototype.callback=function(err,res){var fn=this._callback;if(2==fn.length)return fn(err,res);if(err)return this.emit("error",err);fn(res)};Request.prototype.crossDomainError=function(){var err=new Error("Origin is not allowed by Access-Control-Allow-Origin");err.crossDomain=true;this.callback(err)};Request.prototype.timeoutError=function(){var timeout=this._timeout;var err=new Error("timeout of "+timeout+"ms exceeded");err.timeout=timeout;this.callback(err)};Request.prototype.withCredentials=function(){this._withCredentials=true;return this};Request.prototype.end=function(fn){var self=this;var xhr=this.xhr=getXHR();var query=this._query.join("&");var timeout=this._timeout;var data=this._data;this._callback=fn||noop;xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(0==xhr.status){if(self.aborted)return self.timeoutError();return self.crossDomainError()}self.emit("end")};if(xhr.upload){xhr.upload.onprogress=function(e){e.percent=e.loaded/e.total*100;self.emit("progress",e)}}if(timeout&&!this._timer){this._timer=setTimeout(function(){self.abort()},timeout)}if(query){query=request.serializeObject(query);this.url+=~this.url.indexOf("?")?"&"+query:"?"+query}xhr.open(this.method,this.url,true);if(this._withCredentials)xhr.withCredentials=true;if("GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof data&&!isHost(data)){var serialize=request.serialize[this.getHeader("Content-Type")];if(serialize)data=serialize(data)}for(var field in this.header){if(null==this.header[field])continue;xhr.setRequestHeader(field,this.header[field])}xhr.send(data);return this};request.Request=Request;function request(method,url){if("function"==typeof url){return new Request("GET",method).end(url)}if(1==arguments.length){return new Request("GET",method)}return new Request(method,url)}request.get=function(url,data,fn){var req=request("GET",url);if("function"==typeof data)fn=data,data=null;if(data)req.query(data);if(fn)req.end(fn);return req};request.head=function(url,data,fn){var req=request("HEAD",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.del=function(url,fn){var req=request("DELETE",url);if(fn)req.end(fn);return req};request.patch=function(url,data,fn){var req=request("PATCH",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.post=function(url,data,fn){var req=request("POST",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};request.put=function(url,data,fn){var req=request("PUT",url);if("function"==typeof data)fn=data,data=null;if(data)req.send(data);if(fn)req.end(fn);return req};module.exports=request});require.alias("component-emitter/index.js","superagent/deps/emitter/index.js");require.alias("component-emitter/index.js","emitter/index.js");require.alias("RedVentures-reduce/index.js","superagent/deps/reduce/index.js");require.alias("RedVentures-reduce/index.js","reduce/index.js");require.alias("superagent/lib/client.js","superagent/index.js");if(typeof exports=="object"){module.exports=require("superagent")}else if(typeof define=="function"&&define.amd){define(function(){return require("superagent")})}else{this["superagent"]=require("superagent")}})();"use strict";var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(message){this.toString=function(){return"CORRUPT: "+this.message};this.message=message},invalid:function(message){this.toString=function(){return"INVALID: "+this.message};this.message=message},bug:function(message){this.toString=function(){return"BUG: "+this.message};this.message=message},notReady:function(message){this.toString=function(){return"NOT READY: "+this.message};this.message=message}}};if(typeof module!="undefined"&&module.exports){module.exports=sjcl}sjcl.cipher.aes=function(key){if(!this._tables[0][0][0]){this._precompute()}var i,j,tmp,encKey,decKey,sbox=this._tables[0][4],decTable=this._tables[1],keyLen=key.length,rcon=1;if(keyLen!==4&&keyLen!==6&&keyLen!==8){throw new sjcl.exception.invalid("invalid aes key size")}this._key=[encKey=key.slice(0),decKey=[]];for(i=keyLen;i<4*keyLen+28;i++){tmp=encKey[i-1];if(i%keyLen===0||keyLen===8&&i%keyLen===4){tmp=sbox[tmp>>>24]<<24^sbox[tmp>>16&255]<<16^sbox[tmp>>8&255]<<8^sbox[tmp&255];if(i%keyLen===0){tmp=tmp<<8^tmp>>>24^rcon<<24;rcon=rcon<<1^(rcon>>7)*283}}encKey[i]=encKey[i-keyLen]^tmp}for(j=0;i;j++,i--){tmp=encKey[j&3?i:i-4];if(i<=4||j<4){decKey[j]=tmp}else{decKey[j]=decTable[0][sbox[tmp>>>24]]^decTable[1][sbox[tmp>>16&255]]^decTable[2][sbox[tmp>>8&255]]^decTable[3][sbox[tmp&255]]}}};sjcl.cipher.aes.prototype={encrypt:function(data){return this._crypt(data,0)},decrypt:function(data){return this._crypt(data,1)},_tables:[[[],[],[],[],[]],[[],[],[],[],[]]],_precompute:function(){var encTable=this._tables[0],decTable=this._tables[1],sbox=encTable[4],sboxInv=decTable[4],i,x,xInv,d=[],th=[],x2,x4,x8,s,tEnc,tDec;for(i=0;i<256;i++){th[(d[i]=i<<1^(i>>7)*283)^i]=i}for(x=xInv=0;!sbox[x];x^=x2||1,xInv=th[xInv]||1){s=xInv^xInv<<1^xInv<<2^xInv<<3^xInv<<4;s=s>>8^s&255^99;sbox[x]=s;sboxInv[s]=x;x8=d[x4=d[x2=d[x]]];tDec=x8*16843009^x4*65537^x2*257^x*16843008;tEnc=d[s]*257^s*16843008;for(i=0;i<4;i++){encTable[i][x]=tEnc=tEnc<<24^tEnc>>>8;decTable[i][s]=tDec=tDec<<24^tDec>>>8}}for(i=0;i<5;i++){encTable[i]=encTable[i].slice(0);decTable[i]=decTable[i].slice(0)}},_crypt:function(input,dir){if(input.length!==4){throw new sjcl.exception.invalid("invalid aes block size")}var key=this._key[dir],a=input[0]^key[0],b=input[dir?3:1]^key[1],c=input[2]^key[2],d=input[dir?1:3]^key[3],a2,b2,c2,nInnerRounds=key.length/4-2,i,kIndex=4,out=[0,0,0,0],table=this._tables[dir],t0=table[0],t1=table[1],t2=table[2],t3=table[3],sbox=table[4];for(i=0;i<nInnerRounds;i++){a2=t0[a>>>24]^t1[b>>16&255]^t2[c>>8&255]^t3[d&255]^key[kIndex];b2=t0[b>>>24]^t1[c>>16&255]^t2[d>>8&255]^t3[a&255]^key[kIndex+1];c2=t0[c>>>24]^t1[d>>16&255]^t2[a>>8&255]^t3[b&255]^key[kIndex+2];d=t0[d>>>24]^t1[a>>16&255]^t2[b>>8&255]^t3[c&255]^key[kIndex+3];kIndex+=4;a=a2;b=b2;c=c2}for(i=0;i<4;i++){out[dir?3&-i:i]=sbox[a>>>24]<<24^sbox[b>>16&255]<<16^sbox[c>>8&255]<<8^sbox[d&255]^key[kIndex++];a2=a;a=b;b=c;c=d;d=a2}return out}};sjcl.bitArray={bitSlice:function(a,bstart,bend){a=sjcl.bitArray._shiftRight(a.slice(bstart/32),32-(bstart&31)).slice(1);return bend===undefined?a:sjcl.bitArray.clamp(a,bend-bstart)},extract:function(a,bstart,blength){var x,sh=Math.floor(-bstart-blength&31);if((bstart+blength-1^bstart)&-32){x=a[bstart/32|0]<<32-sh^a[bstart/32+1|0]>>>sh}else{x=a[bstart/32|0]>>>sh}return x&(1<<blength)-1},concat:function(a1,a2){if(a1.length===0||a2.length===0){return a1.concat(a2)}var out,i,last=a1[a1.length-1],shift=sjcl.bitArray.getPartial(last);if(shift===32){return a1.concat(a2)}else{return sjcl.bitArray._shiftRight(a2,shift,last|0,a1.slice(0,a1.length-1))}},bitLength:function(a){var l=a.length,x;if(l===0){return 0}x=a[l-1];return(l-1)*32+sjcl.bitArray.getPartial(x)},clamp:function(a,len){if(a.length*32<len){return a}a=a.slice(0,Math.ceil(len/32));var l=a.length;len=len&31;if(l>0&&len){a[l-1]=sjcl.bitArray.partial(len,a[l-1]&2147483648>>len-1,1)}return a},partial:function(len,x,_end){if(len===32){return x}return(_end?x|0:x<<32-len)+len*1099511627776},getPartial:function(x){return Math.round(x/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b)){return false}var x=0,i;for(i=0;i<a.length;i++){x|=a[i]^b[i]}return x===0},_shiftRight:function(a,shift,carry,out){var i,last2=0,shift2;if(out===undefined){out=[]}for(;shift>=32;shift-=32){out.push(carry);carry=0}if(shift===0){return out.concat(a)}for(i=0;i<a.length;i++){out.push(carry|a[i]>>>shift);carry=a[i]<<32-shift}last2=a.length?a[a.length-1]:0;shift2=sjcl.bitArray.getPartial(last2);out.push(sjcl.bitArray.partial(shift+shift2&31,shift+shift2>32?carry:out.pop(),1));return out},_xor4:function(x,y){return[x[0]^y[0],x[1]^y[1],x[2]^y[2],x[3]^y[3]]}};sjcl.codec.utf8String={fromBits:function(arr){var out="",bl=sjcl.bitArray.bitLength(arr),i,tmp;for(i=0;i<bl/8;i++){if((i&3)===0){tmp=arr[i/4]}out+=String.fromCharCode(tmp>>>24);tmp<<=8}return decodeURIComponent(escape(out))},toBits:function(str){str=unescape(encodeURIComponent(str));var out=[],i,tmp=0;for(i=0;i<str.length;i++){tmp=tmp<<8|str.charCodeAt(i);if((i&3)===3){out.push(tmp);tmp=0}}if(i&3){out.push(sjcl.bitArray.partial(8*(i&3),tmp))}return out}};sjcl.codec.base64={_chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(arr,_noEquals,_url){var out="",i,bits=0,c=sjcl.codec.base64._chars,ta=0,bl=sjcl.bitArray.bitLength(arr);if(_url)c=c.substr(0,62)+"-_";for(i=0;out.length*6<bl;){out+=c.charAt((ta^arr[i]>>>bits)>>>26);if(bits<6){ta=arr[i]<<6-bits;bits+=26;i++}else{ta<<=6;bits-=6}}while(out.length&3&&!_noEquals){out+="="}return out},toBits:function(str,_url){str=str.replace(/\s|=/g,"");var out=[],i,bits=0,c=sjcl.codec.base64._chars,ta=0,x;if(_url)c=c.substr(0,62)+"-_";for(i=0;i<str.length;i++){x=c.indexOf(str.charAt(i));if(x<0){throw new sjcl.exception.invalid("this isn't base64!")}if(bits>26){bits-=26;out.push(ta^x>>>bits);ta=x<<32-bits}else{bits+=6;ta^=x<<32-bits}}if(bits&56){out.push(sjcl.bitArray.partial(bits&56,ta,1))}return out}};sjcl.codec.base64url={fromBits:function(arr){return sjcl.codec.base64.fromBits(arr,1,1)},toBits:function(str){return sjcl.codec.base64.toBits(str,1)}};sjcl.hash.sha256=function(hash){if(!this._key[0]){this._precompute()}if(hash){this._h=hash._h.slice(0);this._buffer=hash._buffer.slice(0);this._length=hash._length}else{this.reset()}};sjcl.hash.sha256.hash=function(data){return(new sjcl.hash.sha256).update(data).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this._h=this._init.slice(0);this._buffer=[];this._length=0;return this},update:function(data){if(typeof data==="string"){data=sjcl.codec.utf8String.toBits(data)}var i,b=this._buffer=sjcl.bitArray.concat(this._buffer,data),ol=this._length,nl=this._length=ol+sjcl.bitArray.bitLength(data);for(i=512+ol&-512;i<=nl;i+=512){this._block(b.splice(0,16))}return this},finalize:function(){var i,b=this._buffer,h=this._h;b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(i=b.length+2;i&15;i++){b.push(0)}b.push(Math.floor(this._length/4294967296));b.push(this._length|0);while(b.length){this._block(b.splice(0,16))}this.reset();return h},_init:[],_key:[],_precompute:function(){var i=0,prime=2,factor;function frac(x){return(x-Math.floor(x))*4294967296|0}outer:for(;i<64;prime++){for(factor=2;factor*factor<=prime;factor++){if(prime%factor===0){continue outer}}if(i<8){this._init[i]=frac(Math.pow(prime,1/2))}this._key[i]=frac(Math.pow(prime,1/3));i++}},_block:function(words){var i,tmp,a,b,w=words.slice(0),h=this._h,k=this._key,h0=h[0],h1=h[1],h2=h[2],h3=h[3],h4=h[4],h5=h[5],h6=h[6],h7=h[7];for(i=0;i<64;i++){if(i<16){tmp=w[i]}else{a=w[i+1&15];b=w[i+14&15];tmp=w[i&15]=(a>>>7^a>>>18^a>>>3^a<<25^a<<14)+(b>>>17^b>>>19^b>>>10^b<<15^b<<13)+w[i&15]+w[i+9&15]|0}tmp=tmp+h7+(h4>>>6^h4>>>11^h4>>>25^h4<<26^h4<<21^h4<<7)+(h6^h4&(h5^h6))+k[i];h7=h6;h6=h5;h5=h4;h4=h3+tmp|0;h3=h2;h2=h1;h1=h0;h0=tmp+(h1&h2^h3&(h1^h2))+(h1>>>2^h1>>>13^h1>>>22^h1<<30^h1<<19^h1<<10)|0}h[0]=h[0]+h0|0;h[1]=h[1]+h1|0;h[2]=h[2]+h2|0;h[3]=h[3]+h3|0;h[4]=h[4]+h4|0;h[5]=h[5]+h5|0;h[6]=h[6]+h6|0;h[7]=h[7]+h7|0}};sjcl.mode.gcm={name:"gcm",encrypt:function(prf,plaintext,iv,adata,tlen){var out,data=plaintext.slice(0),w=sjcl.bitArray;tlen=tlen||128;adata=adata||[];out=sjcl.mode.gcm._ctrMode(true,prf,data,adata,iv,tlen);return w.concat(out.data,out.tag)},decrypt:function(prf,ciphertext,iv,adata,tlen){var out,data=ciphertext.slice(0),tag,w=sjcl.bitArray,l=w.bitLength(data);tlen=tlen||128;adata=adata||[];if(tlen<=l){tag=w.bitSlice(data,l-tlen);data=w.bitSlice(data,0,l-tlen)}else{tag=data;data=[]}out=sjcl.mode.gcm._ctrMode(false,prf,data,adata,iv,tlen);if(!w.equal(out.tag,tag)){throw new sjcl.exception.corrupt("gcm: tag doesn't match")}return out.data},_galoisMultiply:function(x,y){var i,j,xi,Zi,Vi,lsb_Vi,w=sjcl.bitArray,xor=w._xor4;Zi=[0,0,0,0];Vi=y.slice(0);for(i=0;i<128;i++){xi=(x[Math.floor(i/32)]&1<<31-i%32)!==0;if(xi){Zi=xor(Zi,Vi)}lsb_Vi=(Vi[3]&1)!==0;for(j=3;j>0;j--){Vi[j]=Vi[j]>>>1|(Vi[j-1]&1)<<31}Vi[0]=Vi[0]>>>1;if(lsb_Vi){Vi[0]=Vi[0]^225<<24}}return Zi},_ghash:function(H,Y0,data){var Yi,i,l=data.length;Yi=Y0.slice(0);for(i=0;i<l;i+=4){Yi[0]^=4294967295&data[i];Yi[1]^=4294967295&data[i+1];Yi[2]^=4294967295&data[i+2];Yi[3]^=4294967295&data[i+3];Yi=sjcl.mode.gcm._galoisMultiply(Yi,H)}return Yi},_ctrMode:function(encrypt,prf,data,adata,iv,tlen){var H,J0,S0,enc,i,ctr,tag,last,l,bl,abl,ivbl,w=sjcl.bitArray,xor=w._xor4;l=data.length;bl=w.bitLength(data);abl=w.bitLength(adata);ivbl=w.bitLength(iv);H=prf.encrypt([0,0,0,0]);if(ivbl===96){J0=iv.slice(0);J0=w.concat(J0,[1])}else{J0=sjcl.mode.gcm._ghash(H,[0,0,0,0],iv);J0=sjcl.mode.gcm._ghash(H,J0,[0,0,Math.floor(ivbl/4294967296),ivbl&4294967295])}S0=sjcl.mode.gcm._ghash(H,[0,0,0,0],adata);ctr=J0.slice(0);tag=S0.slice(0);if(!encrypt){tag=sjcl.mode.gcm._ghash(H,S0,data)}for(i=0;i<l;i+=4){ctr[3]++;enc=prf.encrypt(ctr);data[i]^=enc[0];data[i+1]^=enc[1];data[i+2]^=enc[2];data[i+3]^=enc[3]}data=w.clamp(data,bl);if(encrypt){tag=sjcl.mode.gcm._ghash(H,S0,data)}last=[Math.floor(abl/4294967296),abl&4294967295,Math.floor(bl/4294967296),bl&4294967295];tag=sjcl.mode.gcm._ghash(H,tag,last);enc=prf.encrypt(J0);tag[0]^=enc[0];tag[1]^=enc[1];tag[2]^=enc[2];tag[3]^=enc[3];return{tag:w.bitSlice(tag,0,tlen),data:data}}};sjcl.misc.hmac=function(key,Hash){this._hash=Hash=Hash||sjcl.hash.sha256;var exKey=[[],[]],i,bs=Hash.prototype.blockSize/32;this._baseHash=[new Hash,new Hash];if(key.length>bs){key=Hash.hash(key)}for(i=0;i<bs;i++){exKey[0][i]=key[i]^909522486;exKey[1][i]=key[i]^1549556828}this._baseHash[0].update(exKey[0]);this._baseHash[1].update(exKey[1])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(data,encoding){var w=new this._hash(this._baseHash[0]).update(data,encoding).finalize();return new this._hash(this._baseHash[1]).update(w).finalize()};sjcl.misc.pbkdf2=function(password,salt,count,length,Prff){count=count||1e3;if(length<0||count<0){throw sjcl.exception.invalid("invalid params to pbkdf2")}if(typeof password==="string"){password=sjcl.codec.utf8String.toBits(password)}Prff=Prff||sjcl.misc.hmac;var prf=new Prff(password),u,ui,i,j,k,out=[],b=sjcl.bitArray;for(k=1;32*out.length<(length||1);k++){u=ui=prf.encrypt(b.concat(salt,[k]));for(i=1;i<count;i++){ui=prf.encrypt(ui);for(j=0;j<ui.length;j++){u[j]^=ui[j]}}out=out.concat(u)}if(length){out=b.clamp(out,length)}return out};sjcl.random={randomWords:function(nwords,paranoia){var out=[],i,readiness=this.isReady(paranoia),g;if(readiness===this._NOT_READY){throw new sjcl.exception.notReady("generator isn't seeded")}else if(readiness&this._REQUIRES_RESEED){this._reseedFromPools(!(readiness&this._READY))}for(i=0;i<nwords;i+=4){if((i+1)%this._MAX_WORDS_PER_BURST===0){this._gate()}g=this._gen4words();out.push(g[0],g[1],g[2],g[3])}this._gate();return out.slice(0,nwords)},setDefaultParanoia:function(paranoia){this._defaultParanoia=paranoia},addEntropy:function(data,estimatedEntropy,source){source=source||"user";var id,i,tmp,t=(new Date).valueOf(),robin=this._robins[source],oldReady=this.isReady(),err=0;id=this._collectorIds[source];if(id===undefined){id=this._collectorIds[source]=this._collectorIdNext++}if(robin===undefined){robin=this._robins[source]=0}this._robins[source]=(this._robins[source]+1)%this._pools.length;switch(typeof data){case"number":if(estimatedEntropy===undefined){estimatedEntropy=1}this._pools[robin].update([id,this._eventId++,1,estimatedEntropy,t,1,data|0]);break;case"object":var objName=Object.prototype.toString.call(data);if(objName==="[object Uint32Array]"){tmp=[];for(i=0;i<data.length;i++){tmp.push(data[i])}data=tmp}else{if(objName!=="[object Array]"){err=1}for(i=0;i<data.length&&!err;i++){if(typeof data[i]!="number"){err=1}}}if(!err){if(estimatedEntropy===undefined){estimatedEntropy=0;for(i=0;i<data.length;i++){tmp=data[i];while(tmp>0){estimatedEntropy++;tmp=tmp>>>1}}}this._pools[robin].update([id,this._eventId++,2,estimatedEntropy,t,data.length].concat(data))}break;case"string":if(estimatedEntropy===undefined){estimatedEntropy=data.length}this._pools[robin].update([id,this._eventId++,3,estimatedEntropy,t,data.length]);this._pools[robin].update(data);break;default:err=1}if(err){throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string")}this._poolEntropy[robin]+=estimatedEntropy;this._poolStrength+=estimatedEntropy;if(oldReady===this._NOT_READY){if(this.isReady()!==this._NOT_READY){this._fireEvent("seeded",Math.max(this._strength,this._poolStrength))}this._fireEvent("progress",this.getProgress())}},isReady:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[paranoia!==undefined?paranoia:this._defaultParanoia];if(this._strength&&this._strength>=entropyRequired){return this._poolEntropy[0]>this._BITS_PER_RESEED&&(new Date).valueOf()>this._nextReseed?this._REQUIRES_RESEED|this._READY:this._READY}else{return this._poolStrength>=entropyRequired?this._REQUIRES_RESEED|this._NOT_READY:this._NOT_READY}},getProgress:function(paranoia){var entropyRequired=this._PARANOIA_LEVELS[paranoia?paranoia:this._defaultParanoia];if(this._strength>=entropyRequired){return 1}else{return this._poolStrength>entropyRequired?1:this._poolStrength/entropyRequired}},startCollectors:function(){if(this._collectorsStarted){return}if(window.addEventListener){window.addEventListener("load",this._loadTimeCollector,false);window.addEventListener("mousemove",this._mouseCollector,false)}else if(document.attachEvent){document.attachEvent("onload",this._loadTimeCollector);document.attachEvent("onmousemove",this._mouseCollector)}else{throw new sjcl.exception.bug("can't attach event")}this._collectorsStarted=true},stopCollectors:function(){if(!this._collectorsStarted){return}if(window.removeEventListener){window.removeEventListener("load",this._loadTimeCollector,false);window.removeEventListener("mousemove",this._mouseCollector,false)}else if(window.detachEvent){window.detachEvent("onload",this._loadTimeCollector);window.detachEvent("onmousemove",this._mouseCollector)}this._collectorsStarted=false},addEventListener:function(name,callback){this._callbacks[name][this._callbackI++]=callback},removeEventListener:function(name,cb){var i,j,cbs=this._callbacks[name],jsTemp=[];for(j in cbs){if(cbs.hasOwnProperty(j)&&cbs[j]===cb){jsTemp.push(j)}}for(i=0;i<jsTemp.length;i++){j=jsTemp[i];delete cbs[j]}},_pools:[new sjcl.hash.sha256],_poolEntropy:[0],_reseedCount:0,_robins:{},_eventId:0,_collectorIds:{},_collectorIdNext:0,_strength:0,_poolStrength:0,_nextReseed:0,_key:[0,0,0,0,0,0,0,0],_counter:[0,0,0,0],_cipher:undefined,_defaultParanoia:6,_collectorsStarted:false,_callbacks:{progress:{},seeded:{}},_callbackI:0,_NOT_READY:0,_READY:1,_REQUIRES_RESEED:2,_MAX_WORDS_PER_BURST:65536,_PARANOIA_LEVELS:[0,48,64,96,128,192,256,384,512,768,1024],_MILLISECONDS_PER_RESEED:3e4,_BITS_PER_RESEED:80,_gen4words:function(){for(var i=0;i<4;i++){this._counter[i]=this._counter[i]+1|0;if(this._counter[i]){break}}return this._cipher.encrypt(this._counter)},_gate:function(){this._key=this._gen4words().concat(this._gen4words());this._cipher=new sjcl.cipher.aes(this._key)},_reseed:function(seedWords){this._key=sjcl.hash.sha256.hash(this._key.concat(seedWords));this._cipher=new sjcl.cipher.aes(this._key);for(var i=0;i<4;i++){this._counter[i]=this._counter[i]+1|0;if(this._counter[i]){break}}},_reseedFromPools:function(full){var reseedData=[],strength=0,i;this._nextReseed=reseedData[0]=(new Date).valueOf()+this._MILLISECONDS_PER_RESEED;for(i=0;i<16;i++){reseedData.push(Math.random()*4294967296|0)}for(i=0;i<this._pools.length;i++){reseedData=reseedData.concat(this._pools[i].finalize());strength+=this._poolEntropy[i];this._poolEntropy[i]=0;if(!full&&this._reseedCount&1<<i){break}}if(this._reseedCount>=1<<this._pools.length){this._pools.push(new sjcl.hash.sha256);this._poolEntropy.push(0)}this._poolStrength-=strength;if(strength>this._strength){this._strength=strength}this._reseedCount++;this._reseed(reseedData)},_mouseCollector:function(ev){var x=ev.x||ev.clientX||ev.offsetX,y=ev.y||ev.clientY||ev.offsetY;sjcl.random.addEntropy([x,y],2,"mouse")},_loadTimeCollector:function(ev){sjcl.random.addEntropy((new Date).valueOf(),2,"loadtime")},_fireEvent:function(name,arg){var j,cbs=sjcl.random._callbacks[name],cbsTemp=[];for(j in cbs){if(cbs.hasOwnProperty(j)){cbsTemp.push(cbs[j])}}for(j=0;j<cbsTemp.length;j++){cbsTemp[j](arg)}}};(function(){try{var ab=new Uint32Array(32);crypto.getRandomValues(ab);sjcl.random.addEntropy(ab,1024,"crypto.getRandomValues")}catch(e){}})();sjcl.json={defaults:{v:1,iter:1e3,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},encrypt:function(password,plaintext,params,rp){params=params||{};rp=rp||{};var j=sjcl.json,p=j._add({iv:sjcl.random.randomWords(4,0)},j.defaults),tmp,prp,adata;j._add(p,params);adata=p.adata;if(typeof p.salt==="string"){p.salt=sjcl.codec.base64.toBits(p.salt)}if(typeof p.iv==="string"){p.iv=sjcl.codec.base64.toBits(p.iv)}if(!sjcl.mode[p.mode]||!sjcl.cipher[p.cipher]||typeof password==="string"&&p.iter<=100||p.ts!==64&&p.ts!==96&&p.ts!==128||p.ks!==128&&p.ks!==192&&p.ks!==256||(p.iv.length<2||p.iv.length>4)){throw new sjcl.exception.invalid("json encrypt: invalid parameters")}if(typeof password==="string"){tmp=sjcl.misc.cachedPbkdf2(password,p);password=tmp.key.slice(0,p.ks/32);p.salt=tmp.salt}else if(sjcl.ecc&&password instanceof sjcl.ecc.elGamal.publicKey){tmp=password.kem();p.kemtag=tmp.tag;password=tmp.key.slice(0,p.ks/32)}if(typeof plaintext==="string"){plaintext=sjcl.codec.utf8String.toBits(plaintext)}if(typeof adata==="string"){adata=sjcl.codec.utf8String.toBits(adata)}prp=new sjcl.cipher[p.cipher](password);j._add(rp,p);rp.key=password;p.ct=sjcl.mode[p.mode].encrypt(prp,plaintext,p.iv,adata,p.ts);return j.encode(p)},decrypt:function(password,ciphertext,params,rp){params=params||{};rp=rp||{};var j=sjcl.json,p=j._add(j._add(j._add({},j.defaults),j.decode(ciphertext)),params,true),ct,tmp,prp,adata=p.adata;if(typeof p.salt==="string"){p.salt=sjcl.codec.base64.toBits(p.salt)}if(typeof p.iv==="string"){p.iv=sjcl.codec.base64.toBits(p.iv)}if(!sjcl.mode[p.mode]||!sjcl.cipher[p.cipher]||typeof password==="string"&&p.iter<=100||p.ts!==64&&p.ts!==96&&p.ts!==128||p.ks!==128&&p.ks!==192&&p.ks!==256||!p.iv||(p.iv.length<2||p.iv.length>4)){throw new sjcl.exception.invalid("json decrypt: invalid parameters")}if(typeof password==="string"){tmp=sjcl.misc.cachedPbkdf2(password,p);password=tmp.key.slice(0,p.ks/32);p.salt=tmp.salt}else if(sjcl.ecc&&password instanceof sjcl.ecc.elGamal.secretKey){password=password.unkem(sjcl.codec.base64.toBits(p.kemtag)).slice(0,p.ks/32)}if(typeof adata==="string"){adata=sjcl.codec.utf8String.toBits(adata)}prp=new sjcl.cipher[p.cipher](password);ct=sjcl.mode[p.mode].decrypt(prp,p.ct,p.iv,adata,p.ts);j._add(rp,p);rp.key=password;return sjcl.codec.utf8String.fromBits(ct)},encode:function(obj){var i,out="{",comma="";for(i in obj){if(obj.hasOwnProperty(i)){if(!i.match(/^[a-z0-9]+$/i)){throw new sjcl.exception.invalid("json encode: invalid property name")}out+=comma+'"'+i+'":';comma=",";switch(typeof obj[i]){case"number":case"boolean":out+=obj[i];break;case"string":out+='"'+escape(obj[i])+'"';break;case"object":out+='"'+sjcl.codec.base64.fromBits(obj[i],1)+'"';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}}return out+"}"},decode:function(str){str=str.replace(/\s/g,"");if(!str.match(/^\{.*\}$/)){throw new sjcl.exception.invalid("json decode: this isn't json!")}var a=str.replace(/^\{|\}$/g,"").split(/,/),out={},i,m;for(i=0;i<a.length;i++){if(!(m=a[i].match(/^(?:(["']?)([a-z][a-z0-9]*)\1):(?:(\d+)|"([a-z0-9+\/%*_.@=\-]*)")$/i))){throw new sjcl.exception.invalid("json decode: this isn't json!")}if(m[3]){out[m[2]]=parseInt(m[3],10)}else{out[m[2]]=m[2].match(/^(ct|salt|iv)$/)?sjcl.codec.base64.toBits(m[4]):unescape(m[4])}}return out},_add:function(target,src,requireSame){if(target===undefined){target={}}if(src===undefined){return target}var i;for(i in src){if(src.hasOwnProperty(i)){if(requireSame&&target[i]!==undefined&&target[i]!==src[i]){throw new sjcl.exception.invalid("required parameter overridden")}target[i]=src[i]}}return target},_subtract:function(plus,minus){var out={},i;for(i in plus){if(plus.hasOwnProperty(i)&&plus[i]!==minus[i]){out[i]=plus[i]}}return out},_filter:function(src,filter){var out={},i;for(i=0;i<filter.length;i++){if(src[filter[i]]!==undefined){out[filter[i]]=src[filter[i]]}}return out}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc._pbkdf2Cache={};sjcl.misc.cachedPbkdf2=function(password,obj){var cache=sjcl.misc._pbkdf2Cache,c,cp,str,salt,iter;obj=obj||{};iter=obj.iter||1e3;cp=cache[password]=cache[password]||{};c=cp[iter]=cp[iter]||{firstSalt:obj.salt&&obj.salt.length?obj.salt.slice(0):sjcl.random.randomWords(2,0)};salt=obj.salt===undefined?c.firstSalt:obj.salt;c[salt]=c[salt]||sjcl.misc.pbkdf2(password,salt,obj.iter);return{key:c[salt].slice(0),salt:salt.slice(0)}};sjcl.bn=function(it){this.initWith(it)};sjcl.bn.prototype={radix:24,maxMul:8,_class:sjcl.bn,copy:function(){return new this._class(this)},initWith:function(it){var i=0,k,n,l;switch(typeof it){case"object":this.limbs=it.limbs.slice(0);break;case"number":this.limbs=[it];this.normalize();break;case"string":it=it.replace(/^0x/,"");this.limbs=[];k=this.radix/4;for(i=0;i<it.length;i+=k){this.limbs.push(parseInt(it.substring(Math.max(it.length-i-k,0),it.length-i),16))}break;default:this.limbs=[0]}return this},equals:function(that){if(typeof that==="number"){that=new this._class(that)}var difference=0,i;this.fullReduce();that.fullReduce();for(i=0;i<this.limbs.length||i<that.limbs.length;i++){difference|=this.getLimb(i)^that.getLimb(i)}return difference===0},getLimb:function(i){return i>=this.limbs.length?0:this.limbs[i]},greaterEquals:function(that){if(typeof that==="number"){that=new this._class(that)}var less=0,greater=0,i,a,b;i=Math.max(this.limbs.length,that.limbs.length)-1;for(;i>=0;i--){a=this.getLimb(i);b=that.getLimb(i);greater|=b-a&~less;less|=a-b&~greater}return(greater|~less)>>>31},toString:function(){this.fullReduce();var out="",i,s,l=this.limbs;for(i=0;i<this.limbs.length;i++){s=l[i].toString(16);while(i<this.limbs.length-1&&s.length<6){s="0"+s}out=s+out}return"0x"+out},addM:function(that){if(typeof that!=="object"){that=new this._class(that)}var i,l=this.limbs,ll=that.limbs;for(i=l.length;i<ll.length;i++){l[i]=0}for(i=0;i<ll.length;i++){l[i]+=ll[i]}return this},doubleM:function(){var i,carry=0,tmp,r=this.radix,m=this.radixMask,l=this.limbs;for(i=0;i<l.length;i++){tmp=l[i];tmp=tmp+tmp+carry;l[i]=tmp&m;carry=tmp>>r}if(carry){l.push(carry)}return this},halveM:function(){var i,carry=0,tmp,r=this.radix,l=this.limbs;for(i=l.length-1;i>=0;i--){tmp=l[i];l[i]=tmp+carry>>1;carry=(tmp&1)<<r}if(!l[l.length-1]){l.pop()}return this},subM:function(that){if(typeof that!=="object"){that=new this._class(that)}var i,l=this.limbs,ll=that.limbs;for(i=l.length;i<ll.length;i++){l[i]=0}for(i=0;i<ll.length;i++){l[i]-=ll[i]}return this},mod:function(that){that=new sjcl.bn(that).normalize();var out=new sjcl.bn(this).normalize(),ci=0;for(;out.greaterEquals(that);ci++){that.doubleM()}for(;ci>0;ci--){that.halveM();if(out.greaterEquals(that)){out.subM(that).normalize()}}return out.trim()},inverseMod:function(p){var a=new sjcl.bn(1),b=new sjcl.bn(0),x=new sjcl.bn(this),y=new sjcl.bn(p),tmp,i,nz=1;if(!(p.limbs[0]&1)){throw new sjcl.exception.invalid("inverseMod: p must be odd")}do{if(x.limbs[0]&1){if(!x.greaterEquals(y)){tmp=x;x=y;y=tmp;tmp=a;a=b;b=tmp}x.subM(y);x.normalize();if(!a.greaterEquals(b)){a.addM(p)}a.subM(b)}x.halveM();if(a.limbs[0]&1){a.addM(p)}a.normalize();a.halveM();for(i=nz=0;i<x.limbs.length;i++){nz|=x.limbs[i]}}while(nz);if(!y.equals(1)){throw new sjcl.exception.invalid("inverseMod: p and x must be relatively prime")}return b},add:function(that){return this.copy().addM(that)},sub:function(that){return this.copy().subM(that)},mul:function(that){if(typeof that==="number"){that=new this._class(that)}var i,j,a=this.limbs,b=that.limbs,al=a.length,bl=b.length,out=new this._class,c=out.limbs,ai,ii=this.maxMul;for(i=0;i<this.limbs.length+that.limbs.length+1;i++){c[i]=0}for(i=0;i<al;i++){ai=a[i];for(j=0;j<bl;j++){c[i+j]+=ai*b[j]}if(!--ii){ii=this.maxMul;out.cnormalize()}}return out.cnormalize().reduce()},square:function(){return this.mul(this)},power:function(l){if(typeof l==="number"){l=[l]}else if(l.limbs!==undefined){l=l.normalize().limbs}var i,j,out=new this._class(1),pow=this;for(i=0;i<l.length;i++){for(j=0;j<this.radix;j++){if(l[i]&1<<j){out=out.mul(pow)
}pow=pow.square()}}return out},mulmod:function(that,N){return this.mod(N).mul(that.mod(N)).mod(N)},powermod:function(x,N){var result=new sjcl.bn(1),a=new sjcl.bn(this),k=new sjcl.bn(x);while(true){if(k.limbs[0]&1){result=result.mulmod(a,N)}k.halveM();if(k.equals(0)){break}a=a.mulmod(a,N)}return result.normalize().reduce()},trim:function(){var l=this.limbs,p;do{p=l.pop()}while(l.length&&p===0);l.push(p);return this},reduce:function(){return this},fullReduce:function(){return this.normalize()},normalize:function(){var carry=0,i,pv=this.placeVal,ipv=this.ipv,l,m,limbs=this.limbs,ll=limbs.length,mask=this.radixMask;for(i=0;i<ll||carry!==0&&carry!==-1;i++){l=(limbs[i]||0)+carry;m=limbs[i]=l&mask;carry=(l-m)*ipv}if(carry===-1){limbs[i-1]-=this.placeVal}return this},cnormalize:function(){var carry=0,i,ipv=this.ipv,l,m,limbs=this.limbs,ll=limbs.length,mask=this.radixMask;for(i=0;i<ll-1;i++){l=limbs[i]+carry;m=limbs[i]=l&mask;carry=(l-m)*ipv}limbs[i]+=carry;return this},toBits:function(len){this.fullReduce();len=len||this.exponent||this.limbs.length*this.radix;var i=Math.floor((len-1)/24),w=sjcl.bitArray,e=(len+7&-8)%this.radix||this.radix,out=[w.partial(e,this.getLimb(i))];for(i--;i>=0;i--){out=w.concat(out,[w.partial(this.radix,this.getLimb(i))])}return out},bitLength:function(){this.fullReduce();var out=this.radix*(this.limbs.length-1),b=this.limbs[this.limbs.length-1];for(;b;b>>=1){out++}return out+7&-8}};sjcl.bn.fromBits=function(bits){var Class=this,out=new Class,words=[],w=sjcl.bitArray,t=this.prototype,l=Math.min(this.bitLength||4294967296,w.bitLength(bits)),e=l%t.radix||t.radix;words[0]=w.extract(bits,0,e);for(;e<l;e+=t.radix){words.unshift(w.extract(bits,e,t.radix))}out.limbs=words;return out};sjcl.bn.prototype.ipv=1/(sjcl.bn.prototype.placeVal=Math.pow(2,sjcl.bn.prototype.radix));sjcl.bn.prototype.radixMask=(1<<sjcl.bn.prototype.radix)-1;sjcl.bn.pseudoMersennePrime=function(exponent,coeff){function p(it){this.initWith(it)}var ppr=p.prototype=new sjcl.bn,i,tmp,mo;mo=ppr.modOffset=Math.ceil(tmp=exponent/ppr.radix);ppr.exponent=exponent;ppr.offset=[];ppr.factor=[];ppr.minOffset=mo;ppr.fullMask=0;ppr.fullOffset=[];ppr.fullFactor=[];ppr.modulus=p.modulus=new sjcl.bn(Math.pow(2,exponent));ppr.fullMask=0|-Math.pow(2,exponent%ppr.radix);for(i=0;i<coeff.length;i++){ppr.offset[i]=Math.floor(coeff[i][0]/ppr.radix-tmp);ppr.fullOffset[i]=Math.ceil(coeff[i][0]/ppr.radix-tmp);ppr.factor[i]=coeff[i][1]*Math.pow(1/2,exponent-coeff[i][0]+ppr.offset[i]*ppr.radix);ppr.fullFactor[i]=coeff[i][1]*Math.pow(1/2,exponent-coeff[i][0]+ppr.fullOffset[i]*ppr.radix);ppr.modulus.addM(new sjcl.bn(Math.pow(2,coeff[i][0])*coeff[i][1]));ppr.minOffset=Math.min(ppr.minOffset,-ppr.offset[i])}ppr._class=p;ppr.modulus.cnormalize();ppr.reduce=function(){var i,k,l,mo=this.modOffset,limbs=this.limbs,aff,off=this.offset,ol=this.offset.length,fac=this.factor,ll;i=this.minOffset;while(limbs.length>mo){l=limbs.pop();ll=limbs.length;for(k=0;k<ol;k++){limbs[ll+off[k]]-=fac[k]*l}i--;if(!i){limbs.push(0);this.cnormalize();i=this.minOffset}}this.cnormalize();return this};ppr._strongReduce=ppr.fullMask===-1?ppr.reduce:function(){var limbs=this.limbs,i=limbs.length-1,k,l;this.reduce();if(i===this.modOffset-1){l=limbs[i]&this.fullMask;limbs[i]-=l;for(k=0;k<this.fullOffset.length;k++){limbs[i+this.fullOffset[k]]-=this.fullFactor[k]*l}this.normalize()}};ppr.fullReduce=function(){var greater,i;this._strongReduce();this.addM(this.modulus);this.addM(this.modulus);this.normalize();this._strongReduce();for(i=this.limbs.length;i<this.modOffset;i++){this.limbs[i]=0}greater=this.greaterEquals(this.modulus);for(i=0;i<this.limbs.length;i++){this.limbs[i]-=this.modulus.limbs[i]*greater}this.cnormalize();return this};ppr.inverse=function(){return this.power(this.modulus.sub(2))};p.fromBits=sjcl.bn.fromBits;return p};sjcl.bn.prime={p127:sjcl.bn.pseudoMersennePrime(127,[[0,-1]]),p25519:sjcl.bn.pseudoMersennePrime(255,[[0,-19]]),p192:sjcl.bn.pseudoMersennePrime(192,[[0,-1],[64,-1]]),p224:sjcl.bn.pseudoMersennePrime(224,[[0,1],[96,-1]]),p256:sjcl.bn.pseudoMersennePrime(256,[[0,-1],[96,1],[192,1],[224,-1]]),p384:sjcl.bn.pseudoMersennePrime(384,[[0,-1],[32,1],[96,-1],[128,-1]]),p521:sjcl.bn.pseudoMersennePrime(521,[[0,-1]])};sjcl.bn.random=function(modulus,paranoia){if(typeof modulus!=="object"){modulus=new sjcl.bn(modulus)}var words,i,l=modulus.limbs.length,m=modulus.limbs[l-1]+1,out=new sjcl.bn;while(true){do{words=sjcl.random.randomWords(l,paranoia);if(words[l-1]<0){words[l-1]+=4294967296}}while(Math.floor(words[l-1]/m)===Math.floor(4294967296/m));words[l-1]%=m;for(i=0;i<l-1;i++){words[i]&=modulus.radixMask}out.limbs=words;if(!out.greaterEquals(modulus)){return out}}};sjcl.ecc={};sjcl.ecc.point=function(curve,x,y){if(x===undefined){this.isIdentity=true}else{this.x=x;this.y=y;this.isIdentity=false}this.curve=curve};sjcl.ecc.point.prototype={toJac:function(){return new sjcl.ecc.pointJac(this.curve,this.x,this.y,new this.curve.field(1))},mult:function(k){return this.toJac().mult(k,this).toAffine()},mult2:function(k,k2,affine2){return this.toJac().mult2(k,this,k2,affine2).toAffine()},multiples:function(){var m,i,j;if(this._multiples===undefined){j=this.toJac().doubl();m=this._multiples=[new sjcl.ecc.point(this.curve),this,j.toAffine()];for(i=3;i<16;i++){j=j.add(this);m.push(j.toAffine())}}return this._multiples},isValid:function(){return this.y.square().equals(this.curve.b.add(this.x.mul(this.curve.a.add(this.x.square()))))},toBits:function(){return sjcl.bitArray.concat(this.x.toBits(),this.y.toBits())}};sjcl.ecc.pointJac=function(curve,x,y,z){if(x===undefined){this.isIdentity=true}else{this.x=x;this.y=y;this.z=z;this.isIdentity=false}this.curve=curve};sjcl.ecc.pointJac.prototype={add:function(T){var S=this,sz2,c,d,c2,x1,x2,x,y1,y2,y,z;if(S.curve!==T.curve){throw"sjcl.ecc.add(): Points must be on the same curve to add them!"}if(S.isIdentity){return T.toJac()}else if(T.isIdentity){return S}sz2=S.z.square();c=T.x.mul(sz2).subM(S.x);if(c.equals(0)){if(S.y.equals(T.y.mul(sz2.mul(S.z)))){return S.doubl()}else{return new sjcl.ecc.pointJac(S.curve)}}d=T.y.mul(sz2.mul(S.z)).subM(S.y);c2=c.square();x1=d.square();x2=c.square().mul(c).addM(S.x.add(S.x).mul(c2));x=x1.subM(x2);y1=S.x.mul(c2).subM(x).mul(d);y2=S.y.mul(c.square().mul(c));y=y1.subM(y2);z=S.z.mul(c);return new sjcl.ecc.pointJac(this.curve,x,y,z)},doubl:function(){if(this.isIdentity){return this}var y2=this.y.square(),a=y2.mul(this.x.mul(4)),b=y2.square().mul(8),z2=this.z.square(),c=this.x.sub(z2).mul(3).mul(this.x.add(z2)),x=c.square().subM(a).subM(a),y=a.sub(x).mul(c).subM(b),z=this.y.add(this.y).mul(this.z);return new sjcl.ecc.pointJac(this.curve,x,y,z)},toAffine:function(){if(this.isIdentity||this.z.equals(0)){return new sjcl.ecc.point(this.curve)}var zi=this.z.inverse(),zi2=zi.square();return new sjcl.ecc.point(this.curve,this.x.mul(zi2).fullReduce(),this.y.mul(zi2.mul(zi)).fullReduce())},mult:function(k,affine){if(typeof k==="number"){k=[k]}else if(k.limbs!==undefined){k=k.normalize().limbs}var i,j,out=new sjcl.ecc.point(this.curve).toJac(),multiples=affine.multiples();for(i=k.length-1;i>=0;i--){for(j=sjcl.bn.prototype.radix-4;j>=0;j-=4){out=out.doubl().doubl().doubl().doubl().add(multiples[k[i]>>j&15])}}return out},mult2:function(k1,affine,k2,affine2){if(typeof k1==="number"){k1=[k1]}else if(k1.limbs!==undefined){k1=k1.normalize().limbs}if(typeof k2==="number"){k2=[k2]}else if(k2.limbs!==undefined){k2=k2.normalize().limbs}var i,j,out=new sjcl.ecc.point(this.curve).toJac(),m1=affine.multiples(),m2=affine2.multiples(),l1,l2;for(i=Math.max(k1.length,k2.length)-1;i>=0;i--){l1=k1[i]|0;l2=k2[i]|0;for(j=sjcl.bn.prototype.radix-4;j>=0;j-=4){out=out.doubl().doubl().doubl().doubl().add(m1[l1>>j&15]).add(m2[l2>>j&15])}}return out},isValid:function(){var z2=this.z.square(),z4=z2.square(),z6=z4.mul(z2);return this.y.square().equals(this.curve.b.mul(z6).add(this.x.mul(this.curve.a.mul(z4).add(this.x.square()))))}};sjcl.ecc.curve=function(Field,pMinusR,a,b,x,y){this.field=Field;this.r=Field.prototype.modulus.sub(pMinusR);this.a=new Field(a);this.b=new Field(b);this.G=new sjcl.ecc.point(this,new Field(x),new Field(y))};sjcl.ecc.curve.prototype.fromBits=function(bits){var w=sjcl.bitArray,l=this.field.prototype.exponent+7&-8,p=new sjcl.ecc.point(this,this.field.fromBits(w.bitSlice(bits,0,l)),this.field.fromBits(w.bitSlice(bits,l,2*l)));if(!p.isValid()){throw new sjcl.exception.corrupt("not on the curve!")}return p};sjcl.ecc.curves={c192:new sjcl.ecc.curve(sjcl.bn.prime.p192,"0x662107c8eb94364e4b2dd7ce",-3,"0x64210519e59c80e70fa7e9ab72243049feb8deecc146b9b1","0x188da80eb03090f67cbf20eb43a18800f4ff0afd82ff1012","0x07192b95ffc8da78631011ed6b24cdd573f977a11e794811"),c224:new sjcl.ecc.curve(sjcl.bn.prime.p224,"0xe95c1f470fc1ec22d6baa3a3d5c4",-3,"0xb4050a850c04b3abf54132565044b0b7d7bfd8ba270b39432355ffb4","0xb70e0cbd6bb4bf7f321390b94a03c1d356c21122343280d6115c1d21","0xbd376388b5f723fb4c22dfe6cd4375a05a07476444d5819985007e34"),c256:new sjcl.ecc.curve(sjcl.bn.prime.p256,"0x4319055358e8617b0c46353d039cdaae",-3,"0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b","0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296","0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5"),c384:new sjcl.ecc.curve(sjcl.bn.prime.p384,"0x389cb27e0bc8d21fa7e5f24cb74f58851313e696333ad68c",-3,"0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef","0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7","0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")};sjcl.ecc._dh=function(cn){sjcl.ecc[cn]={publicKey:function(curve_id,curve,point){this._curve=curve;if(point instanceof Array){this._point=curve.fromBits(point)}else{this._point=point}if(curve_id){this._curve_id=curve_id;this.serialize=function(){return{point:point.toBits(),curve:curve_id}}}},secretKey:function(curve_id,curve,exponent){this._curve=curve;this._exponent=exponent;if(curve_id){this._curve_id=curve_id;this.serialize=function(){return{exponent:exponent.toBits(),curve:curve_id}}}},generateKeys:function(curve,paranoia){var curve_id;if(curve===undefined){curve=256}if(typeof curve==="number"){curve_id=curve;curve=sjcl.ecc.curves["c"+curve];if(curve===undefined){throw new sjcl.exception.invalid("no such curve")}}var sec=sjcl.bn.random(curve.r,paranoia),pub=curve.G.mult(sec);return{pub:new sjcl.ecc[cn].publicKey(curve_id,curve,pub),sec:new sjcl.ecc[cn].secretKey(curve_id,curve,sec)}}}};sjcl.ecc._dh("elGamal");sjcl.ecc.elGamal.publicKey.prototype={kem:function(paranoia){var sec=sjcl.bn.random(this._curve.r,paranoia),tag=this._curve.G.mult(sec).toBits(),key=sjcl.hash.sha256.hash(this._point.mult(sec).toBits());return{key:key,tag:tag}}};sjcl.ecc.elGamal.secretKey.prototype={unkem:function(tag){return sjcl.hash.sha256.hash(this._curve.fromBits(tag).mult(this._exponent).toBits())},dh:function(pk){return sjcl.hash.sha256.hash(pk._point.mult(this._exponent).toBits())}};sjcl.ecc._dh("ecdsa");sjcl.ecc.ecdsa.secretKey.prototype={sign:function(hash,paranoia){var R=this._curve.r,l=R.bitLength(),k=sjcl.bn.random(R.sub(1),paranoia).add(1),r=this._curve.G.mult(k).x.mod(R),s=sjcl.bn.fromBits(hash).add(r.mul(this._exponent)).inverseMod(R).mul(k).mod(R);return sjcl.bitArray.concat(r.toBits(l),s.toBits(l))}};sjcl.ecc.ecdsa.publicKey.prototype={verify:function(hash,rs){var w=sjcl.bitArray,R=this._curve.r,l=R.bitLength(),r=sjcl.bn.fromBits(w.bitSlice(rs,0,l)),s=sjcl.bn.fromBits(w.bitSlice(rs,l,2*l)),hG=sjcl.bn.fromBits(hash).mul(s).mod(R),hA=r.mul(s).mod(R),r2=this._curve.G.mult2(hG,hA,this._point).x;if(r.equals(0)||s.equals(0)||r.greaterEquals(R)||s.greaterEquals(R)||!r2.equals(r)){throw new sjcl.exception.corrupt("signature didn't check out")}return true}};sjcl.codec.hex={fromBits:function(arr){var out="",i,x;for(i=0;i<arr.length;i++){out+=((arr[i]|0)+0xf00000000000).toString(16).substr(4)}return out.substr(0,sjcl.bitArray.bitLength(arr)/4)},toBits:function(str){var i,out=[],len;str=str.replace(/\s|0x/g,"");len=str.length;str=str+"00000000";for(i=0;i<str.length;i+=8){out.push(parseInt(str.substr(i,8),16)^0)}return sjcl.bitArray.clamp(out,len*4)}};!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.io=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":2}],2:[function(_dereq_,module,exports){var url=_dereq_("./url");var parser=_dereq_("socket.io-parser");var Manager=_dereq_("./manager");var debug=_dereq_("debug")("socket.io-client");module.exports=exports=lookup;var cache=exports.managers={};function lookup(uri,opts){if(typeof uri=="object"){opts=uri;uri=undefined}opts=opts||{};var parsed=url(uri);var source=parsed.source;var id=parsed.id;var io;if(opts.forceNew||opts["force new connection"]||false===opts.multiplex){debug("ignoring socket cache for %s",source);io=Manager(source,opts)}else{if(!cache[id]){debug("new io instance for %s",source);cache[id]=Manager(source,opts)}io=cache[id]}return io.socket(parsed.path)}exports.protocol=parser.protocol;exports.connect=lookup;exports.Manager=_dereq_("./manager");exports.Socket=_dereq_("./socket")},{"./manager":3,"./socket":5,"./url":6,debug:10,"socket.io-parser":46}],3:[function(_dereq_,module,exports){var url=_dereq_("./url");var eio=_dereq_("engine.io-client");var Socket=_dereq_("./socket");var Emitter=_dereq_("component-emitter");var parser=_dereq_("socket.io-parser");var on=_dereq_("./on");var bind=_dereq_("component-bind");var object=_dereq_("object-component");var debug=_dereq_("debug")("socket.io-client:manager");var indexOf=_dereq_("indexof");var Backoff=_dereq_("backo2");module.exports=Manager;function Manager(uri,opts){if(!(this instanceof Manager))return new Manager(uri,opts);if(uri&&"object"==typeof uri){opts=uri;uri=undefined}opts=opts||{};opts.path=opts.path||"/socket.io";this.nsps={};this.subs=[];this.opts=opts;this.reconnection(opts.reconnection!==false);this.reconnectionAttempts(opts.reconnectionAttempts||Infinity);this.reconnectionDelay(opts.reconnectionDelay||1e3);this.reconnectionDelayMax(opts.reconnectionDelayMax||5e3);this.randomizationFactor(opts.randomizationFactor||.5);this.backoff=new Backoff({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()});this.timeout(null==opts.timeout?2e4:opts.timeout);this.readyState="closed";this.uri=uri;this.connected=[];this.encoding=false;this.packetBuffer=[];this.encoder=new parser.Encoder;this.decoder=new parser.Decoder;this.autoConnect=opts.autoConnect!==false;if(this.autoConnect)this.open()}Manager.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var nsp in this.nsps){this.nsps[nsp].emit.apply(this.nsps[nsp],arguments)}};Manager.prototype.updateSocketIds=function(){for(var nsp in this.nsps){this.nsps[nsp].id=this.engine.id}};Emitter(Manager.prototype);Manager.prototype.reconnection=function(v){if(!arguments.length)return this._reconnection;this._reconnection=!!v;return this};Manager.prototype.reconnectionAttempts=function(v){if(!arguments.length)return this._reconnectionAttempts;this._reconnectionAttempts=v;return this};Manager.prototype.reconnectionDelay=function(v){if(!arguments.length)return this._reconnectionDelay;this._reconnectionDelay=v;this.backoff&&this.backoff.setMin(v);return this};Manager.prototype.randomizationFactor=function(v){if(!arguments.length)return this._randomizationFactor;this._randomizationFactor=v;this.backoff&&this.backoff.setJitter(v);return this};Manager.prototype.reconnectionDelayMax=function(v){if(!arguments.length)return this._reconnectionDelayMax;this._reconnectionDelayMax=v;this.backoff&&this.backoff.setMax(v);return this};Manager.prototype.timeout=function(v){if(!arguments.length)return this._timeout;this._timeout=v;return this};Manager.prototype.maybeReconnectOnOpen=function(){if(!this.reconnecting&&this._reconnection&&this.backoff.attempts===0){this.reconnect()}};Manager.prototype.open=Manager.prototype.connect=function(fn){debug("readyState %s",this.readyState);if(~this.readyState.indexOf("open"))return this;debug("opening %s",this.uri);this.engine=eio(this.uri,this.opts);var socket=this.engine;var self=this;this.readyState="opening";this.skipReconnect=false;var openSub=on(socket,"open",function(){self.onopen();fn&&fn()});var errorSub=on(socket,"error",function(data){debug("connect_error");self.cleanup();self.readyState="closed";self.emitAll("connect_error",data);if(fn){var err=new Error("Connection error");err.data=data;fn(err)}else{self.maybeReconnectOnOpen()}});if(false!==this._timeout){var timeout=this._timeout;debug("connect attempt will timeout after %d",timeout);var timer=setTimeout(function(){debug("connect attempt timed out after %d",timeout);openSub.destroy();socket.close();socket.emit("error","timeout");self.emitAll("connect_timeout",timeout)},timeout);this.subs.push({destroy:function(){clearTimeout(timer)}})}this.subs.push(openSub);this.subs.push(errorSub);return this};Manager.prototype.onopen=function(){debug("open");this.cleanup();this.readyState="open";this.emit("open");var socket=this.engine;this.subs.push(on(socket,"data",bind(this,"ondata")));this.subs.push(on(this.decoder,"decoded",bind(this,"ondecoded")));this.subs.push(on(socket,"error",bind(this,"onerror")));this.subs.push(on(socket,"close",bind(this,"onclose")))};Manager.prototype.ondata=function(data){this.decoder.add(data)};Manager.prototype.ondecoded=function(packet){this.emit("packet",packet)};Manager.prototype.onerror=function(err){debug("error",err);this.emitAll("error",err)};Manager.prototype.socket=function(nsp){var socket=this.nsps[nsp];if(!socket){socket=new Socket(this,nsp);this.nsps[nsp]=socket;var self=this;socket.on("connect",function(){socket.id=self.engine.id;if(!~indexOf(self.connected,socket)){self.connected.push(socket)}})}return socket};Manager.prototype.destroy=function(socket){var index=indexOf(this.connected,socket);if(~index)this.connected.splice(index,1);if(this.connected.length)return;this.close()};Manager.prototype.packet=function(packet){debug("writing packet %j",packet);var self=this;if(!self.encoding){self.encoding=true;this.encoder.encode(packet,function(encodedPackets){for(var i=0;i<encodedPackets.length;i++){self.engine.write(encodedPackets[i])}self.encoding=false;self.processPacketQueue()})}else{self.packetBuffer.push(packet)}};Manager.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var pack=this.packetBuffer.shift();this.packet(pack)}};Manager.prototype.cleanup=function(){var sub;while(sub=this.subs.shift())sub.destroy();this.packetBuffer=[];this.encoding=false;this.decoder.destroy()};Manager.prototype.close=Manager.prototype.disconnect=function(){this.skipReconnect=true;this.backoff.reset();this.readyState="closed";this.engine&&this.engine.close()};Manager.prototype.onclose=function(reason){debug("close");this.cleanup();this.backoff.reset();this.readyState="closed";this.emit("close",reason);if(this._reconnection&&!this.skipReconnect){this.reconnect()}};Manager.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var self=this;if(this.backoff.attempts>=this._reconnectionAttempts){debug("reconnect failed");this.backoff.reset();this.emitAll("reconnect_failed");this.reconnecting=false}else{var delay=this.backoff.duration();debug("will wait %dms before reconnect attempt",delay);this.reconnecting=true;var timer=setTimeout(function(){if(self.skipReconnect)return;debug("attempting reconnect");self.emitAll("reconnect_attempt",self.backoff.attempts);self.emitAll("reconnecting",self.backoff.attempts);if(self.skipReconnect)return;self.open(function(err){if(err){debug("reconnect attempt error");self.reconnecting=false;self.reconnect();self.emitAll("reconnect_error",err.data)}else{debug("reconnect success");self.onreconnect()}})},delay);this.subs.push({destroy:function(){clearTimeout(timer)}})}};Manager.prototype.onreconnect=function(){var attempt=this.backoff.attempts;this.reconnecting=false;this.backoff.reset();this.updateSocketIds();this.emitAll("reconnect",attempt)}},{"./on":4,"./socket":5,"./url":6,backo2:7,"component-bind":8,"component-emitter":9,debug:10,"engine.io-client":11,indexof:42,"object-component":43,"socket.io-parser":46}],4:[function(_dereq_,module,exports){module.exports=on;function on(obj,ev,fn){obj.on(ev,fn);return{destroy:function(){obj.removeListener(ev,fn)}}}},{}],5:[function(_dereq_,module,exports){var parser=_dereq_("socket.io-parser");var Emitter=_dereq_("component-emitter");var toArray=_dereq_("to-array");var on=_dereq_("./on");var bind=_dereq_("component-bind");var debug=_dereq_("debug")("socket.io-client:socket");var hasBin=_dereq_("has-binary");module.exports=exports=Socket;var events={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1};var emit=Emitter.prototype.emit;function Socket(io,nsp){this.io=io;this.nsp=nsp;this.json=this;this.ids=0;this.acks={};if(this.io.autoConnect)this.open();this.receiveBuffer=[];this.sendBuffer=[];this.connected=false;this.disconnected=true}Emitter(Socket.prototype);Socket.prototype.subEvents=function(){if(this.subs)return;var io=this.io;this.subs=[on(io,"open",bind(this,"onopen")),on(io,"packet",bind(this,"onpacket")),on(io,"close",bind(this,"onclose"))]};Socket.prototype.open=Socket.prototype.connect=function(){if(this.connected)return this;this.subEvents();this.io.open();if("open"==this.io.readyState)this.onopen();return this};Socket.prototype.send=function(){var args=toArray(arguments);args.unshift("message");this.emit.apply(this,args);return this};Socket.prototype.emit=function(ev){if(events.hasOwnProperty(ev)){emit.apply(this,arguments);return this}var args=toArray(arguments);var parserType=parser.EVENT;if(hasBin(args)){parserType=parser.BINARY_EVENT}var packet={type:parserType,data:args};if("function"==typeof args[args.length-1]){debug("emitting packet with ack id %d",this.ids);this.acks[this.ids]=args.pop();packet.id=this.ids++}if(this.connected){this.packet(packet)}else{this.sendBuffer.push(packet)}return this};Socket.prototype.packet=function(packet){packet.nsp=this.nsp;this.io.packet(packet)};Socket.prototype.onopen=function(){debug("transport is open - connecting");if("/"!=this.nsp){this.packet({type:parser.CONNECT})}};Socket.prototype.onclose=function(reason){debug("close (%s)",reason);this.connected=false;this.disconnected=true;delete this.id;this.emit("disconnect",reason)};Socket.prototype.onpacket=function(packet){if(packet.nsp!=this.nsp)return;switch(packet.type){case parser.CONNECT:this.onconnect();break;case parser.EVENT:this.onevent(packet);break;case parser.BINARY_EVENT:this.onevent(packet);break;case parser.ACK:this.onack(packet);break;case parser.BINARY_ACK:this.onack(packet);break;case parser.DISCONNECT:this.ondisconnect();break;case parser.ERROR:this.emit("error",packet.data);break}};Socket.prototype.onevent=function(packet){var args=packet.data||[];debug("emitting event %j",args);if(null!=packet.id){debug("attaching ack callback to event");args.push(this.ack(packet.id))}if(this.connected){emit.apply(this,args)}else{this.receiveBuffer.push(args)}};Socket.prototype.ack=function(id){var self=this;var sent=false;return function(){if(sent)return;sent=true;var args=toArray(arguments);debug("sending ack %j",args);var type=hasBin(args)?parser.BINARY_ACK:parser.ACK;self.packet({type:type,id:id,data:args})}};Socket.prototype.onack=function(packet){debug("calling ack %s with %j",packet.id,packet.data);var fn=this.acks[packet.id];fn.apply(this,packet.data);delete this.acks[packet.id]};Socket.prototype.onconnect=function(){this.connected=true;this.disconnected=false;this.emit("connect");this.emitBuffered()};Socket.prototype.emitBuffered=function(){var i;for(i=0;i<this.receiveBuffer.length;i++){emit.apply(this,this.receiveBuffer[i])}this.receiveBuffer=[];for(i=0;i<this.sendBuffer.length;i++){this.packet(this.sendBuffer[i])}this.sendBuffer=[]};Socket.prototype.ondisconnect=function(){debug("server disconnect (%s)",this.nsp);this.destroy();this.onclose("io server disconnect")};Socket.prototype.destroy=function(){if(this.subs){for(var i=0;i<this.subs.length;i++){this.subs[i].destroy()}this.subs=null}this.io.destroy(this)};Socket.prototype.close=Socket.prototype.disconnect=function(){if(this.connected){debug("performing disconnect (%s)",this.nsp);this.packet({type:parser.DISCONNECT})}this.destroy();if(this.connected){this.onclose("io client disconnect")}return this}},{"./on":4,"component-bind":8,"component-emitter":9,debug:10,"has-binary":38,"socket.io-parser":46,"to-array":50}],6:[function(_dereq_,module,exports){(function(global){var parseuri=_dereq_("parseuri");var debug=_dereq_("debug")("socket.io-client:url");module.exports=url;function url(uri,loc){var obj=uri;var loc=loc||global.location;if(null==uri)uri=loc.protocol+"//"+loc.host;if("string"==typeof uri){if("/"==uri.charAt(0)){if("/"==uri.charAt(1)){uri=loc.protocol+uri}else{uri=loc.hostname+uri}}if(!/^(https?|wss?):\/\//.test(uri)){debug("protocol-less url %s",uri);if("undefined"!=typeof loc){uri=loc.protocol+"//"+uri}else{uri="https://"+uri}}debug("parse %s",uri);obj=parseuri(uri)}if(!obj.port){if(/^(http|ws)$/.test(obj.protocol)){obj.port="80"}else if(/^(http|ws)s$/.test(obj.protocol)){obj.port="443"}}obj.path=obj.path||"/";obj.id=obj.protocol+"://"+obj.host+":"+obj.port;obj.href=obj.protocol+"://"+obj.host+(loc&&loc.port==obj.port?"":":"+obj.port);return obj}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{debug:10,parseuri:44}],7:[function(_dereq_,module,exports){module.exports=Backoff;function Backoff(opts){opts=opts||{};this.ms=opts.min||100;this.max=opts.max||1e4;this.factor=opts.factor||2;this.jitter=opts.jitter>0&&opts.jitter<=1?opts.jitter:0;this.attempts=0}Backoff.prototype.duration=function(){var ms=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var rand=Math.random();var deviation=Math.floor(rand*this.jitter*ms);ms=(Math.floor(rand*10)&1)==0?ms-deviation:ms+deviation}return Math.min(ms,this.max)|0};Backoff.prototype.reset=function(){this.attempts=0};Backoff.prototype.setMin=function(min){this.ms=min};Backoff.prototype.setMax=function(max){this.max=max};Backoff.prototype.setJitter=function(jitter){this.jitter=jitter}},{}],8:[function(_dereq_,module,exports){var slice=[].slice;module.exports=function(obj,fn){if("string"==typeof fn)fn=obj[fn];if("function"!=typeof fn)throw new Error("bind() requires a function");var args=slice.call(arguments,2);return function(){return fn.apply(obj,args.concat(slice.call(arguments)))}}},{}],9:[function(_dereq_,module,exports){module.exports=Emitter;function Emitter(obj){if(obj)return mixin(obj)}function mixin(obj){for(var key in Emitter.prototype){obj[key]=Emitter.prototype[key]}return obj}Emitter.prototype.on=Emitter.prototype.addEventListener=function(event,fn){this._callbacks=this._callbacks||{};(this._callbacks[event]=this._callbacks[event]||[]).push(fn);return this};Emitter.prototype.once=function(event,fn){var self=this;this._callbacks=this._callbacks||{};function on(){self.off(event,on);fn.apply(this,arguments)}on.fn=fn;this.on(event,on);return this};Emitter.prototype.off=Emitter.prototype.removeListener=Emitter.prototype.removeAllListeners=Emitter.prototype.removeEventListener=function(event,fn){this._callbacks=this._callbacks||{};if(0==arguments.length){this._callbacks={};return this}var callbacks=this._callbacks[event];if(!callbacks)return this;if(1==arguments.length){delete this._callbacks[event];return this}var cb;for(var i=0;i<callbacks.length;i++){cb=callbacks[i];if(cb===fn||cb.fn===fn){callbacks.splice(i,1);break}}return this};Emitter.prototype.emit=function(event){this._callbacks=this._callbacks||{};var args=[].slice.call(arguments,1),callbacks=this._callbacks[event];if(callbacks){callbacks=callbacks.slice(0);for(var i=0,len=callbacks.length;i<len;++i){callbacks[i].apply(this,args)}}return this};Emitter.prototype.listeners=function(event){this._callbacks=this._callbacks||{};return this._callbacks[event]||[]};Emitter.prototype.hasListeners=function(event){return!!this.listeners(event).length}},{}],10:[function(_dereq_,module,exports){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}try{if(window.localStorage)debug.enable(localStorage.debug)}catch(e){}},{}],11:[function(_dereq_,module,exports){module.exports=_dereq_("./lib/")},{"./lib/":12}],12:[function(_dereq_,module,exports){module.exports=_dereq_("./socket");module.exports.parser=_dereq_("engine.io-parser")},{"./socket":13,"engine.io-parser":25}],13:[function(_dereq_,module,exports){(function(global){var transports=_dereq_("./transports");var Emitter=_dereq_("component-emitter");var debug=_dereq_("debug")("engine.io-client:socket");var index=_dereq_("indexof");var parser=_dereq_("engine.io-parser");var parseuri=_dereq_("parseuri");var parsejson=_dereq_("parsejson");var parseqs=_dereq_("parseqs");module.exports=Socket;function noop(){}function Socket(uri,opts){if(!(this instanceof Socket))return new Socket(uri,opts);opts=opts||{};if(uri&&"object"==typeof uri){opts=uri;uri=null}if(uri){uri=parseuri(uri);opts.host=uri.host;opts.secure=uri.protocol=="https"||uri.protocol=="wss";opts.port=uri.port;if(uri.query)opts.query=uri.query}this.secure=null!=opts.secure?opts.secure:global.location&&"https:"==location.protocol;if(opts.host){var pieces=opts.host.split(":");opts.hostname=pieces.shift();if(pieces.length){opts.port=pieces.pop()}else if(!opts.port){opts.port=this.secure?"443":"80"}}this.agent=opts.agent||false;this.hostname=opts.hostname||(global.location?location.hostname:"localhost");this.port=opts.port||(global.location&&location.port?location.port:this.secure?443:80);this.query=opts.query||{};if("string"==typeof this.query)this.query=parseqs.decode(this.query);this.upgrade=false!==opts.upgrade;this.path=(opts.path||"/engine.io").replace(/\/$/,"")+"/";this.forceJSONP=!!opts.forceJSONP;this.jsonp=false!==opts.jsonp;this.forceBase64=!!opts.forceBase64;this.enablesXDR=!!opts.enablesXDR;this.timestampParam=opts.timestampParam||"t";this.timestampRequests=opts.timestampRequests;this.transports=opts.transports||["polling","websocket"];
this.readyState="";this.writeBuffer=[];this.callbackBuffer=[];this.policyPort=opts.policyPort||843;this.rememberUpgrade=opts.rememberUpgrade||false;this.binaryType=null;this.onlyBinaryUpgrades=opts.onlyBinaryUpgrades;this.pfx=opts.pfx||null;this.key=opts.key||null;this.passphrase=opts.passphrase||null;this.cert=opts.cert||null;this.ca=opts.ca||null;this.ciphers=opts.ciphers||null;this.rejectUnauthorized=opts.rejectUnauthorized||null;this.open()}Socket.priorWebsocketSuccess=false;Emitter(Socket.prototype);Socket.protocol=parser.protocol;Socket.Socket=Socket;Socket.Transport=_dereq_("./transport");Socket.transports=_dereq_("./transports");Socket.parser=_dereq_("engine.io-parser");Socket.prototype.createTransport=function(name){debug('creating transport "%s"',name);var query=clone(this.query);query.EIO=parser.protocol;query.transport=name;if(this.id)query.sid=this.id;var transport=new transports[name]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:query,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return transport};function clone(obj){var o={};for(var i in obj){if(obj.hasOwnProperty(i)){o[i]=obj[i]}}return o}Socket.prototype.open=function(){var transport;if(this.rememberUpgrade&&Socket.priorWebsocketSuccess&&this.transports.indexOf("websocket")!=-1){transport="websocket"}else if(0==this.transports.length){var self=this;setTimeout(function(){self.emit("error","No transports available")},0);return}else{transport=this.transports[0]}this.readyState="opening";var transport;try{transport=this.createTransport(transport)}catch(e){this.transports.shift();this.open();return}transport.open();this.setTransport(transport)};Socket.prototype.setTransport=function(transport){debug("setting transport %s",transport.name);var self=this;if(this.transport){debug("clearing existing transport %s",this.transport.name);this.transport.removeAllListeners()}this.transport=transport;transport.on("drain",function(){self.onDrain()}).on("packet",function(packet){self.onPacket(packet)}).on("error",function(e){self.onError(e)}).on("close",function(){self.onClose("transport close")})};Socket.prototype.probe=function(name){debug('probing transport "%s"',name);var transport=this.createTransport(name,{probe:1}),failed=false,self=this;Socket.priorWebsocketSuccess=false;function onTransportOpen(){if(self.onlyBinaryUpgrades){var upgradeLosesBinary=!this.supportsBinary&&self.transport.supportsBinary;failed=failed||upgradeLosesBinary}if(failed)return;debug('probe transport "%s" opened',name);transport.send([{type:"ping",data:"probe"}]);transport.once("packet",function(msg){if(failed)return;if("pong"==msg.type&&"probe"==msg.data){debug('probe transport "%s" pong',name);self.upgrading=true;self.emit("upgrading",transport);if(!transport)return;Socket.priorWebsocketSuccess="websocket"==transport.name;debug('pausing current transport "%s"',self.transport.name);self.transport.pause(function(){if(failed)return;if("closed"==self.readyState)return;debug("changing transport and sending upgrade packet");cleanup();self.setTransport(transport);transport.send([{type:"upgrade"}]);self.emit("upgrade",transport);transport=null;self.upgrading=false;self.flush()})}else{debug('probe transport "%s" failed',name);var err=new Error("probe error");err.transport=transport.name;self.emit("upgradeError",err)}})}function freezeTransport(){if(failed)return;failed=true;cleanup();transport.close();transport=null}function onerror(err){var error=new Error("probe error: "+err);error.transport=transport.name;freezeTransport();debug('probe transport "%s" failed because of error: %s',name,err);self.emit("upgradeError",error)}function onTransportClose(){onerror("transport closed")}function onclose(){onerror("socket closed")}function onupgrade(to){if(transport&&to.name!=transport.name){debug('"%s" works - aborting "%s"',to.name,transport.name);freezeTransport()}}function cleanup(){transport.removeListener("open",onTransportOpen);transport.removeListener("error",onerror);transport.removeListener("close",onTransportClose);self.removeListener("close",onclose);self.removeListener("upgrading",onupgrade)}transport.once("open",onTransportOpen);transport.once("error",onerror);transport.once("close",onTransportClose);this.once("close",onclose);this.once("upgrading",onupgrade);transport.open()};Socket.prototype.onOpen=function(){debug("socket open");this.readyState="open";Socket.priorWebsocketSuccess="websocket"==this.transport.name;this.emit("open");this.flush();if("open"==this.readyState&&this.upgrade&&this.transport.pause){debug("starting upgrade probes");for(var i=0,l=this.upgrades.length;i<l;i++){this.probe(this.upgrades[i])}}};Socket.prototype.onPacket=function(packet){if("opening"==this.readyState||"open"==this.readyState){debug('socket receive: type "%s", data "%s"',packet.type,packet.data);this.emit("packet",packet);this.emit("heartbeat");switch(packet.type){case"open":this.onHandshake(parsejson(packet.data));break;case"pong":this.setPing();break;case"error":var err=new Error("server error");err.code=packet.data;this.emit("error",err);break;case"message":this.emit("data",packet.data);this.emit("message",packet.data);break}}else{debug('packet received with socket readyState "%s"',this.readyState)}};Socket.prototype.onHandshake=function(data){this.emit("handshake",data);this.id=data.sid;this.transport.query.sid=data.sid;this.upgrades=this.filterUpgrades(data.upgrades);this.pingInterval=data.pingInterval;this.pingTimeout=data.pingTimeout;this.onOpen();if("closed"==this.readyState)return;this.setPing();this.removeListener("heartbeat",this.onHeartbeat);this.on("heartbeat",this.onHeartbeat)};Socket.prototype.onHeartbeat=function(timeout){clearTimeout(this.pingTimeoutTimer);var self=this;self.pingTimeoutTimer=setTimeout(function(){if("closed"==self.readyState)return;self.onClose("ping timeout")},timeout||self.pingInterval+self.pingTimeout)};Socket.prototype.setPing=function(){var self=this;clearTimeout(self.pingIntervalTimer);self.pingIntervalTimer=setTimeout(function(){debug("writing ping packet - expecting pong within %sms",self.pingTimeout);self.ping();self.onHeartbeat(self.pingTimeout)},self.pingInterval)};Socket.prototype.ping=function(){this.sendPacket("ping")};Socket.prototype.onDrain=function(){for(var i=0;i<this.prevBufferLen;i++){if(this.callbackBuffer[i]){this.callbackBuffer[i]()}}this.writeBuffer.splice(0,this.prevBufferLen);this.callbackBuffer.splice(0,this.prevBufferLen);this.prevBufferLen=0;if(this.writeBuffer.length==0){this.emit("drain")}else{this.flush()}};Socket.prototype.flush=function(){if("closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){debug("flushing %d packets in socket",this.writeBuffer.length);this.transport.send(this.writeBuffer);this.prevBufferLen=this.writeBuffer.length;this.emit("flush")}};Socket.prototype.write=Socket.prototype.send=function(msg,fn){this.sendPacket("message",msg,fn);return this};Socket.prototype.sendPacket=function(type,data,fn){if("closing"==this.readyState||"closed"==this.readyState){return}var packet={type:type,data:data};this.emit("packetCreate",packet);this.writeBuffer.push(packet);this.callbackBuffer.push(fn);this.flush()};Socket.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var self=this;function close(){self.onClose("forced close");debug("socket closing - telling transport to close");self.transport.close()}function cleanupAndClose(){self.removeListener("upgrade",cleanupAndClose);self.removeListener("upgradeError",cleanupAndClose);close()}function waitForUpgrade(){self.once("upgrade",cleanupAndClose);self.once("upgradeError",cleanupAndClose)}if(this.writeBuffer.length){this.once("drain",function(){if(this.upgrading){waitForUpgrade()}else{close()}})}else if(this.upgrading){waitForUpgrade()}else{close()}}return this};Socket.prototype.onError=function(err){debug("socket error %j",err);Socket.priorWebsocketSuccess=false;this.emit("error",err);this.onClose("transport error",err)};Socket.prototype.onClose=function(reason,desc){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){debug('socket close with reason: "%s"',reason);var self=this;clearTimeout(this.pingIntervalTimer);clearTimeout(this.pingTimeoutTimer);setTimeout(function(){self.writeBuffer=[];self.callbackBuffer=[];self.prevBufferLen=0},0);this.transport.removeAllListeners("close");this.transport.close();this.transport.removeAllListeners();this.readyState="closed";this.id=null;this.emit("close",reason,desc)}};Socket.prototype.filterUpgrades=function(upgrades){var filteredUpgrades=[];for(var i=0,j=upgrades.length;i<j;i++){if(~index(this.transports,upgrades[i]))filteredUpgrades.push(upgrades[i])}return filteredUpgrades}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./transport":14,"./transports":15,"component-emitter":9,debug:22,"engine.io-parser":25,indexof:42,parsejson:34,parseqs:35,parseuri:36}],14:[function(_dereq_,module,exports){var parser=_dereq_("engine.io-parser");var Emitter=_dereq_("component-emitter");module.exports=Transport;function Transport(opts){this.path=opts.path;this.hostname=opts.hostname;this.port=opts.port;this.secure=opts.secure;this.query=opts.query;this.timestampParam=opts.timestampParam;this.timestampRequests=opts.timestampRequests;this.readyState="";this.agent=opts.agent||false;this.socket=opts.socket;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized}Emitter(Transport.prototype);Transport.timestamps=0;Transport.prototype.onError=function(msg,desc){var err=new Error(msg);err.type="TransportError";err.description=desc;this.emit("error",err);return this};Transport.prototype.open=function(){if("closed"==this.readyState||""==this.readyState){this.readyState="opening";this.doOpen()}return this};Transport.prototype.close=function(){if("opening"==this.readyState||"open"==this.readyState){this.doClose();this.onClose()}return this};Transport.prototype.send=function(packets){if("open"==this.readyState){this.write(packets)}else{throw new Error("Transport not open")}};Transport.prototype.onOpen=function(){this.readyState="open";this.writable=true;this.emit("open")};Transport.prototype.onData=function(data){var packet=parser.decodePacket(data,this.socket.binaryType);this.onPacket(packet)};Transport.prototype.onPacket=function(packet){this.emit("packet",packet)};Transport.prototype.onClose=function(){this.readyState="closed";this.emit("close")}},{"component-emitter":9,"engine.io-parser":25}],15:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest");var XHR=_dereq_("./polling-xhr");var JSONP=_dereq_("./polling-jsonp");var websocket=_dereq_("./websocket");exports.polling=polling;exports.websocket=websocket;function polling(opts){var xhr;var xd=false;var xs=false;var jsonp=false!==opts.jsonp;if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}xd=opts.hostname!=location.hostname||port!=opts.port;xs=opts.secure!=isSSL}opts.xdomain=xd;opts.xscheme=xs;xhr=new XMLHttpRequest(opts);if("open"in xhr&&!opts.forceJSONP){return new XHR(opts)}else{if(!jsonp)throw new Error("JSONP disabled");return new JSONP(opts)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling-jsonp":16,"./polling-xhr":17,"./websocket":19,xmlhttprequest:20}],16:[function(_dereq_,module,exports){(function(global){var Polling=_dereq_("./polling");var inherit=_dereq_("component-inherit");module.exports=JSONPPolling;var rNewline=/\n/g;var rEscapedNewline=/\\n/g;var callbacks;var index=0;function empty(){}function JSONPPolling(opts){Polling.call(this,opts);this.query=this.query||{};if(!callbacks){if(!global.___eio)global.___eio=[];callbacks=global.___eio}this.index=callbacks.length;var self=this;callbacks.push(function(msg){self.onData(msg)});this.query.j=this.index;if(global.document&&global.addEventListener){global.addEventListener("beforeunload",function(){if(self.script)self.script.onerror=empty},false)}}inherit(JSONPPolling,Polling);JSONPPolling.prototype.supportsBinary=false;JSONPPolling.prototype.doClose=function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}if(this.form){this.form.parentNode.removeChild(this.form);this.form=null;this.iframe=null}Polling.prototype.doClose.call(this)};JSONPPolling.prototype.doPoll=function(){var self=this;var script=document.createElement("script");if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}script.async=true;script.src=this.uri();script.onerror=function(e){self.onError("jsonp poll error",e)};var insertAt=document.getElementsByTagName("script")[0];insertAt.parentNode.insertBefore(script,insertAt);this.script=script;var isUAgecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);if(isUAgecko){setTimeout(function(){var iframe=document.createElement("iframe");document.body.appendChild(iframe);document.body.removeChild(iframe)},100)}};JSONPPolling.prototype.doWrite=function(data,fn){var self=this;if(!this.form){var form=document.createElement("form");var area=document.createElement("textarea");var id=this.iframeId="eio_iframe_"+this.index;var iframe;form.className="socketio";form.style.position="absolute";form.style.top="-1000px";form.style.left="-1000px";form.target=id;form.method="POST";form.setAttribute("accept-charset","utf-8");area.name="d";form.appendChild(area);document.body.appendChild(form);this.form=form;this.area=area}this.form.action=this.uri();function complete(){initIframe();fn()}function initIframe(){if(self.iframe){try{self.form.removeChild(self.iframe)}catch(e){self.onError("jsonp polling iframe removal error",e)}}try{var html='<iframe src="javascript:0" name="'+self.iframeId+'">';iframe=document.createElement(html)}catch(e){iframe=document.createElement("iframe");iframe.name=self.iframeId;iframe.src="javascript:0"}iframe.id=self.iframeId;self.form.appendChild(iframe);self.iframe=iframe}initIframe();data=data.replace(rEscapedNewline,"\\\n");this.area.value=data.replace(rNewline,"\\n");try{this.form.submit()}catch(e){}if(this.iframe.attachEvent){this.iframe.onreadystatechange=function(){if(self.iframe.readyState=="complete"){complete()}}}else{this.iframe.onload=complete}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-inherit":21}],17:[function(_dereq_,module,exports){(function(global){var XMLHttpRequest=_dereq_("xmlhttprequest");var Polling=_dereq_("./polling");var Emitter=_dereq_("component-emitter");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:polling-xhr");module.exports=XHR;module.exports.Request=Request;function empty(){}function XHR(opts){Polling.call(this,opts);if(global.location){var isSSL="https:"==location.protocol;var port=location.port;if(!port){port=isSSL?443:80}this.xd=opts.hostname!=global.location.hostname||port!=opts.port;this.xs=opts.secure!=isSSL}}inherit(XHR,Polling);XHR.prototype.supportsBinary=true;XHR.prototype.request=function(opts){opts=opts||{};opts.uri=this.uri();opts.xd=this.xd;opts.xs=this.xs;opts.agent=this.agent||false;opts.supportsBinary=this.supportsBinary;opts.enablesXDR=this.enablesXDR;opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;return new Request(opts)};XHR.prototype.doWrite=function(data,fn){var isBinary=typeof data!=="string"&&data!==undefined;var req=this.request({method:"POST",data:data,isBinary:isBinary});var self=this;req.on("success",fn);req.on("error",function(err){self.onError("xhr post error",err)});this.sendXhr=req};XHR.prototype.doPoll=function(){debug("xhr poll");var req=this.request();var self=this;req.on("data",function(data){self.onData(data)});req.on("error",function(err){self.onError("xhr poll error",err)});this.pollXhr=req};function Request(opts){this.method=opts.method||"GET";this.uri=opts.uri;this.xd=!!opts.xd;this.xs=!!opts.xs;this.async=false!==opts.async;this.data=undefined!=opts.data?opts.data:null;this.agent=opts.agent;this.isBinary=opts.isBinary;this.supportsBinary=opts.supportsBinary;this.enablesXDR=opts.enablesXDR;this.pfx=opts.pfx;this.key=opts.key;this.passphrase=opts.passphrase;this.cert=opts.cert;this.ca=opts.ca;this.ciphers=opts.ciphers;this.rejectUnauthorized=opts.rejectUnauthorized;this.create()}Emitter(Request.prototype);Request.prototype.create=function(){var opts={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;var xhr=this.xhr=new XMLHttpRequest(opts);var self=this;try{debug("xhr open %s: %s",this.method,this.uri);xhr.open(this.method,this.uri,this.async);if(this.supportsBinary){xhr.responseType="arraybuffer"}if("POST"==this.method){try{if(this.isBinary){xhr.setRequestHeader("Content-type","application/octet-stream")}else{xhr.setRequestHeader("Content-type","text/plain;charset=UTF-8")}}catch(e){}}if("withCredentials"in xhr){xhr.withCredentials=true}if(this.hasXDR()){xhr.onload=function(){self.onLoad()};xhr.onerror=function(){self.onError(xhr.responseText)}}else{xhr.onreadystatechange=function(){if(4!=xhr.readyState)return;if(200==xhr.status||1223==xhr.status){self.onLoad()}else{setTimeout(function(){self.onError(xhr.status)},0)}}}debug("xhr data %s",this.data);xhr.send(this.data)}catch(e){setTimeout(function(){self.onError(e)},0);return}if(global.document){this.index=Request.requestsCount++;Request.requests[this.index]=this}};Request.prototype.onSuccess=function(){this.emit("success");this.cleanup()};Request.prototype.onData=function(data){this.emit("data",data);this.onSuccess()};Request.prototype.onError=function(err){this.emit("error",err);this.cleanup(true)};Request.prototype.cleanup=function(fromError){if("undefined"==typeof this.xhr||null===this.xhr){return}if(this.hasXDR()){this.xhr.onload=this.xhr.onerror=empty}else{this.xhr.onreadystatechange=empty}if(fromError){try{this.xhr.abort()}catch(e){}}if(global.document){delete Request.requests[this.index]}this.xhr=null};Request.prototype.onLoad=function(){var data;try{var contentType;try{contentType=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(e){}if(contentType==="application/octet-stream"){data=this.xhr.response}else{if(!this.supportsBinary){data=this.xhr.responseText}else{data="ok"}}}catch(e){this.onError(e)}if(null!=data){this.onData(data)}};Request.prototype.hasXDR=function(){return"undefined"!==typeof global.XDomainRequest&&!this.xs&&this.enablesXDR};Request.prototype.abort=function(){this.cleanup()};if(global.document){Request.requestsCount=0;Request.requests={};if(global.attachEvent){global.attachEvent("onunload",unloadHandler)}else if(global.addEventListener){global.addEventListener("beforeunload",unloadHandler,false)}}function unloadHandler(){for(var i in Request.requests){if(Request.requests.hasOwnProperty(i)){Request.requests[i].abort()}}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./polling":18,"component-emitter":9,"component-inherit":21,debug:22,xmlhttprequest:20}],18:[function(_dereq_,module,exports){var Transport=_dereq_("../transport");var parseqs=_dereq_("parseqs");var parser=_dereq_("engine.io-parser");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:polling");module.exports=Polling;var hasXHR2=function(){var XMLHttpRequest=_dereq_("xmlhttprequest");var xhr=new XMLHttpRequest({xdomain:false});return null!=xhr.responseType}();function Polling(opts){var forceBase64=opts&&opts.forceBase64;if(!hasXHR2||forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(Polling,Transport);Polling.prototype.name="polling";Polling.prototype.doOpen=function(){this.poll()};Polling.prototype.pause=function(onPause){var pending=0;var self=this;this.readyState="pausing";function pause(){debug("paused");self.readyState="paused";onPause()}if(this.polling||!this.writable){var total=0;if(this.polling){debug("we are currently polling - waiting to pause");total++;this.once("pollComplete",function(){debug("pre-pause polling complete");--total||pause()})}if(!this.writable){debug("we are currently writing - waiting to pause");total++;this.once("drain",function(){debug("pre-pause writing complete");--total||pause()})}}else{pause()}};Polling.prototype.poll=function(){debug("polling");this.polling=true;this.doPoll();this.emit("poll")};Polling.prototype.onData=function(data){var self=this;debug("polling got data %s",data);var callback=function(packet,index,total){if("opening"==self.readyState){self.onOpen()}if("close"==packet.type){self.onClose();return false}self.onPacket(packet)};parser.decodePayload(data,this.socket.binaryType,callback);if("closed"!=this.readyState){this.polling=false;this.emit("pollComplete");if("open"==this.readyState){this.poll()}else{debug('ignoring poll - transport state "%s"',this.readyState)}}};Polling.prototype.doClose=function(){var self=this;function close(){debug("writing close packet");self.write([{type:"close"}])}if("open"==this.readyState){debug("transport open - closing");close()}else{debug("transport not open - deferring close");this.once("open",close)}};Polling.prototype.write=function(packets){var self=this;this.writable=false;var callbackfn=function(){self.writable=true;self.emit("drain")};var self=this;parser.encodePayload(packets,this.supportsBinary,function(data){self.doWrite(data,callbackfn)})};Polling.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"https":"http";var port="";if(false!==this.timestampRequests){query[this.timestampParam]=+new Date+"-"+Transport.timestamps++}if(!this.supportsBinary&&!query.sid){query.b64=1}query=parseqs.encode(query);if(this.port&&("https"==schema&&this.port!=443||"http"==schema&&this.port!=80)){port=":"+this.port}if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,xmlhttprequest:20}],19:[function(_dereq_,module,exports){var Transport=_dereq_("../transport");var parser=_dereq_("engine.io-parser");var parseqs=_dereq_("parseqs");var inherit=_dereq_("component-inherit");var debug=_dereq_("debug")("engine.io-client:websocket");var WebSocket=_dereq_("ws");module.exports=WS;function WS(opts){var forceBase64=opts&&opts.forceBase64;if(forceBase64){this.supportsBinary=false}Transport.call(this,opts)}inherit(WS,Transport);WS.prototype.name="websocket";WS.prototype.supportsBinary=true;WS.prototype.doOpen=function(){if(!this.check()){return}var self=this;var uri=this.uri();var protocols=void 0;var opts={agent:this.agent};opts.pfx=this.pfx;opts.key=this.key;opts.passphrase=this.passphrase;opts.cert=this.cert;opts.ca=this.ca;opts.ciphers=this.ciphers;opts.rejectUnauthorized=this.rejectUnauthorized;this.ws=new WebSocket(uri,protocols,opts);if(this.ws.binaryType===undefined){this.supportsBinary=false}this.ws.binaryType="arraybuffer";this.addEventListeners()};WS.prototype.addEventListeners=function(){var self=this;this.ws.onopen=function(){self.onOpen()};this.ws.onclose=function(){self.onClose()};this.ws.onmessage=function(ev){self.onData(ev.data)};this.ws.onerror=function(e){self.onError("websocket error",e)}};if("undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)){WS.prototype.onData=function(data){var self=this;setTimeout(function(){Transport.prototype.onData.call(self,data)},0)}}WS.prototype.write=function(packets){var self=this;this.writable=false;for(var i=0,l=packets.length;i<l;i++){parser.encodePacket(packets[i],this.supportsBinary,function(data){try{self.ws.send(data)}catch(e){debug("websocket closed before onclose event")}})}function ondrain(){self.writable=true;self.emit("drain")}setTimeout(ondrain,0)};WS.prototype.onClose=function(){Transport.prototype.onClose.call(this)};WS.prototype.doClose=function(){if(typeof this.ws!=="undefined"){this.ws.close()}};WS.prototype.uri=function(){var query=this.query||{};var schema=this.secure?"wss":"ws";var port="";if(this.port&&("wss"==schema&&this.port!=443||"ws"==schema&&this.port!=80)){port=":"+this.port}if(this.timestampRequests){query[this.timestampParam]=+new Date}if(!this.supportsBinary){query.b64=1}query=parseqs.encode(query);if(query.length){query="?"+query}return schema+"://"+this.hostname+port+this.path+query};WS.prototype.check=function(){return!!WebSocket&&!("__initialize"in WebSocket&&this.name===WS.prototype.name)}},{"../transport":14,"component-inherit":21,debug:22,"engine.io-parser":25,parseqs:35,ws:37}],20:[function(_dereq_,module,exports){var hasCORS=_dereq_("has-cors");module.exports=function(opts){var xdomain=opts.xdomain;var xscheme=opts.xscheme;var enablesXDR=opts.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!xdomain||hasCORS)){return new XMLHttpRequest}}catch(e){}try{if("undefined"!=typeof XDomainRequest&&!xscheme&&enablesXDR){return new XDomainRequest}}catch(e){}if(!xdomain){try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}},{"has-cors":40}],21:[function(_dereq_,module,exports){module.exports=function(a,b){var fn=function(){};fn.prototype=b.prototype;a.prototype=new fn;a.prototype.constructor=a}},{}],22:[function(_dereq_,module,exports){exports=module.exports=_dereq_("./debug");exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}exports.formatters.j=function(v){return JSON.stringify(v)};function formatArgs(){var args=arguments;var useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ")+"+"+exports.humanize(this.diff);if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0;var lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args}function log(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(namespaces){try{if(null==namespaces){localStorage.removeItem("debug")}else{localStorage.debug=namespaces}}catch(e){}}function load(){var r;try{r=localStorage.debug}catch(e){}return r}exports.enable(load())},{"./debug":23}],23:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=coerce;exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.humanize=_dereq_("ms");exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;var prevTime;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=false;function enabled(){var self=enabled;var curr=+new Date;var ms=curr-(prevTime||curr);self.diff=ms;self.prev=prevTime;self.curr=curr;prevTime=curr;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if(match==="%")return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=true;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);var split=(namespaces||"").split(/[\s,]+/);var len=split.length;for(var i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if(namespaces[0]==="-"){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return false}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return true}}return false}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}},{ms:24}],24:[function(_dereq_,module,exports){var s=1e3;var m=s*60;var h=m*60;var d=h*24;var y=d*365.25;module.exports=function(val,options){options=options||{};if("string"==typeof val)return parse(val);return options.long?long(val):short(val)};function parse(str){var match=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]);var type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"y":return n*y;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"h":return n*h;case"minutes":case"minute":case"m":return n*m;case"seconds":case"second":case"s":return n*s;case"ms":return n}}function short(ms){if(ms>=d)return Math.round(ms/d)+"d";if(ms>=h)return Math.round(ms/h)+"h";if(ms>=m)return Math.round(ms/m)+"m";if(ms>=s)return Math.round(ms/s)+"s";return ms+"ms"}function long(ms){return plural(ms,d,"day")||plural(ms,h,"hour")||plural(ms,m,"minute")||plural(ms,s,"second")||ms+" ms"}function plural(ms,n,name){if(ms<n)return;if(ms<n*1.5)return Math.floor(ms/n)+" "+name;return Math.ceil(ms/n)+" "+name+"s"}},{}],25:[function(_dereq_,module,exports){(function(global){var keys=_dereq_("./keys");var hasBinary=_dereq_("has-binary");var sliceBuffer=_dereq_("arraybuffer.slice");var base64encoder=_dereq_("base64-arraybuffer");var after=_dereq_("after");var utf8=_dereq_("utf8");var isAndroid=navigator.userAgent.match(/Android/i);var isPhantomJS=/PhantomJS/i.test(navigator.userAgent);var dontSendBlobs=isAndroid||isPhantomJS;exports.protocol=3;var packets=exports.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6};var packetslist=keys(packets);var err={type:"error",data:"parser error"};var Blob=_dereq_("blob");exports.encodePacket=function(packet,supportsBinary,utf8encode,callback){if("function"==typeof supportsBinary){callback=supportsBinary;supportsBinary=false}if("function"==typeof utf8encode){callback=utf8encode;utf8encode=null}var data=packet.data===undefined?undefined:packet.data.buffer||packet.data;if(global.ArrayBuffer&&data instanceof ArrayBuffer){return encodeArrayBuffer(packet,supportsBinary,callback)}else if(Blob&&data instanceof global.Blob){return encodeBlob(packet,supportsBinary,callback)}if(data&&data.base64){return encodeBase64Object(packet,callback)}var encoded=packets[packet.type];if(undefined!==packet.data){encoded+=utf8encode?utf8.encode(String(packet.data)):String(packet.data)}return callback(""+encoded)};function encodeBase64Object(packet,callback){var message="b"+exports.packets[packet.type]+packet.data.data;
return callback(message)}function encodeArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var data=packet.data;var contentArray=new Uint8Array(data);var resultBuffer=new Uint8Array(1+data.byteLength);resultBuffer[0]=packets[packet.type];for(var i=0;i<contentArray.length;i++){resultBuffer[i+1]=contentArray[i]}return callback(resultBuffer.buffer)}function encodeBlobAsArrayBuffer(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}var fr=new FileReader;fr.onload=function(){packet.data=fr.result;exports.encodePacket(packet,supportsBinary,true,callback)};return fr.readAsArrayBuffer(packet.data)}function encodeBlob(packet,supportsBinary,callback){if(!supportsBinary){return exports.encodeBase64Packet(packet,callback)}if(dontSendBlobs){return encodeBlobAsArrayBuffer(packet,supportsBinary,callback)}var length=new Uint8Array(1);length[0]=packets[packet.type];var blob=new Blob([length.buffer,packet.data]);return callback(blob)}exports.encodeBase64Packet=function(packet,callback){var message="b"+exports.packets[packet.type];if(Blob&&packet.data instanceof Blob){var fr=new FileReader;fr.onload=function(){var b64=fr.result.split(",")[1];callback(message+b64)};return fr.readAsDataURL(packet.data)}var b64data;try{b64data=String.fromCharCode.apply(null,new Uint8Array(packet.data))}catch(e){var typed=new Uint8Array(packet.data);var basic=new Array(typed.length);for(var i=0;i<typed.length;i++){basic[i]=typed[i]}b64data=String.fromCharCode.apply(null,basic)}message+=global.btoa(b64data);return callback(message)};exports.decodePacket=function(data,binaryType,utf8decode){if(typeof data=="string"||data===undefined){if(data.charAt(0)=="b"){return exports.decodeBase64Packet(data.substr(1),binaryType)}if(utf8decode){try{data=utf8.decode(data)}catch(e){return err}}var type=data.charAt(0);if(Number(type)!=type||!packetslist[type]){return err}if(data.length>1){return{type:packetslist[type],data:data.substring(1)}}else{return{type:packetslist[type]}}}var asArray=new Uint8Array(data);var type=asArray[0];var rest=sliceBuffer(data,1);if(Blob&&binaryType==="blob"){rest=new Blob([rest])}return{type:packetslist[type],data:rest}};exports.decodeBase64Packet=function(msg,binaryType){var type=packetslist[msg.charAt(0)];if(!global.ArrayBuffer){return{type:type,data:{base64:true,data:msg.substr(1)}}}var data=base64encoder.decode(msg.substr(1));if(binaryType==="blob"&&Blob){data=new Blob([data])}return{type:type,data:data}};exports.encodePayload=function(packets,supportsBinary,callback){if(typeof supportsBinary=="function"){callback=supportsBinary;supportsBinary=null}var isBinary=hasBinary(packets);if(supportsBinary&&isBinary){if(Blob&&!dontSendBlobs){return exports.encodePayloadAsBlob(packets,callback)}return exports.encodePayloadAsArrayBuffer(packets,callback)}if(!packets.length){return callback("0:")}function setLengthHeader(message){return message.length+":"+message}function encodeOne(packet,doneCallback){exports.encodePacket(packet,!isBinary?false:supportsBinary,true,function(message){doneCallback(null,setLengthHeader(message))})}map(packets,encodeOne,function(err,results){return callback(results.join(""))})};function map(ary,each,done){var result=new Array(ary.length);var next=after(ary.length,done);var eachWithIndex=function(i,el,cb){each(el,function(error,msg){result[i]=msg;cb(error,result)})};for(var i=0;i<ary.length;i++){eachWithIndex(i,ary[i],next)}}exports.decodePayload=function(data,binaryType,callback){if(typeof data!="string"){return exports.decodePayloadAsBinary(data,binaryType,callback)}if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var packet;if(data==""){return callback(err,0,1)}var length="",n,msg;for(var i=0,l=data.length;i<l;i++){var chr=data.charAt(i);if(":"!=chr){length+=chr}else{if(""==length||length!=(n=Number(length))){return callback(err,0,1)}msg=data.substr(i+1,n);if(length!=msg.length){return callback(err,0,1)}if(msg.length){packet=exports.decodePacket(msg,binaryType,true);if(err.type==packet.type&&err.data==packet.data){return callback(err,0,1)}var ret=callback(packet,i+n,l);if(false===ret)return}i+=n;length=""}}if(length!=""){return callback(err,0,1)}};exports.encodePayloadAsArrayBuffer=function(packets,callback){if(!packets.length){return callback(new ArrayBuffer(0))}function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(data){return doneCallback(null,data)})}map(packets,encodeOne,function(err,encodedPackets){var totalLength=encodedPackets.reduce(function(acc,p){var len;if(typeof p==="string"){len=p.length}else{len=p.byteLength}return acc+len.toString().length+len+2},0);var resultArray=new Uint8Array(totalLength);var bufferIndex=0;encodedPackets.forEach(function(p){var isString=typeof p==="string";var ab=p;if(isString){var view=new Uint8Array(p.length);for(var i=0;i<p.length;i++){view[i]=p.charCodeAt(i)}ab=view.buffer}if(isString){resultArray[bufferIndex++]=0}else{resultArray[bufferIndex++]=1}var lenStr=ab.byteLength.toString();for(var i=0;i<lenStr.length;i++){resultArray[bufferIndex++]=parseInt(lenStr[i])}resultArray[bufferIndex++]=255;var view=new Uint8Array(ab);for(var i=0;i<view.length;i++){resultArray[bufferIndex++]=view[i]}});return callback(resultArray.buffer)})};exports.encodePayloadAsBlob=function(packets,callback){function encodeOne(packet,doneCallback){exports.encodePacket(packet,true,true,function(encoded){var binaryIdentifier=new Uint8Array(1);binaryIdentifier[0]=1;if(typeof encoded==="string"){var view=new Uint8Array(encoded.length);for(var i=0;i<encoded.length;i++){view[i]=encoded.charCodeAt(i)}encoded=view.buffer;binaryIdentifier[0]=0}var len=encoded instanceof ArrayBuffer?encoded.byteLength:encoded.size;var lenStr=len.toString();var lengthAry=new Uint8Array(lenStr.length+1);for(var i=0;i<lenStr.length;i++){lengthAry[i]=parseInt(lenStr[i])}lengthAry[lenStr.length]=255;if(Blob){var blob=new Blob([binaryIdentifier.buffer,lengthAry.buffer,encoded]);doneCallback(null,blob)}})}map(packets,encodeOne,function(err,results){return callback(new Blob(results))})};exports.decodePayloadAsBinary=function(data,binaryType,callback){if(typeof binaryType==="function"){callback=binaryType;binaryType=null}var bufferTail=data;var buffers=[];var numberTooLong=false;while(bufferTail.byteLength>0){var tailArray=new Uint8Array(bufferTail);var isString=tailArray[0]===0;var msgLength="";for(var i=1;;i++){if(tailArray[i]==255)break;if(msgLength.length>310){numberTooLong=true;break}msgLength+=tailArray[i]}if(numberTooLong)return callback(err,0,1);bufferTail=sliceBuffer(bufferTail,2+msgLength.length);msgLength=parseInt(msgLength);var msg=sliceBuffer(bufferTail,0,msgLength);if(isString){try{msg=String.fromCharCode.apply(null,new Uint8Array(msg))}catch(e){var typed=new Uint8Array(msg);msg="";for(var i=0;i<typed.length;i++){msg+=String.fromCharCode(typed[i])}}}buffers.push(msg);bufferTail=sliceBuffer(bufferTail,msgLength)}var total=buffers.length;buffers.forEach(function(buffer,i){callback(exports.decodePacket(buffer,binaryType,true),i,total)})}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./keys":26,after:27,"arraybuffer.slice":28,"base64-arraybuffer":29,blob:30,"has-binary":31,utf8:33}],26:[function(_dereq_,module,exports){module.exports=Object.keys||function keys(obj){var arr=[];var has=Object.prototype.hasOwnProperty;for(var i in obj){if(has.call(obj,i)){arr.push(i)}}return arr}},{}],27:[function(_dereq_,module,exports){module.exports=after;function after(count,callback,err_cb){var bail=false;err_cb=err_cb||noop;proxy.count=count;return count===0?callback():proxy;function proxy(err,result){if(proxy.count<=0){throw new Error("after called too many times")}--proxy.count;if(err){bail=true;callback(err);callback=err_cb}else if(proxy.count===0&&!bail){callback(null,result)}}}function noop(){}},{}],28:[function(_dereq_,module,exports){module.exports=function(arraybuffer,start,end){var bytes=arraybuffer.byteLength;start=start||0;end=end||bytes;if(arraybuffer.slice){return arraybuffer.slice(start,end)}if(start<0){start+=bytes}if(end<0){end+=bytes}if(end>bytes){end=bytes}if(start>=bytes||start>=end||bytes===0){return new ArrayBuffer(0)}var abv=new Uint8Array(arraybuffer);var result=new Uint8Array(end-start);for(var i=start,ii=0;i<end;i++,ii++){result[ii]=abv[i]}return result.buffer}},{}],29:[function(_dereq_,module,exports){(function(chars){"use strict";exports.encode=function(arraybuffer){var bytes=new Uint8Array(arraybuffer),i,len=bytes.length,base64="";for(i=0;i<len;i+=3){base64+=chars[bytes[i]>>2];base64+=chars[(bytes[i]&3)<<4|bytes[i+1]>>4];base64+=chars[(bytes[i+1]&15)<<2|bytes[i+2]>>6];base64+=chars[bytes[i+2]&63]}if(len%3===2){base64=base64.substring(0,base64.length-1)+"="}else if(len%3===1){base64=base64.substring(0,base64.length-2)+"=="}return base64};exports.decode=function(base64){var bufferLength=base64.length*.75,len=base64.length,i,p=0,encoded1,encoded2,encoded3,encoded4;if(base64[base64.length-1]==="="){bufferLength--;if(base64[base64.length-2]==="="){bufferLength--}}var arraybuffer=new ArrayBuffer(bufferLength),bytes=new Uint8Array(arraybuffer);for(i=0;i<len;i+=4){encoded1=chars.indexOf(base64[i]);encoded2=chars.indexOf(base64[i+1]);encoded3=chars.indexOf(base64[i+2]);encoded4=chars.indexOf(base64[i+3]);bytes[p++]=encoded1<<2|encoded2>>4;bytes[p++]=(encoded2&15)<<4|encoded3>>2;bytes[p++]=(encoded3&3)<<6|encoded4&63}return arraybuffer}})("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],30:[function(_dereq_,module,exports){(function(global){var BlobBuilder=global.BlobBuilder||global.WebKitBlobBuilder||global.MSBlobBuilder||global.MozBlobBuilder;var blobSupported=function(){try{var b=new Blob(["hi"]);return b.size==2}catch(e){return false}}();var blobBuilderSupported=BlobBuilder&&BlobBuilder.prototype.append&&BlobBuilder.prototype.getBlob;function BlobBuilderConstructor(ary,options){options=options||{};var bb=new BlobBuilder;for(var i=0;i<ary.length;i++){bb.append(ary[i])}return options.type?bb.getBlob(options.type):bb.getBlob()}module.exports=function(){if(blobSupported){return global.Blob}else if(blobBuilderSupported){return BlobBuilderConstructor}else{return undefined}}()}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],31:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(obj.hasOwnProperty(key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:32}],32:[function(_dereq_,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=="[object Array]"}},{}],33:[function(_dereq_,module,exports){(function(global){(function(root){var freeExports=typeof exports=="object"&&exports;var freeModule=typeof module=="object"&&module&&module.exports==freeExports&&module;var freeGlobal=typeof global=="object"&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal){root=freeGlobal}var stringFromCharCode=String.fromCharCode;function ucs2decode(string){var output=[];var counter=0;var length=string.length;var value;var extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){var length=array.length;var index=-1;var value;var output="";while(++index<length){value=array[index];if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value)}return output}function createByte(codePoint,shift){return stringFromCharCode(codePoint>>shift&63|128)}function encodeCodePoint(codePoint){if((codePoint&4294967168)==0){return stringFromCharCode(codePoint)}var symbol="";if((codePoint&4294965248)==0){symbol=stringFromCharCode(codePoint>>6&31|192)}else if((codePoint&4294901760)==0){symbol=stringFromCharCode(codePoint>>12&15|224);symbol+=createByte(codePoint,6)}else if((codePoint&4292870144)==0){symbol=stringFromCharCode(codePoint>>18&7|240);symbol+=createByte(codePoint,12);symbol+=createByte(codePoint,6)}symbol+=stringFromCharCode(codePoint&63|128);return symbol}function utf8encode(string){var codePoints=ucs2decode(string);var length=codePoints.length;var index=-1;var codePoint;var byteString="";while(++index<length){codePoint=codePoints[index];byteString+=encodeCodePoint(codePoint)}return byteString}function readContinuationByte(){if(byteIndex>=byteCount){throw Error("Invalid byte index")}var continuationByte=byteArray[byteIndex]&255;byteIndex++;if((continuationByte&192)==128){return continuationByte&63}throw Error("Invalid continuation byte")}function decodeSymbol(){var byte1;var byte2;var byte3;var byte4;var codePoint;if(byteIndex>byteCount){throw Error("Invalid byte index")}if(byteIndex==byteCount){return false}byte1=byteArray[byteIndex]&255;byteIndex++;if((byte1&128)==0){return byte1}if((byte1&224)==192){var byte2=readContinuationByte();codePoint=(byte1&31)<<6|byte2;if(codePoint>=128){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&240)==224){byte2=readContinuationByte();byte3=readContinuationByte();codePoint=(byte1&15)<<12|byte2<<6|byte3;if(codePoint>=2048){return codePoint}else{throw Error("Invalid continuation byte")}}if((byte1&248)==240){byte2=readContinuationByte();byte3=readContinuationByte();byte4=readContinuationByte();codePoint=(byte1&15)<<18|byte2<<12|byte3<<6|byte4;if(codePoint>=65536&&codePoint<=1114111){return codePoint}}throw Error("Invalid UTF-8 detected")}var byteArray;var byteCount;var byteIndex;function utf8decode(byteString){byteArray=ucs2decode(byteString);byteCount=byteArray.length;byteIndex=0;var codePoints=[];var tmp;while((tmp=decodeSymbol())!==false){codePoints.push(tmp)}return ucs2encode(codePoints)}var utf8={version:"2.0.0",encode:utf8encode,decode:utf8decode};if(typeof define=="function"&&typeof define.amd=="object"&&define.amd){define(function(){return utf8})}else if(freeExports&&!freeExports.nodeType){if(freeModule){freeModule.exports=utf8}else{var object={};var hasOwnProperty=object.hasOwnProperty;for(var key in utf8){hasOwnProperty.call(utf8,key)&&(freeExports[key]=utf8[key])}}}else{root.utf8=utf8}})(this)}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],34:[function(_dereq_,module,exports){(function(global){var rvalidchars=/^[\],:{}\s]*$/;var rvalidescape=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g;var rvalidtokens=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g;var rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g;var rtrimLeft=/^\s+/;var rtrimRight=/\s+$/;module.exports=function parsejson(data){if("string"!=typeof data||!data){return null}data=data.replace(rtrimLeft,"").replace(rtrimRight,"");if(global.JSON&&JSON.parse){return JSON.parse(data)}if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],35:[function(_dereq_,module,exports){exports.encode=function(obj){var str="";for(var i in obj){if(obj.hasOwnProperty(i)){if(str.length)str+="&";str+=encodeURIComponent(i)+"="+encodeURIComponent(obj[i])}}return str};exports.decode=function(qs){var qry={};var pairs=qs.split("&");for(var i=0,l=pairs.length;i<l;i++){var pair=pairs[i].split("=");qry[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return qry}},{}],36:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var src=str,b=str.indexOf("["),e=str.indexOf("]");if(b!=-1&&e!=-1){str=str.substring(0,b)+str.substring(b,e).replace(/:/g,";")+str.substring(e,str.length)}var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}if(b!=-1&&e!=-1){uri.source=src;uri.host=uri.host.substring(1,uri.host.length-1).replace(/;/g,":");uri.authority=uri.authority.replace("[","").replace("]","").replace(/;/g,":");uri.ipv6uri=true}return uri}},{}],37:[function(_dereq_,module,exports){var global=function(){return this}();var WebSocket=global.WebSocket||global.MozWebSocket;module.exports=WebSocket?ws:null;function ws(uri,protocols,opts){var instance;if(protocols){instance=new WebSocket(uri,protocols)}else{instance=new WebSocket(uri)}return instance}if(WebSocket)ws.prototype=WebSocket.prototype},{}],38:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");module.exports=hasBinary;function hasBinary(data){function _hasBinary(obj){if(!obj)return false;if(global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer||global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){return true}if(isArray(obj)){for(var i=0;i<obj.length;i++){if(_hasBinary(obj[i])){return true}}}else if(obj&&"object"==typeof obj){if(obj.toJSON){obj=obj.toJSON()}for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)&&_hasBinary(obj[key])){return true}}}return false}return _hasBinary(data)}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{isarray:39}],39:[function(_dereq_,module,exports){module.exports=_dereq_(32)},{}],40:[function(_dereq_,module,exports){var global=_dereq_("global");try{module.exports="XMLHttpRequest"in global&&"withCredentials"in new global.XMLHttpRequest}catch(err){module.exports=false}},{global:41}],41:[function(_dereq_,module,exports){module.exports=function(){return this}()},{}],42:[function(_dereq_,module,exports){var indexOf=[].indexOf;module.exports=function(arr,obj){if(indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}},{}],43:[function(_dereq_,module,exports){var has=Object.prototype.hasOwnProperty;exports.keys=Object.keys||function(obj){var keys=[];for(var key in obj){if(has.call(obj,key)){keys.push(key)}}return keys};exports.values=function(obj){var vals=[];for(var key in obj){if(has.call(obj,key)){vals.push(obj[key])}}return vals};exports.merge=function(a,b){for(var key in b){if(has.call(b,key)){a[key]=b[key]}}return a};exports.length=function(obj){return exports.keys(obj).length};exports.isEmpty=function(obj){return 0==exports.length(obj)}},{}],44:[function(_dereq_,module,exports){var re=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/;var parts=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];module.exports=function parseuri(str){var m=re.exec(str||""),uri={},i=14;while(i--){uri[parts[i]]=m[i]||""}return uri}},{}],45:[function(_dereq_,module,exports){(function(global){var isArray=_dereq_("isarray");var isBuf=_dereq_("./is-buffer");exports.deconstructPacket=function(packet){var buffers=[];var packetData=packet.data;function _deconstructPacket(data){if(!data)return data;if(isBuf(data)){var placeholder={_placeholder:true,num:buffers.length};buffers.push(data);return placeholder}else if(isArray(data)){var newData=new Array(data.length);for(var i=0;i<data.length;i++){newData[i]=_deconstructPacket(data[i])}return newData}else if("object"==typeof data&&!(data instanceof Date)){var newData={};for(var key in data){newData[key]=_deconstructPacket(data[key])}return newData}return data}var pack=packet;pack.data=_deconstructPacket(packetData);pack.attachments=buffers.length;return{packet:pack,buffers:buffers}};exports.reconstructPacket=function(packet,buffers){var curPlaceHolder=0;function _reconstructPacket(data){if(data&&data._placeholder){var buf=buffers[data.num];return buf}else if(isArray(data)){for(var i=0;i<data.length;i++){data[i]=_reconstructPacket(data[i])}return data}else if(data&&"object"==typeof data){for(var key in data){data[key]=_reconstructPacket(data[key])}return data}return data}packet.data=_reconstructPacket(packet.data);packet.attachments=undefined;return packet};exports.removeBlobs=function(data,callback){function _removeBlobs(obj,curKey,containingObject){if(!obj)return obj;if(global.Blob&&obj instanceof Blob||global.File&&obj instanceof File){pendingBlobs++;var fileReader=new FileReader;fileReader.onload=function(){if(containingObject){containingObject[curKey]=this.result}else{bloblessData=this.result}if(!--pendingBlobs){callback(bloblessData)}};fileReader.readAsArrayBuffer(obj)}else if(isArray(obj)){for(var i=0;i<obj.length;i++){_removeBlobs(obj[i],i,obj)}}else if(obj&&"object"==typeof obj&&!isBuf(obj)){for(var key in obj){_removeBlobs(obj[key],key,obj)}}}var pendingBlobs=0;var bloblessData=data;_removeBlobs(bloblessData);if(!pendingBlobs){callback(bloblessData)}}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./is-buffer":47,isarray:48}],46:[function(_dereq_,module,exports){var debug=_dereq_("debug")("socket.io-parser");var json=_dereq_("json3");var isArray=_dereq_("isarray");var Emitter=_dereq_("component-emitter");var binary=_dereq_("./binary");var isBuf=_dereq_("./is-buffer");exports.protocol=4;exports.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"];exports.CONNECT=0;exports.DISCONNECT=1;exports.EVENT=2;exports.ACK=3;exports.ERROR=4;exports.BINARY_EVENT=5;exports.BINARY_ACK=6;exports.Encoder=Encoder;exports.Decoder=Decoder;function Encoder(){}Encoder.prototype.encode=function(obj,callback){debug("encoding packet %j",obj);if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){encodeAsBinary(obj,callback)}else{var encoding=encodeAsString(obj);callback([encoding])}};function encodeAsString(obj){var str="";var nsp=false;str+=obj.type;if(exports.BINARY_EVENT==obj.type||exports.BINARY_ACK==obj.type){str+=obj.attachments;str+="-"}if(obj.nsp&&"/"!=obj.nsp){nsp=true;str+=obj.nsp}if(null!=obj.id){if(nsp){str+=",";nsp=false}str+=obj.id}if(null!=obj.data){if(nsp)str+=",";str+=json.stringify(obj.data)}debug("encoded %j as %s",obj,str);return str}function encodeAsBinary(obj,callback){function writeEncoding(bloblessData){var deconstruction=binary.deconstructPacket(bloblessData);var pack=encodeAsString(deconstruction.packet);var buffers=deconstruction.buffers;buffers.unshift(pack);callback(buffers)}binary.removeBlobs(obj,writeEncoding)}function Decoder(){this.reconstructor=null}Emitter(Decoder.prototype);Decoder.prototype.add=function(obj){var packet;if("string"==typeof obj){packet=decodeString(obj);if(exports.BINARY_EVENT==packet.type||exports.BINARY_ACK==packet.type){this.reconstructor=new BinaryReconstructor(packet);if(this.reconstructor.reconPack.attachments===0){this.emit("decoded",packet)}}else{this.emit("decoded",packet)}}else if(isBuf(obj)||obj.base64){if(!this.reconstructor){throw new Error("got binary data when not reconstructing a packet")}else{packet=this.reconstructor.takeBinaryData(obj);if(packet){this.reconstructor=null;this.emit("decoded",packet)}}}else{throw new Error("Unknown type: "+obj)}};function decodeString(str){var p={};var i=0;p.type=Number(str.charAt(0));if(null==exports.types[p.type])return error();if(exports.BINARY_EVENT==p.type||exports.BINARY_ACK==p.type){var buf="";while(str.charAt(++i)!="-"){buf+=str.charAt(i);if(i==str.length)break}if(buf!=Number(buf)||str.charAt(i)!="-"){throw new Error("Illegal attachments")}p.attachments=Number(buf)}if("/"==str.charAt(i+1)){p.nsp="";while(++i){var c=str.charAt(i);if(","==c)break;p.nsp+=c;if(i==str.length)break}}else{p.nsp="/"}var next=str.charAt(i+1);if(""!==next&&Number(next)==next){p.id="";while(++i){var c=str.charAt(i);if(null==c||Number(c)!=c){--i;break}p.id+=str.charAt(i);if(i==str.length)break}p.id=Number(p.id)}if(str.charAt(++i)){try{p.data=json.parse(str.substr(i))}catch(e){return error()}}debug("decoded %s as %j",str,p);return p}Decoder.prototype.destroy=function(){if(this.reconstructor){this.reconstructor.finishedReconstruction()}};function BinaryReconstructor(packet){this.reconPack=packet;this.buffers=[]}BinaryReconstructor.prototype.takeBinaryData=function(binData){this.buffers.push(binData);if(this.buffers.length==this.reconPack.attachments){var packet=binary.reconstructPacket(this.reconPack,this.buffers);this.finishedReconstruction();return packet}return null};BinaryReconstructor.prototype.finishedReconstruction=function(){this.reconPack=null;this.buffers=[]};function error(data){return{type:exports.ERROR,data:"parser error"}}},{"./binary":45,"./is-buffer":47,"component-emitter":9,debug:10,isarray:48,json3:49}],47:[function(_dereq_,module,exports){(function(global){module.exports=isBuf;function isBuf(obj){return global.Buffer&&global.Buffer.isBuffer(obj)||global.ArrayBuffer&&obj instanceof ArrayBuffer}}).call(this,typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],48:[function(_dereq_,module,exports){module.exports=_dereq_(32)},{}],49:[function(_dereq_,module,exports){(function(window){var getClass={}.toString,isProperty,forEach,undef;var isLoader=typeof define==="function"&&define.amd;var nativeJSON=typeof JSON=="object"&&JSON;var JSON3=typeof exports=="object"&&exports&&!exports.nodeType&&exports;if(JSON3&&nativeJSON){JSON3.stringify=nativeJSON.stringify;JSON3.parse=nativeJSON.parse}else{JSON3=window.JSON=nativeJSON||{}}var isExtended=new Date(-0xc782b5b800cec);try{isExtended=isExtended.getUTCFullYear()==-109252&&isExtended.getUTCMonth()===0&&isExtended.getUTCDate()===1&&isExtended.getUTCHours()==10&&isExtended.getUTCMinutes()==37&&isExtended.getUTCSeconds()==6&&isExtended.getUTCMilliseconds()==708}catch(exception){}function has(name){if(has[name]!==undef){return has[name]}var isSupported;if(name=="bug-string-char-index"){isSupported="a"[0]!="a"}else if(name=="json"){isSupported=has("json-stringify")&&has("json-parse")}else{var value,serialized='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if(name=="json-stringify"){var stringify=JSON3.stringify,stringifySupported=typeof stringify=="function"&&isExtended;if(stringifySupported){(value=function(){return 1}).toJSON=value;try{stringifySupported=stringify(0)==="0"&&stringify(new Number)==="0"&&stringify(new String)=='""'&&stringify(getClass)===undef&&stringify(undef)===undef&&stringify()===undef&&stringify(value)==="1"&&stringify([value])=="[1]"&&stringify([undef])=="[null]"&&stringify(null)=="null"&&stringify([undef,getClass,null])=="[null,null,null]"&&stringify({a:[value,true,false,null,"\x00\b\n\f\r	"]})==serialized&&stringify(null,value)==="1"&&stringify([1,2],null,1)=="[\n 1,\n 2\n]"&&stringify(new Date(-864e13))=='"-271821-04-20T00:00:00.000Z"'&&stringify(new Date(864e13))=='"+275760-09-13T00:00:00.000Z"'&&stringify(new Date(-621987552e5))=='"-000001-01-01T00:00:00.000Z"'&&stringify(new Date(-1))=='"1969-12-31T23:59:59.999Z"'}catch(exception){stringifySupported=false}}isSupported=stringifySupported}if(name=="json-parse"){var parse=JSON3.parse;if(typeof parse=="function"){try{if(parse("0")===0&&!parse(false)){value=parse(serialized);var parseSupported=value["a"].length==5&&value["a"][0]===1;if(parseSupported){try{parseSupported=!parse('"	"')}catch(exception){}if(parseSupported){try{parseSupported=parse("01")!==1}catch(exception){}}if(parseSupported){try{parseSupported=parse("1.")!==1}catch(exception){}}}}}catch(exception){parseSupported=false}}isSupported=parseSupported}}return has[name]=!!isSupported}if(!has("json")){var functionClass="[object Function]";var dateClass="[object Date]";var numberClass="[object Number]";var stringClass="[object String]";var arrayClass="[object Array]";var booleanClass="[object Boolean]";var charIndexBuggy=has("bug-string-char-index");if(!isExtended){var floor=Math.floor;var Months=[0,31,59,90,120,151,181,212,243,273,304,334];var getDay=function(year,month){return Months[month]+365*(year-1970)+floor((year-1969+(month=+(month>1)))/4)-floor((year-1901+month)/100)+floor((year-1601+month)/400)}}if(!(isProperty={}.hasOwnProperty)){isProperty=function(property){var members={},constructor;if((members.__proto__=null,members.__proto__={toString:1},members).toString!=getClass){isProperty=function(property){var original=this.__proto__,result=property in(this.__proto__=null,this);this.__proto__=original;return result}}else{constructor=members.constructor;isProperty=function(property){var parent=(this.constructor||constructor).prototype;return property in this&&!(property in parent&&this[property]===parent[property])}}members=null;return isProperty.call(this,property)}}var PrimitiveTypes={"boolean":1,number:1,string:1,undefined:1};var isHostType=function(object,property){var type=typeof object[property];return type=="object"?!!object[property]:!PrimitiveTypes[type]};forEach=function(object,callback){var size=0,Properties,members,property;(Properties=function(){this.valueOf=0}).prototype.valueOf=0;members=new Properties;for(property in members){if(isProperty.call(members,property)){size++}}Properties=members=null;if(!size){members=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"];forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,length;var hasProperty=!isFunction&&typeof object.constructor!="function"&&isHostType(object,"hasOwnProperty")?object.hasOwnProperty:isProperty;for(property in object){if(!(isFunction&&property=="prototype")&&hasProperty.call(object,property)){callback(property)}}for(length=members.length;property=members[--length];hasProperty.call(object,property)&&callback(property));}}else if(size==2){forEach=function(object,callback){var members={},isFunction=getClass.call(object)==functionClass,property;for(property in object){if(!(isFunction&&property=="prototype")&&!isProperty.call(members,property)&&(members[property]=1)&&isProperty.call(object,property)){callback(property)}}}}else{forEach=function(object,callback){var isFunction=getClass.call(object)==functionClass,property,isConstructor;for(property in object){if(!(isFunction&&property=="prototype")&&isProperty.call(object,property)&&!(isConstructor=property==="constructor")){callback(property)}}if(isConstructor||isProperty.call(object,property="constructor")){callback(property)}}}return forEach(object,callback)};if(!has("json-stringify")){var Escapes={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"};var leadingZeroes="000000";var toPaddedString=function(width,value){return(leadingZeroes+(value||0)).slice(-width)};var unicodePrefix="\\u00";var quote=function(value){var result='"',index=0,length=value.length,isLarge=length>10&&charIndexBuggy,symbols;if(isLarge){symbols=value.split("")}for(;index<length;index++){var charCode=value.charCodeAt(index);switch(charCode){case 8:case 9:case 10:case 12:case 13:case 34:case 92:result+=Escapes[charCode];break;default:if(charCode<32){result+=unicodePrefix+toPaddedString(2,charCode.toString(16));break}result+=isLarge?symbols[index]:charIndexBuggy?value.charAt(index):value[index]}}return result+'"'
};var serialize=function(property,object,callback,properties,whitespace,indentation,stack){var value,className,year,month,date,time,hours,minutes,seconds,milliseconds,results,element,index,length,prefix,result;try{value=object[property]}catch(exception){}if(typeof value=="object"&&value){className=getClass.call(value);if(className==dateClass&&!isProperty.call(value,"toJSON")){if(value>-1/0&&value<1/0){if(getDay){date=floor(value/864e5);for(year=floor(date/365.2425)+1970-1;getDay(year+1,0)<=date;year++);for(month=floor((date-getDay(year,0))/30.42);getDay(year,month+1)<=date;month++);date=1+date-getDay(year,month);time=(value%864e5+864e5)%864e5;hours=floor(time/36e5)%24;minutes=floor(time/6e4)%60;seconds=floor(time/1e3)%60;milliseconds=time%1e3}else{year=value.getUTCFullYear();month=value.getUTCMonth();date=value.getUTCDate();hours=value.getUTCHours();minutes=value.getUTCMinutes();seconds=value.getUTCSeconds();milliseconds=value.getUTCMilliseconds()}value=(year<=0||year>=1e4?(year<0?"-":"+")+toPaddedString(6,year<0?-year:year):toPaddedString(4,year))+"-"+toPaddedString(2,month+1)+"-"+toPaddedString(2,date)+"T"+toPaddedString(2,hours)+":"+toPaddedString(2,minutes)+":"+toPaddedString(2,seconds)+"."+toPaddedString(3,milliseconds)+"Z"}else{value=null}}else if(typeof value.toJSON=="function"&&(className!=numberClass&&className!=stringClass&&className!=arrayClass||isProperty.call(value,"toJSON"))){value=value.toJSON(property)}}if(callback){value=callback.call(object,property,value)}if(value===null){return"null"}className=getClass.call(value);if(className==booleanClass){return""+value}else if(className==numberClass){return value>-1/0&&value<1/0?""+value:"null"}else if(className==stringClass){return quote(""+value)}if(typeof value=="object"){for(length=stack.length;length--;){if(stack[length]===value){throw TypeError()}}stack.push(value);results=[];prefix=indentation;indentation+=whitespace;if(className==arrayClass){for(index=0,length=value.length;index<length;index++){element=serialize(index,value,callback,properties,whitespace,indentation,stack);results.push(element===undef?"null":element)}result=results.length?whitespace?"[\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"]":"["+results.join(",")+"]":"[]"}else{forEach(properties||value,function(property){var element=serialize(property,value,callback,properties,whitespace,indentation,stack);if(element!==undef){results.push(quote(property)+":"+(whitespace?" ":"")+element)}});result=results.length?whitespace?"{\n"+indentation+results.join(",\n"+indentation)+"\n"+prefix+"}":"{"+results.join(",")+"}":"{}"}stack.pop();return result}};JSON3.stringify=function(source,filter,width){var whitespace,callback,properties,className;if(typeof filter=="function"||typeof filter=="object"&&filter){if((className=getClass.call(filter))==functionClass){callback=filter}else if(className==arrayClass){properties={};for(var index=0,length=filter.length,value;index<length;value=filter[index++],(className=getClass.call(value),className==stringClass||className==numberClass)&&(properties[value]=1));}}if(width){if((className=getClass.call(width))==numberClass){if((width-=width%1)>0){for(whitespace="",width>10&&(width=10);whitespace.length<width;whitespace+=" ");}}else if(className==stringClass){whitespace=width.length<=10?width:width.slice(0,10)}}return serialize("",(value={},value[""]=source,value),callback,properties,whitespace,"",[])}}if(!has("json-parse")){var fromCharCode=String.fromCharCode;var Unescapes={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"};var Index,Source;var abort=function(){Index=Source=null;throw SyntaxError()};var lex=function(){var source=Source,length=source.length,value,begin,position,isSigned,charCode;while(Index<length){charCode=source.charCodeAt(Index);switch(charCode){case 9:case 10:case 13:case 32:Index++;break;case 123:case 125:case 91:case 93:case 58:case 44:value=charIndexBuggy?source.charAt(Index):source[Index];Index++;return value;case 34:for(value="@",Index++;Index<length;){charCode=source.charCodeAt(Index);if(charCode<32){abort()}else if(charCode==92){charCode=source.charCodeAt(++Index);switch(charCode){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:value+=Unescapes[charCode];Index++;break;case 117:begin=++Index;for(position=Index+4;Index<position;Index++){charCode=source.charCodeAt(Index);if(!(charCode>=48&&charCode<=57||charCode>=97&&charCode<=102||charCode>=65&&charCode<=70)){abort()}}value+=fromCharCode("0x"+source.slice(begin,Index));break;default:abort()}}else{if(charCode==34){break}charCode=source.charCodeAt(Index);begin=Index;while(charCode>=32&&charCode!=92&&charCode!=34){charCode=source.charCodeAt(++Index)}value+=source.slice(begin,Index)}}if(source.charCodeAt(Index)==34){Index++;return value}abort();default:begin=Index;if(charCode==45){isSigned=true;charCode=source.charCodeAt(++Index)}if(charCode>=48&&charCode<=57){if(charCode==48&&(charCode=source.charCodeAt(Index+1),charCode>=48&&charCode<=57)){abort()}isSigned=false;for(;Index<length&&(charCode=source.charCodeAt(Index),charCode>=48&&charCode<=57);Index++);if(source.charCodeAt(Index)==46){position=++Index;for(;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}charCode=source.charCodeAt(Index);if(charCode==101||charCode==69){charCode=source.charCodeAt(++Index);if(charCode==43||charCode==45){Index++}for(position=Index;position<length&&(charCode=source.charCodeAt(position),charCode>=48&&charCode<=57);position++);if(position==Index){abort()}Index=position}return+source.slice(begin,Index)}if(isSigned){abort()}if(source.slice(Index,Index+4)=="true"){Index+=4;return true}else if(source.slice(Index,Index+5)=="false"){Index+=5;return false}else if(source.slice(Index,Index+4)=="null"){Index+=4;return null}abort()}}return"$"};var get=function(value){var results,hasMembers;if(value=="$"){abort()}if(typeof value=="string"){if((charIndexBuggy?value.charAt(0):value[0])=="@"){return value.slice(1)}if(value=="["){results=[];for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="]"){break}if(hasMembers){if(value==","){value=lex();if(value=="]"){abort()}}else{abort()}}if(value==","){abort()}results.push(get(value))}return results}else if(value=="{"){results={};for(;;hasMembers||(hasMembers=true)){value=lex();if(value=="}"){break}if(hasMembers){if(value==","){value=lex();if(value=="}"){abort()}}else{abort()}}if(value==","||typeof value!="string"||(charIndexBuggy?value.charAt(0):value[0])!="@"||lex()!=":"){abort()}results[value.slice(1)]=get(lex())}return results}abort()}return value};var update=function(source,property,callback){var element=walk(source,property,callback);if(element===undef){delete source[property]}else{source[property]=element}};var walk=function(source,property,callback){var value=source[property],length;if(typeof value=="object"&&value){if(getClass.call(value)==arrayClass){for(length=value.length;length--;){update(value,length,callback)}}else{forEach(value,function(property){update(value,property,callback)})}}return callback.call(source,property,value)};JSON3.parse=function(source,callback){var result,value;Index=0;Source=""+source;result=get(lex());if(lex()!="$"){abort()}Index=Source=null;return callback&&getClass.call(callback)==functionClass?walk((value={},value[""]=result,value),"",callback):result}}}if(isLoader){define(function(){return JSON3})}})(this)},{}],50:[function(_dereq_,module,exports){module.exports=toArray;function toArray(list,index){var array=[];index=index||0;for(var i=index||0;i<list.length;i++){array[i-index]=list[i]}return array}},{}]},{},[1])(1)});BigInteger=function(){var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&navigator.appName=="Microsoft Internet Explorer"){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&navigator.appName!="Netscape"){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(BigInteger.ONE.shiftLeft(a-1),this)}}}else{var x=new Array,t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0)x[0]&=(1<<t)-1;else x[0]=0;this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(i-->0){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)r[k++]=d|this.s<<this.DB-p;while(i>=0){if(p<8){d=(this[i]&(1<<p)-1)<<8-p;d|=this[--i]>>(p+=this.DB-8)}else{d=this[i]>>(p-=8)&255;if(p<=0){p+=this.DB;--i}}if((d&128)!=0)d|=-256;if(k==0&&(this.s&128)!=(d&128))++k;if(k>0||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return this.compareTo(a)==0}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(n<0)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r}function bnShiftRight(n){var r=nbi();if(n<0)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r}function lbit(x){if(x==0)return-1;var r=0;if((x&65535)==0){x>>=16;r+=16}if((x&255)==0){x>>=8;r+=8}if((x&15)==0){x>>=4;r+=4}if((x&3)==0){x>>=2;r+=2}if((x&1)==0)++r;return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+lbit(this[i]);if(this.s<0)return this.t*this.DB;return-1}function cbit(x){var r=0;while(x!=0){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return this.s!=0;return(this[j]&1<<n%this.DB)!=0}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);else if(x.compareTo(this.m)<0)return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;else if(i<18)k=1;else if(i<48)k=3;else if(i<144)k=4;else if(i<768)k=5;else k=6;if(i<8)z=new Classic(m);else if(m.isEven())z=new Barrett(m);else z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1)w=e[j]>>i-k1&km;else{w=(e[j]&(1<<i+1)-1)<<k1-i;if(j>0)w|=e[j-1]>>this.DB+i-k1}n=k;while((w&1)==0){w>>=1;--n}if((i-=n)<0){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(n>0)z.sqrTo(r,r2);else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&1<<i)==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone();var y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;if(i<g)g=i;if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(x.signum()>0){if((i=x.getLowestSetBit())>0)x.rShiftTo(i,x);if((i=y.getLowestSetBit())>0)y.rShiftTo(i,y);if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(g>0)y.lShiftTo(g,y);return y}function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||m.signum()==0)return BigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d)}if(u.compareTo(v)>=0){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b)}else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d)}}if(v.compareTo(BigInteger.ONE)!=0)return BigInteger.ZERO;if(d.compareTo(m)>=0)return d.subtract(m);if(d.signum()<0)d.addTo(m,d);else return d;if(d.signum()<0)return d.add(m);else return d}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return true;return false}if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return false}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE);var k=n1.getLowestSetBit();if(k<=0)return false;var r=n1.shiftRight(k);t=t+1>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(BigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(BigInteger.ONE)==0)return false}if(y.compareTo(n1)!=0)return false}}return true}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;return BigInteger}();SRPClient=function(){var hex_chr="0123456789abcdef";function hex(num){var str="";for(var j=7;j>=0;j--)str+=hex_chr.charAt(num>>j*4&15);return str}function str2blks_SHA1(str){var nblk=(str.length+8>>6)+1;var blks=new Array(nblk*16);for(var i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<str.length;i++)blks[i>>2]|=str.charCodeAt(i)<<24-i%4*8;blks[i>>2]|=128<<24-i%4*8;blks[nblk*16-1]=str.length*8;return blks}function hex2blks_SHA1(hex){var len=hex.length+1>>1;var nblk=(len+8>>6)+1;var blks=new Array(nblk*16);for(var i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<len;i++)blks[i>>2]|=parseInt(hex.substr(2*i,2),16)<<24-i%4*8;blks[i>>2]|=128<<24-i%4*8;blks[nblk*16-1]=len*8;return blks}function ba2blks_SHA1(ba,off,len){var nblk=(len+8>>6)+1;var blks=new Array(nblk*16);for(var i=0;i<nblk*16;i++)blks[i]=0;for(i=0;i<len;i++)blks[i>>2]|=(ba[off+i]&255)<<24-i%4*8;blks[i>>2]|=128<<24-i%4*8;blks[nblk*16-1]=len*8;return blks}function add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function rol(num,cnt){return num<<cnt|num>>>32-cnt}function ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function calcSHA1(str){return calcSHA1Blks(str2blks_SHA1(str))}function calcSHA1Hex(str){return calcSHA1Blks(hex2blks_SHA1(str))}function calcSHA1BA(ba){return calcSHA1Blks(ba2blks_SHA1(ba,0,ba.length))}function calcSHA1BAEx(ba,off,len){return calcSHA1Blks(ba2blks_SHA1(ba,off,len))}function calcSHA1Blks(x){var s=calcSHA1Raw(x);return hex(s[0])+hex(s[1])+hex(s[2])+hex(s[3])+hex(s[4])}function calcSHA1Raw(x){var w=new Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){var t;if(j<16)w[j]=x[i+j];else w[j]=rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);t=add(add(rol(a,5),ft(j,b,c,d)),add(add(e,w[j]),kt(j)));e=d;d=c;c=rol(b,30);b=a;a=t}a=add(a,olda);b=add(b,oldb);c=add(c,oldc);d=add(d,oldd);e=add(e,olde)}return new Array(a,b,c,d,e)}function core_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;return calcSHA1Raw(x)}SRPClient=function(username,password,group,hashFn){if(!username)throw"Username cannot be empty.";
this.username=username;this.password=password;this.hashFn=hashFn||"sha-1";var group=group||1024;var initVal=this.initVals[group];this.N=new BigInteger(initVal.N,16);this.g=new BigInteger(initVal.g,16);this.gBn=new BigInteger(initVal.g,16);this.k=this.k();this.one=new BigInteger("1",16);this.two=new BigInteger("2",16)};var bcrypt=dcodeIO.bcrypt;SRPClient.prototype={k:function(){var toHash=[this.N.toString(16),this.g.toString(16)];return this.paddedHash(toHash)},calculateX:function(saltHex){if(!saltHex)throw"Missing parameter.";if(!this.username||!this.password)throw"Username and password cannot be empty.";var usernamePassword=this.username+":"+this.password;var usernamePasswordHash=bcrypt.hashSync(usernamePassword,saltHex);var spad=saltHex.length%2!=0?"0":"";var X=this.hexHash(spad+saltHex+usernamePasswordHash);return new BigInteger(X,16)},calculateV:function(salt){if(!salt)throw"Missing parameter.";var x=this.calculateX(salt);return this.g.modPow(x,this.N)},calculateU:function(A,B){if(!A||!B)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0"||B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var toHash=[A.toString(16),B.toString(16)];return this.paddedHash(toHash)},calculateA:function(a){if(!a)throw"Missing parameter.";if(Math.ceil(a.bitLength()/8)<256/8)throw"Client key length is less than 256 bits.";var A=this.g.modPow(a,this.N);if(A.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";return A},calculateM:function(A,B_or_M,K){if(!A||!B_or_M||!K)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0"||B_or_M.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var aHex=A.toString(16);var bHex=B_or_M.toString(16);var array=[aHex,bHex,K];return this.paddedHash(array)},calculateMozillaM1:function(A,B,S){if(!A||!B||!S)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0"||B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var aHex=A.toString(16);var bHex=B.toString(16);var sHex=S.toString(16);return this.paddedHash([aHex,bHex,sHex])},calculateMozillaM2:function(A,M,K){if(!A||!M||!K)throw"Missing parameter(s).";if(A.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var aHex=A.toString(16);var mHex=M.toString(16);var kHex=K.toString(16);aHex=this.nZeros(512-aHex.length)+aHex;mHex=this.nZeros(64-mHex.length)+mHex;kHex=this.nZeros(64-kHex.length)+kHex;return this.hexHash(aHex+mHex+kHex)},calculateS:function(B,salt,uu,aa){if(!B||!salt||!uu||!aa)throw"Missing parameters.";if(B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";var x=this.calculateX(salt);var bx=this.g.modPow(x,this.N);var btmp=B.add(this.N.multiply(this.k)).subtract(bx.multiply(this.k)).mod(this.N);return btmp.modPow(x.multiply(uu).add(aa),this.N)},calculateK:function(S){var sHex=S.toString(16);sHex=this.nZeros(512-sHex.length)+sHex;return this.hexHash(sHex)},srpRandom:function(){var words=sjcl.random.randomWords(8,0);var hex=sjcl.codec.hex.fromBits(words);if(hex.length!=64)throw"Invalid random number size.";var r=new BigInteger(hex,16);if(r.compareTo(this.N)>=0)r=a.mod(this.N.subtract(this.one));if(r.compareTo(this.two)<0)r=two;return r},randomHexSalt:function(){return bcrypt.genSaltSync()},paddedHash:function(array){var nlen=2*(this.N.toString(16).length*4+7>>3);var toHash="";for(var i=0;i<array.length;i++){toHash+=this.nZeros(nlen-array[i].length)+array[i]}var hash=new BigInteger(this.hexHash(toHash),16);return hash.mod(this.N)},hash:function(str){switch(this.hashFn.toLowerCase()){case"sha-256":var s=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(str));return this.nZeros(64-s.length)+s;case"sha-1":default:return calcSHA1(str)}},hexHash:function(str){switch(this.hashFn.toLowerCase()){case"sha-256":var s=sjcl.codec.hex.fromBits(sjcl.hash.sha256.hash(sjcl.codec.hex.toBits(str)));return this.nZeros(64-s.length)+s;case"sha-1":default:return this.hash(this.pack(str))}},pack:function(hex){if(hex.length%2!=0)hex="0"+hex;i=0;ascii="";while(i<hex.length/2){ascii=ascii+String.fromCharCode(parseInt(hex.substr(i*2,2),16));i++}return ascii},nZeros:function(n){if(n<1)return"";var t=this.nZeros(n>>1);return(n&1)==0?t+t:t+t+"0"},initVals:{1024:{N:"EEAF0AB9ADB38DD69C33F80AFA8FC5E86072618775FF3C0B9EA2314C"+"9C256576D674DF7496EA81D3383B4813D692C6E0E0D5D8E250B98BE4"+"8E495C1D6089DAD15DC7D7B46154D6B6CE8EF4AD69B15D4982559B29"+"7BCF1885C529F566660E57EC68EDBC3C05726CC02FD4CBF4976EAA9A"+"FD5138FE8376435B9FC61D2FC0EB06E3",g:"2"},1536:{N:"9DEF3CAFB939277AB1F12A8617A47BBBDBA51DF499AC4C80BEEEA961"+"4B19CC4D5F4F5F556E27CBDE51C6A94BE4607A291558903BA0D0F843"+"80B655BB9A22E8DCDF028A7CEC67F0D08134B1C8B97989149B609E0B"+"E3BAB63D47548381DBC5B1FC764E3F4B53DD9DA1158BFD3E2B9C8CF5"+"6EDF019539349627DB2FD53D24B7C48665772E437D6C7F8CE442734A"+"F7CCB7AE837C264AE3A9BEB87F8A2FE9B8B5292E5A021FFF5E91479E"+"8CE7A28C2442C6F315180F93499A234DCF76E3FED135F9BB",g:"2"},2048:{N:"AC6BDB41324A9A9BF166DE5E1389582FAF72B6651987EE07FC319294"+"3DB56050A37329CBB4A099ED8193E0757767A13DD52312AB4B03310D"+"CD7F48A9DA04FD50E8083969EDB767B0CF6095179A163AB3661A05FB"+"D5FAAAE82918A9962F0B93B855F97993EC975EEAA80D740ADBF4FF74"+"7359D041D5C33EA71D281E446B14773BCA97B43A23FB801676BD207A"+"436C6481F1D2B9078717461A5B9D32E688F87748544523B524B0D57D"+"5EA77A2775D2ECFA032CFBDBF52FB3786160279004E57AE6AF874E73"+"03CE53299CCC041C7BC308D82A5698F3A8D0C38271AE35F8E9DBFBB6"+"94B5C803D89F7AE435DE236D525F54759B65E372FCD68EF20FA7111F"+"9E4AFF73",g:"2"},3072:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",g:"5"},4096:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B26"+"99C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB"+"04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2"+"233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127"+"D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934063199"+"FFFFFFFFFFFFFFFF",g:"5"},6144:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B26"+"99C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB"+"04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2"+"233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127"+"D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934028492"+"36C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406"+"AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918"+"DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B33205151"+"2BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03"+"F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97F"+"BEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AA"+"CC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58B"+"B7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632"+"387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E"+"6DCC4024FFFFFFFFFFFFFFFF",g:"5"},8192:{N:"FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E08"+"8A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B"+"302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9"+"A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE6"+"49286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8"+"FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D"+"670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C"+"180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF695581718"+"3995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D"+"04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7D"+"B3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D226"+"1AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200C"+"BBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFC"+"E0FD108E4B82D120A92108011A723C12A787E6D788719A10BDBA5B26"+"99C327186AF4E23C1A946834B6150BDA2583E9CA2AD44CE8DBBBC2DB"+"04DE8EF92E8EFC141FBECAA6287C59474E6BC05D99B2964FA090C3A2"+"233BA186515BE7ED1F612970CEE2D7AFB81BDD762170481CD0069127"+"D5B05AA993B4EA988D8FDDC186FFB7DC90A6C08F4DF435C934028492"+"36C3FAB4D27C7026C1D4DCB2602646DEC9751E763DBA37BDF8FF9406"+"AD9E530EE5DB382F413001AEB06A53ED9027D831179727B0865A8918"+"DA3EDBEBCF9B14ED44CE6CBACED4BB1BDB7F1447E6CC254B33205151"+"2BD7AF426FB8F401378CD2BF5983CA01C64B92ECF032EA15D1721D03"+"F482D7CE6E74FEF6D55E702F46980C82B5A84031900B1C9E59E7C97F"+"BEC7E8F323A97A7E36CC88BE0F1D45B7FF585AC54BD407B22B4154AA"+"CC8F6D7EBF48E1D814CC5ED20F8037E0A79715EEF29BE32806A1D58B"+"B7C5DA76F550AA3D8A1FBFF0EB19CCB1A313D55CDA56C9EC2EF29632"+"387FE8D76E3C0468043E8F663F4860EE12BF2D5B0B7474D6E694F91E"+"6DBE115974A3926F12FEE5E438777CB6A932DF8CD8BEC4D073B931BA"+"3BC832B68D9DD300741FA7BF8AFC47ED2576F6936BA424663AAB639C"+"5AE4F5683423B4742BF1C978238F16CBE39D652DE3FDB8BEFC848AD9"+"22222E04A4037C0713EB57A81A23F0C73473FC646CEA306B4BCBC886"+"2F8385DDFA9D4B7FA2C087E879683303ED5BDD3A062B3CF5B3A278A6"+"6D2A13F83F44F82DDF310EE074AB6A364597E899A0255DC164F31CC5"+"0846851DF9AB48195DED7EA1B1D510BD7EE74D73FAF36BC31ECFA268"+"359046F4EB879F924009438B481C6CD7889A002ED5EE382BC9190DA6"+"FC026E479558E4475677E9AA9E3050E2765694DFC81F56E880B96E71"+"60C980DD98EDD3DFFFFFFFFFFFFFFFFF",g:"19"}},calculateB:function(b,v){if(!b||!v)throw"Missing parameters.";var bb=this.g.modPow(b,this.N);var B=bb.add(v.multiply(this.k)).mod(this.N);return B},calculateServerS:function(A,v,u,B){if(!A||!v||!u||!B)throw"Missing parameters.";if(A.mod(this.N).toString()=="0"||B.mod(this.N).toString()=="0")throw"ABORT: illegal_parameter";return v.modPow(u,this.N).multiply(A).mod(this.N).modPow(B,this.N)}};return SRPClient}();